<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>geom &mdash; Goulib 1.7.3 documentation</title>
    
    <link rel="stylesheet" href="../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.7.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Goulib 1.7.3 documentation" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">Goulib 1.7.3 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for geom</h1><div class="highlight"><pre>
<span class="c">#!/usr/bin/python</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">A module providing vector, matrix and quaternion operations for use in 2D and 3D graphics applications.</span>

<span class="sd">based on euclid http://code.google.com/p/pyeuclid</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span> <span class="c">#&quot;true division&quot; everywhere</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s">&quot;Alex Holkner, Philippe Guglielmetti&quot;</span>
<span class="n">__copyright__</span> <span class="o">=</span> <span class="s">&quot;Copyright (c) 2006 Alex Holkner&quot;</span>
<span class="n">__license__</span> <span class="o">=</span> <span class="s">&quot;LGPL&quot;</span>
<span class="n">__credits__</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;http://code.google.com/p/pyeuclid&#39;</span><span class="p">,</span> <span class="s">&#39;http://www.nmt.edu/tcc/help/lang/python/examples/homcoord/&#39;</span><span class="p">]</span>

<span class="n">__docformat__</span> <span class="o">=</span> <span class="s">&#39;restructuredtext&#39;</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s">&#39;$Id$&#39;</span>
<span class="n">__revision__</span> <span class="o">=</span> <span class="s">&#39;$Revision$&#39;</span>

<span class="kn">import</span> <span class="nn">operator</span><span class="o">,</span> <span class="nn">types</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">precision</span> <span class="o">=</span> <span class="mf">1e-9</span> <span class="c">#for equality comparizons</span>

<div class="viewcode-block" id="Vector2"><a class="viewcode-back" href="../modules/geom.html#geom.Vector2">[docs]</a><span class="k">class</span> <span class="nc">Vector2</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">   </span>
<span class="sd">    Two mutable vector types are available: *Vector2* and *Vector3*,</span>
<span class="sd">    for 2D and 3D vectors, respectively.  Vectors are assumed to hold</span>
<span class="sd">    floats, but most operations will also work if you use ints or longs</span>
<span class="sd">    instead.  Construct a vector in the obvious way::</span>
<span class="sd">    </span>
<span class="sd">        &gt;&gt;&gt; Vector2(1.5, 2.0)</span>
<span class="sd">        Vector2(1.50, 2.00)</span>
<span class="sd">    </span>
<span class="sd">        &gt;&gt;&gt; Vector3(1.0, 2.0, 3.0)</span>
<span class="sd">        Vector3(1.00, 2.00, 3.00)</span>
<span class="sd">    </span>
<span class="sd">    **Element access**</span>
<span class="sd">    </span>
<span class="sd">    Components may be accessed as attributes (examples that follow use</span>
<span class="sd">    *Vector3*, but all results are similar for *Vector2*, using only the *x*</span>
<span class="sd">    and *y* components)::</span>
<span class="sd">    </span>
<span class="sd">        &gt;&gt;&gt; v = Vector3(1, 2, 3)</span>
<span class="sd">        &gt;&gt;&gt; v.x</span>
<span class="sd">        1</span>
<span class="sd">        &gt;&gt;&gt; v.y</span>
<span class="sd">        2</span>
<span class="sd">        &gt;&gt;&gt; v.z</span>
<span class="sd">        3</span>
<span class="sd">    </span>
<span class="sd">    Vectors support the list interface via slicing::</span>
<span class="sd">    </span>
<span class="sd">        &gt;&gt;&gt; v = Vector3(1, 2, 3)</span>
<span class="sd">        &gt;&gt;&gt; len(v)</span>
<span class="sd">        3</span>
<span class="sd">        &gt;&gt;&gt; v[0]</span>
<span class="sd">        1</span>
<span class="sd">        &gt;&gt;&gt; v[:]</span>
<span class="sd">        (1, 2, 3)</span>
<span class="sd">    </span>
<span class="sd">    You can also &quot;swizzle&quot; the components (*a la* GLSL or Cg)::</span>
<span class="sd">    </span>
<span class="sd">        &gt;&gt;&gt; v = Vector3(1, 2, 3)</span>
<span class="sd">        &gt;&gt;&gt; v.xyz</span>
<span class="sd">        (1, 2, 3)</span>
<span class="sd">        &gt;&gt;&gt; v.zx</span>
<span class="sd">        (3, 1)</span>
<span class="sd">        &gt;&gt;&gt; v.zzzz</span>
<span class="sd">        (3, 3, 3, 3)</span>
<span class="sd">    </span>
<span class="sd">    All of the above accessors are also mutators[1]::</span>
<span class="sd">    </span>
<span class="sd">        &gt;&gt;&gt; v = Vector3(1, 2, 3)</span>
<span class="sd">        &gt;&gt;&gt; v.x = 5</span>
<span class="sd">        &gt;&gt;&gt; v</span>
<span class="sd">        Vector3(5.00, 2.00, 3.00)</span>
<span class="sd">        &gt;&gt;&gt; v[1:] = (10, 20)</span>
<span class="sd">        &gt;&gt;&gt; v</span>
<span class="sd">        Vector3(5.00, 10.00, 20.00)</span>
<span class="sd">    </span>
<span class="sd">    [1] assignment via a swizzle (e.g., ``v.xyz = (1, 2, 3)``) is supported</span>
<span class="sd">    only if the ``_enable_swizzle_set`` variable is set.  This is disabled</span>
<span class="sd">    by default, as it impacts on the performance of ordinary attribute</span>
<span class="sd">    setting, and is slower than setting components sequentially anyway.</span>
<span class="sd">    </span>
<span class="sd">    **Operators**</span>
<span class="sd">    </span>
<span class="sd">    Addition and subtraction are supported via operator overloading (note </span>
<span class="sd">    that in-place operators perform faster than those that create a new object)::</span>
<span class="sd">    </span>
<span class="sd">        &gt;&gt;&gt; v1 = Vector3(1, 2, 3)</span>
<span class="sd">        &gt;&gt;&gt; v2 = Vector3(4, 5, 6)</span>
<span class="sd">        &gt;&gt;&gt; v1 + v2</span>
<span class="sd">        Vector3(5.00, 7.00, 9.00)</span>
<span class="sd">        &gt;&gt;&gt; v1 -= v2</span>
<span class="sd">        &gt;&gt;&gt; v1</span>
<span class="sd">        Vector3(-3.00, -3.00, -3.00)</span>
<span class="sd">    </span>
<span class="sd">    Multiplication and division can be performed with a scalar only::</span>
<span class="sd">    </span>
<span class="sd">        &gt;&gt;&gt; Vector3(1, 2, 3) * 2</span>
<span class="sd">        Vector3(2.00, 4.00, 6.00)</span>
<span class="sd">        &gt;&gt;&gt; v1 = Vector3(1., 2., 3.)</span>
<span class="sd">        &gt;&gt;&gt; v1 /= 2</span>
<span class="sd">        &gt;&gt;&gt; v1</span>
<span class="sd">        Vector3(0.50, 1.00, 1.50)</span>
<span class="sd">    </span>
<span class="sd">    The magnitude of a vector can be found with ``abs``::</span>
<span class="sd">    </span>
<span class="sd">        &gt;&gt;&gt; v = Vector3(1., 2., 3.)</span>
<span class="sd">        &gt;&gt;&gt; abs(v)</span>
<span class="sd">        3.7416573867739413</span>
<span class="sd">    </span>
<span class="sd">    A vector can be normalized in-place (note that the in-place method also</span>
<span class="sd">    returns ``self``, so you can chain it with further operators)::</span>
<span class="sd">    </span>
<span class="sd">        &gt;&gt;&gt; v = Vector3(1., 2., 3.)</span>
<span class="sd">        &gt;&gt;&gt; v.normalize()</span>
<span class="sd">        Vector3(0.27, 0.53, 0.80)</span>
<span class="sd">        &gt;&gt;&gt; v</span>
<span class="sd">        Vector3(0.27, 0.53, 0.80)</span>
<span class="sd">    </span>
<span class="sd">    The following methods do *not* alter the original vector or their arguments:</span>
<span class="sd">    </span>
<span class="sd">    ``copy()``</span>
<span class="sd">        Returns a copy of the vector.  ``__copy__`` is also implemented.</span>
<span class="sd">    </span>
<span class="sd">    ``magnitude()``</span>
<span class="sd">        Returns the magnitude of the vector; equivalent to ``abs(v)``.  Example::</span>
<span class="sd">    </span>
<span class="sd">            &gt;&gt;&gt; v = Vector3(1., 2., 3.)</span>
<span class="sd">            &gt;&gt;&gt; v.magnitude()</span>
<span class="sd">            3.7416573867739413</span>
<span class="sd">    </span>
<span class="sd">    ``magnitude_squared()``</span>
<span class="sd">        Returns the sum of the squares of each component.  Useful for comparing</span>
<span class="sd">        the length of two vectors without the expensive square root operation.</span>
<span class="sd">        Example::</span>
<span class="sd">    </span>
<span class="sd">            &gt;&gt;&gt; v = Vector3(1., 2., 3.)</span>
<span class="sd">            &gt;&gt;&gt; v.magnitude_squared()</span>
<span class="sd">            14.0</span>
<span class="sd">    </span>
<span class="sd">    ``normalized()``</span>
<span class="sd">        Return a unit length vector in the same direction.  Note that this</span>
<span class="sd">        method differs from ``normalize`` in that it does not modify the</span>
<span class="sd">        vector in-place.  Example::</span>
<span class="sd">    </span>
<span class="sd">            &gt;&gt;&gt; v = Vector3(1., 2., 3.)</span>
<span class="sd">            &gt;&gt;&gt; v.normalized()</span>
<span class="sd">            Vector3(0.27, 0.53, 0.80)</span>
<span class="sd">            &gt;&gt;&gt; v</span>
<span class="sd">            Vector3(1.00, 2.00, 3.00)</span>
<span class="sd">    </span>
<span class="sd">    ``dot(other)``</span>
<span class="sd">        Return the scalar &quot;dot&quot; product of two vectors.  Example::</span>
<span class="sd">    </span>
<span class="sd">            &gt;&gt;&gt; v1 = Vector3(1., 2., 3.)</span>
<span class="sd">            &gt;&gt;&gt; v2 = Vector3(4., 5., 6.)</span>
<span class="sd">            &gt;&gt;&gt; v1.dot(v2)</span>
<span class="sd">            32.0</span>
<span class="sd">    </span>
<span class="sd">    ``cross()`` and ``cross(other)``</span>
<span class="sd">        Return the cross product of a vector (for **Vector2**), or the cross</span>
<span class="sd">        product of two vectors (for **Vector3**).  The return type is a</span>
<span class="sd">        vector.  Example::</span>
<span class="sd">    </span>
<span class="sd">            &gt;&gt;&gt; v1 = Vector3(1., 2., 3.)</span>
<span class="sd">            &gt;&gt;&gt; v2 = Vector3(4., 5., 6.)</span>
<span class="sd">            &gt;&gt;&gt; v1.cross(v2)</span>
<span class="sd">            Vector3(-3.00, 6.00, -3.00)</span>
<span class="sd">    </span>
<span class="sd">        In two dimensions there can be no argument to ``cross``::</span>
<span class="sd">    </span>
<span class="sd">            &gt;&gt;&gt; v1 = Vector2(1., 2.)</span>
<span class="sd">            &gt;&gt;&gt; v1.cross()</span>
<span class="sd">            Vector2(2.00, -1.00)</span>
<span class="sd">    </span>
<span class="sd">    ``reflect(normal)``</span>
<span class="sd">        Return the vector reflected about the given normal.  In two dimensions,</span>
<span class="sd">        *normal* is the normal to a line, in three dimensions it is the normal</span>
<span class="sd">        to a plane.  The normal must have unit length.  Example::</span>
<span class="sd">    </span>
<span class="sd">            &gt;&gt;&gt; v = Vector3(1., 2., 3.)</span>
<span class="sd">            &gt;&gt;&gt; v.reflect(Vector3(0, 1, 0))</span>
<span class="sd">            Vector3(1.00, -2.00, 3.00)</span>
<span class="sd">            &gt;&gt;&gt; v = Vector2(1., 2.)</span>
<span class="sd">            &gt;&gt;&gt; v.reflect(Vector2(1, 0))</span>
<span class="sd">            Vector2(-1.00, 2.00)</span>
<span class="sd">    </span>
<span class="sd">    ``rotate_around(axes, theta)``</span>
<span class="sd">        For 3D vectors, return the vector rotated around axis by the angle theta.</span>
<span class="sd">    </span>
<span class="sd">            &gt;&gt;&gt; v = Vector3(1., 2., 3.)</span>
<span class="sd">            &gt;&gt;&gt; axes = Vector3(1.,1.,0)</span>
<span class="sd">            &gt;&gt;&gt; v.rotate_around(axes,math.pi/4)</span>
<span class="sd">            Vector3(2.65, 0.35, 2.62)</span>
<span class="sd">    </span>
<span class="sd">    ``angle(other)``</span>
<span class="sd">        Return the angle between two vectors.</span>
<span class="sd">        </span>
<span class="sd">    ``project(other)``</span>
<span class="sd">        Return the projection (the component) of the vector on other.</span>
<span class="sd">    </span>
<span class="sd">    Tests for equality include comparing against other sequences::</span>
<span class="sd">    </span>
<span class="sd">        &gt;&gt;&gt; v2 = Vector2(1, 2)</span>
<span class="sd">        &gt;&gt;&gt; v2 == Vector2(3, 4)</span>
<span class="sd">        False</span>
<span class="sd">        &gt;&gt;&gt; v2 != Vector2(1, 2)</span>
<span class="sd">        False</span>
<span class="sd">        &gt;&gt;&gt; v2 == (1, 2)</span>
<span class="sd">        True</span>
<span class="sd">    </span>
<span class="sd">        &gt;&gt;&gt; v3 = Vector3(1, 2, 3)</span>
<span class="sd">        &gt;&gt;&gt; v3 == Vector3(3, 4, 5)</span>
<span class="sd">        False</span>
<span class="sd">        &gt;&gt;&gt; v3 != Vector3(1, 2, 3)</span>
<span class="sd">        False</span>
<span class="sd">        &gt;&gt;&gt; v3 == (1, 2, 3)</span>
<span class="sd">        True</span>
<span class="sd">    </span>
<span class="sd">    Vectors are not hashable, and hence cannot be put in sets nor used as</span>
<span class="sd">    dictionary keys::</span>
<span class="sd">    </span>
<span class="sd">        &gt;&gt;&gt; {Vector2(): 0}</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">            ...</span>
<span class="sd">        TypeError: unhashable type: &#39;Vector2&#39;</span>
<span class="sd">    </span>
<span class="sd">        &gt;&gt;&gt; {Vector3(): 0}</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">            ...</span>
<span class="sd">        TypeError: unhashable type: &#39;Vector3&#39;</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Vector2.__init__"><a class="viewcode-back" href="../modules/geom.html#geom.Vector2.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructor.</span>
<span class="sd">        :param *args: x,y values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">=</span><span class="n">argPair</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        </div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="Vector2.xy"><a class="viewcode-back" href="../modules/geom.html#geom.Vector2.xy">[docs]</a>    <span class="k">def</span> <span class="nf">xy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;:return: tuple (x,y)&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        </div>
<div class="viewcode-block" id="Vector2.__copy__"><a class="viewcode-back" href="../modules/geom.html#geom.Vector2.__copy__">[docs]</a>    <span class="k">def</span> <span class="nf">__copy__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xy</span><span class="p">)</span>
</div>
    <span class="n">copy</span> <span class="o">=</span> <span class="n">__copy__</span>

<div class="viewcode-block" id="Vector2.__repr__"><a class="viewcode-back" href="../modules/geom.html#geom.Vector2.__repr__">[docs]</a>    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">xy</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Vector2.__eq__"><a class="viewcode-back" href="../modules/geom.html#geom.Vector2.__eq__">[docs]</a>    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span> <span class="c">#quick</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">xy</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">xy</span> <span class="p">:</span> <span class="k">return</span> <span class="bp">True</span>
        <span class="k">except</span><span class="p">:</span> <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">==</span> <span class="n">other</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">==</span> <span class="n">other</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="k">return</span> <span class="bp">True</span>
        <span class="k">except</span><span class="p">:</span> <span class="k">pass</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">-</span><span class="n">Vector2</span><span class="p">(</span><span class="n">other</span><span class="p">))</span><span class="o">.</span><span class="n">mag</span><span class="p">()</span><span class="o">&lt;</span><span class="n">precision</span>
</div>
<div class="viewcode-block" id="Vector2.__ne__"><a class="viewcode-back" href="../modules/geom.html#geom.Vector2.__ne__">[docs]</a>    <span class="k">def</span> <span class="nf">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Vector2.__nonzero__"><a class="viewcode-back" href="../modules/geom.html#geom.Vector2.__nonzero__">[docs]</a>    <span class="k">def</span> <span class="nf">__nonzero__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">!=</span> <span class="mi">0</span>
</div>
<div class="viewcode-block" id="Vector2.__len__"><a class="viewcode-back" href="../modules/geom.html#geom.Vector2.__len__">[docs]</a>    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">2</span>
</div>
<div class="viewcode-block" id="Vector2.__iter__"><a class="viewcode-back" href="../modules/geom.html#geom.Vector2.__iter__">[docs]</a>    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xy</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Vector2.__add__"><a class="viewcode-back" href="../modules/geom.html#geom.Vector2.__add__">[docs]</a>    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Vector2</span><span class="p">):</span>
            <span class="c"># Vector + Vector -&gt; Vector</span>
            <span class="c"># Vector + Point -&gt; Point</span>
            <span class="c"># Point + Point -&gt; Vector</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span> <span class="ow">is</span> <span class="n">other</span><span class="o">.</span><span class="n">__class__</span><span class="p">:</span>
                <span class="n">_class</span> <span class="o">=</span> <span class="n">Vector2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_class</span> <span class="o">=</span> <span class="n">Point2</span>
            <span class="k">return</span> <span class="n">_class</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Vector2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">other</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">other</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span></div>
    <span class="n">__radd__</span> <span class="o">=</span> <span class="n">__add__</span>

<div class="viewcode-block" id="Vector2.__iadd__"><a class="viewcode-back" href="../modules/geom.html#geom.Vector2.__iadd__">[docs]</a>    <span class="k">def</span> <span class="nf">__iadd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Vector2</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="n">other</span><span class="o">.</span><span class="n">x</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">+=</span> <span class="n">other</span><span class="o">.</span><span class="n">y</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="n">other</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">+=</span> <span class="n">other</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span>
</div>
<div class="viewcode-block" id="Vector2.__sub__"><a class="viewcode-back" href="../modules/geom.html#geom.Vector2.__sub__">[docs]</a>    <span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Vector2</span><span class="p">):</span>
            <span class="c"># Vector - Vector -&gt; Vector</span>
            <span class="c"># Vector - Point -&gt; Point</span>
            <span class="c"># Point - Point -&gt; Vector</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span> <span class="ow">is</span> <span class="n">other</span><span class="o">.</span><span class="n">__class__</span><span class="p">:</span>
                <span class="n">_class</span> <span class="o">=</span> <span class="n">Vector2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_class</span> <span class="o">=</span> <span class="n">Point2</span>
            <span class="k">return</span> <span class="n">_class</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s">&#39;__len__&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
            <span class="k">return</span> <span class="n">Vector2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">other</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">other</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

   </div>
<div class="viewcode-block" id="Vector2.__rsub__"><a class="viewcode-back" href="../modules/geom.html#geom.Vector2.__rsub__">[docs]</a>    <span class="k">def</span> <span class="nf">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Vector2</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">Vector2</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
                           <span class="n">other</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s">&#39;__len__&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
            <span class="k">return</span> <span class="n">Vector2</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                           <span class="n">other</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="bp">self</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="Vector2.__mul__"><a class="viewcode-back" href="../modules/geom.html#geom.Vector2.__mul__">[docs]</a>    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Vector2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">other</span><span class="p">,</span>
                       <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">other</span><span class="p">)</span>
</div>
    <span class="n">__rmul__</span> <span class="o">=</span> <span class="n">__mul__</span>

<div class="viewcode-block" id="Vector2.__imul__"><a class="viewcode-back" href="../modules/geom.html#geom.Vector2.__imul__">[docs]</a>    <span class="k">def</span> <span class="nf">__imul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">*=</span> <span class="n">other</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">*=</span> <span class="n">other</span>
        <span class="k">return</span> <span class="bp">self</span>
</div>
<div class="viewcode-block" id="Vector2.__div__"><a class="viewcode-back" href="../modules/geom.html#geom.Vector2.__div__">[docs]</a>    <span class="k">def</span> <span class="nf">__div__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Vector2</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">other</span><span class="p">),</span>
                       <span class="n">operator</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="Vector2.__rdiv__"><a class="viewcode-back" href="../modules/geom.html#geom.Vector2.__rdiv__">[docs]</a>    <span class="k">def</span> <span class="nf">__rdiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Vector2</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">),</span>
                       <span class="n">operator</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Vector2.__floordiv__"><a class="viewcode-back" href="../modules/geom.html#geom.Vector2.__floordiv__">[docs]</a>    <span class="k">def</span> <span class="nf">__floordiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Vector2</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">floordiv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">other</span><span class="p">),</span>
                       <span class="n">operator</span><span class="o">.</span><span class="n">floordiv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="Vector2.__rfloordiv__"><a class="viewcode-back" href="../modules/geom.html#geom.Vector2.__rfloordiv__">[docs]</a>    <span class="k">def</span> <span class="nf">__rfloordiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Vector2</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">floordiv</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">),</span>
                       <span class="n">operator</span><span class="o">.</span><span class="n">floordiv</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Vector2.__truediv__"><a class="viewcode-back" href="../modules/geom.html#geom.Vector2.__truediv__">[docs]</a>    <span class="k">def</span> <span class="nf">__truediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Vector2</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">truediv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">other</span><span class="p">),</span>
                       <span class="n">operator</span><span class="o">.</span><span class="n">truediv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="Vector2.__rtruediv__"><a class="viewcode-back" href="../modules/geom.html#geom.Vector2.__rtruediv__">[docs]</a>    <span class="k">def</span> <span class="nf">__rtruediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Vector2</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">truediv</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">),</span>
                       <span class="n">operator</span><span class="o">.</span><span class="n">truediv</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
    </div>
<div class="viewcode-block" id="Vector2.__neg__"><a class="viewcode-back" href="../modules/geom.html#geom.Vector2.__neg__">[docs]</a>    <span class="k">def</span> <span class="nf">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Vector2</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
                        <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
</div>
    <span class="n">__pos__</span> <span class="o">=</span> <span class="n">__copy__</span>
    
<div class="viewcode-block" id="Vector2.__abs__"><a class="viewcode-back" href="../modules/geom.html#geom.Vector2.__abs__">[docs]</a>    <span class="k">def</span> <span class="nf">__abs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</div>
    <span class="n">mag</span> <span class="o">=</span> <span class="n">__abs__</span>
    
    <span class="n">length</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

<div class="viewcode-block" id="Vector2.mag2"><a class="viewcode-back" href="../modules/geom.html#geom.Vector2.mag2">[docs]</a>    <span class="k">def</span> <span class="nf">mag2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">**</span> <span class="mi">2</span>
</div>
<div class="viewcode-block" id="Vector2.normalize"><a class="viewcode-back" href="../modules/geom.html#geom.Vector2.normalize">[docs]</a>    <span class="k">def</span> <span class="nf">normalize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mag</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">d</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">/=</span> <span class="n">d</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">/=</span> <span class="n">d</span>
        <span class="k">return</span> <span class="bp">self</span>
</div>
<div class="viewcode-block" id="Vector2.normalized"><a class="viewcode-back" href="../modules/geom.html#geom.Vector2.normalized">[docs]</a>    <span class="k">def</span> <span class="nf">normalized</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mag</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">d</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Vector2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">/</span> <span class="n">d</span><span class="p">,</span> 
                           <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">/</span> <span class="n">d</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Vector2.dot"><a class="viewcode-back" href="../modules/geom.html#geom.Vector2.dot">[docs]</a>    <span class="k">def</span> <span class="nf">dot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Vector2</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">other</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">other</span><span class="o">.</span><span class="n">y</span>
</div>
<div class="viewcode-block" id="Vector2.cross"><a class="viewcode-back" href="../modules/geom.html#geom.Vector2.cross">[docs]</a>    <span class="k">def</span> <span class="nf">cross</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Vector2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Vector2.reflect"><a class="viewcode-back" href="../modules/geom.html#geom.Vector2.reflect">[docs]</a>    <span class="k">def</span> <span class="nf">reflect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">normal</span><span class="p">):</span>
        <span class="c"># assume normal is normalized</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span> <span class="n">Vector2</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">normal</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">normal</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Vector2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">d</span> <span class="o">*</span> <span class="n">normal</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
                       <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">d</span> <span class="o">*</span> <span class="n">normal</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Vector2.angle"><a class="viewcode-back" href="../modules/geom.html#geom.Vector2.angle">[docs]</a>    <span class="k">def</span> <span class="nf">angle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the angle to the vector other&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">other</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">acos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mag</span><span class="p">()</span><span class="o">*</span><span class="n">other</span><span class="o">.</span><span class="n">mag</span><span class="p">()))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">atan2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Vector2.project"><a class="viewcode-back" href="../modules/geom.html#geom.Vector2.project">[docs]</a>    <span class="k">def</span> <span class="nf">project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return one vector projected on the vector other&quot;&quot;&quot;</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">normalized</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">*</span><span class="n">n</span>
</div></div>
<div class="viewcode-block" id="Vector3"><a class="viewcode-back" href="../modules/geom.html#geom.Vector3">[docs]</a><span class="k">class</span> <span class="nc">Vector3</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

<div class="viewcode-block" id="Vector3.__init__"><a class="viewcode-back" href="../modules/geom.html#geom.Vector3.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructor.</span>
<span class="sd">        :param *args: x,y,z values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span><span class="n">z</span> <span class="o">=</span> <span class="n">args</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">z</span>
        </div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="Vector3.xyz"><a class="viewcode-back" href="../modules/geom.html#geom.Vector3.xyz">[docs]</a>    <span class="k">def</span> <span class="nf">xyz</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;:return: tuple (x,y,z)&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Vector3.__copy__"><a class="viewcode-back" href="../modules/geom.html#geom.Vector3.__copy__">[docs]</a>    <span class="k">def</span> <span class="nf">__copy__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xyz</span><span class="p">)</span>
</div>
    <span class="n">copy</span> <span class="o">=</span> <span class="n">__copy__</span>

<div class="viewcode-block" id="Vector3.__repr__"><a class="viewcode-back" href="../modules/geom.html#geom.Vector3.__repr__">[docs]</a>    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">xyz</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Vector3.__eq__"><a class="viewcode-back" href="../modules/geom.html#geom.Vector3.__eq__">[docs]</a>    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Vector3</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">xyz</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">xyz</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s">&#39;__len__&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">==</span> <span class="n">other</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> \
                   <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">==</span> <span class="n">other</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> \
                   <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">==</span> <span class="n">other</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="Vector3.__ne__"><a class="viewcode-back" href="../modules/geom.html#geom.Vector3.__ne__">[docs]</a>    <span class="k">def</span> <span class="nf">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Vector3.__nonzero__"><a class="viewcode-back" href="../modules/geom.html#geom.Vector3.__nonzero__">[docs]</a>    <span class="k">def</span> <span class="nf">__nonzero__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">!=</span> <span class="mi">0</span>
</div>
<div class="viewcode-block" id="Vector3.__len__"><a class="viewcode-back" href="../modules/geom.html#geom.Vector3.__len__">[docs]</a>    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">3</span>
</div>
<div class="viewcode-block" id="Vector3.__iter__"><a class="viewcode-back" href="../modules/geom.html#geom.Vector3.__iter__">[docs]</a>    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xyz</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Vector3.__add__"><a class="viewcode-back" href="../modules/geom.html#geom.Vector3.__add__">[docs]</a>    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Vector3</span><span class="p">):</span>
            <span class="c"># Vector + Vector -&gt; Vector</span>
            <span class="c"># Vector + Point -&gt; Point</span>
            <span class="c"># Point + Point -&gt; Vector</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span> <span class="ow">is</span> <span class="n">other</span><span class="o">.</span><span class="n">__class__</span><span class="p">:</span>
                <span class="n">_class</span> <span class="o">=</span> <span class="n">Vector3</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_class</span> <span class="o">=</span> <span class="n">Point3</span>
            <span class="k">return</span> <span class="n">_class</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Vector3</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">other</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">other</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">+</span> <span class="n">other</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span></div>
    <span class="n">__radd__</span> <span class="o">=</span> <span class="n">__add__</span>

<div class="viewcode-block" id="Vector3.__iadd__"><a class="viewcode-back" href="../modules/geom.html#geom.Vector3.__iadd__">[docs]</a>    <span class="k">def</span> <span class="nf">__iadd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Vector3</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="n">other</span><span class="o">.</span><span class="n">x</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">+=</span> <span class="n">other</span><span class="o">.</span><span class="n">y</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">+=</span> <span class="n">other</span><span class="o">.</span><span class="n">z</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="n">other</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">+=</span> <span class="n">other</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">+=</span> <span class="n">other</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span>
</div>
<div class="viewcode-block" id="Vector3.__sub__"><a class="viewcode-back" href="../modules/geom.html#geom.Vector3.__sub__">[docs]</a>    <span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Vector3</span><span class="p">):</span>
            <span class="c"># Vector - Vector -&gt; Vector</span>
            <span class="c"># Vector - Point -&gt; Point</span>
            <span class="c"># Point - Point -&gt; Vector</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span> <span class="ow">is</span> <span class="n">other</span><span class="o">.</span><span class="n">__class__</span><span class="p">:</span>
                <span class="n">_class</span> <span class="o">=</span> <span class="n">Vector3</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_class</span> <span class="o">=</span> <span class="n">Point3</span>
            <span class="k">return</span> <span class="n">Vector3</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s">&#39;__len__&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span>
            <span class="k">return</span> <span class="n">Vector3</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">other</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">other</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">-</span> <span class="n">other</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

   </div>
<div class="viewcode-block" id="Vector3.__rsub__"><a class="viewcode-back" href="../modules/geom.html#geom.Vector3.__rsub__">[docs]</a>    <span class="k">def</span> <span class="nf">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Vector3</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">Vector3</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
                           <span class="n">other</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
                           <span class="n">other</span><span class="o">.</span><span class="n">z</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s">&#39;__len__&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span>
            <span class="k">return</span> <span class="n">Vector3</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                           <span class="n">other</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="bp">self</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                           <span class="n">other</span><span class="o">.</span><span class="n">z</span> <span class="o">-</span> <span class="bp">self</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="Vector3.__mul__"><a class="viewcode-back" href="../modules/geom.html#geom.Vector3.__mul__">[docs]</a>    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Vector3</span><span class="p">):</span>
            <span class="c"># TODO component-wise mul/div in-place and on Vector2; docs.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span> <span class="ow">is</span> <span class="n">Point3</span> <span class="ow">or</span> <span class="n">other</span><span class="o">.</span><span class="n">__class__</span> <span class="ow">is</span> <span class="n">Point3</span><span class="p">:</span>
                <span class="n">_class</span> <span class="o">=</span> <span class="n">Point3</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_class</span> <span class="o">=</span> <span class="n">Vector3</span>
            <span class="k">return</span> <span class="n">_class</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">other</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">other</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">*</span> <span class="n">other</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">Vector3</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">other</span><span class="p">,</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">other</span><span class="p">,</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">*</span> <span class="n">other</span><span class="p">)</span>
</div>
    <span class="n">__rmul__</span> <span class="o">=</span> <span class="n">__mul__</span>

<div class="viewcode-block" id="Vector3.__imul__"><a class="viewcode-back" href="../modules/geom.html#geom.Vector3.__imul__">[docs]</a>    <span class="k">def</span> <span class="nf">__imul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">*=</span> <span class="n">other</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">*=</span> <span class="n">other</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">*=</span> <span class="n">other</span>
        <span class="k">return</span> <span class="bp">self</span>
</div>
<div class="viewcode-block" id="Vector3.__div__"><a class="viewcode-back" href="../modules/geom.html#geom.Vector3.__div__">[docs]</a>    <span class="k">def</span> <span class="nf">__div__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Vector3</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">other</span><span class="p">),</span>
                       <span class="n">operator</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">other</span><span class="p">),</span>
                       <span class="n">operator</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="Vector3.__rdiv__"><a class="viewcode-back" href="../modules/geom.html#geom.Vector3.__rdiv__">[docs]</a>    <span class="k">def</span> <span class="nf">__rdiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Vector3</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">),</span>
                       <span class="n">operator</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">),</span>
                       <span class="n">operator</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Vector3.__floordiv__"><a class="viewcode-back" href="../modules/geom.html#geom.Vector3.__floordiv__">[docs]</a>    <span class="k">def</span> <span class="nf">__floordiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Vector3</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">floordiv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">other</span><span class="p">),</span>
                       <span class="n">operator</span><span class="o">.</span><span class="n">floordiv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">other</span><span class="p">),</span>
                       <span class="n">operator</span><span class="o">.</span><span class="n">floordiv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="Vector3.__rfloordiv__"><a class="viewcode-back" href="../modules/geom.html#geom.Vector3.__rfloordiv__">[docs]</a>    <span class="k">def</span> <span class="nf">__rfloordiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Vector3</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">floordiv</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">),</span>
                       <span class="n">operator</span><span class="o">.</span><span class="n">floordiv</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">),</span>
                       <span class="n">operator</span><span class="o">.</span><span class="n">floordiv</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Vector3.__truediv__"><a class="viewcode-back" href="../modules/geom.html#geom.Vector3.__truediv__">[docs]</a>    <span class="k">def</span> <span class="nf">__truediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Vector3</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">truediv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">other</span><span class="p">),</span>
                       <span class="n">operator</span><span class="o">.</span><span class="n">truediv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">other</span><span class="p">),</span>
                       <span class="n">operator</span><span class="o">.</span><span class="n">truediv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="Vector3.__rtruediv__"><a class="viewcode-back" href="../modules/geom.html#geom.Vector3.__rtruediv__">[docs]</a>    <span class="k">def</span> <span class="nf">__rtruediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Vector3</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">truediv</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">),</span>
                       <span class="n">operator</span><span class="o">.</span><span class="n">truediv</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">),</span>
                       <span class="n">operator</span><span class="o">.</span><span class="n">truediv</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">))</span>
    </div>
<div class="viewcode-block" id="Vector3.__neg__"><a class="viewcode-back" href="../modules/geom.html#geom.Vector3.__neg__">[docs]</a>    <span class="k">def</span> <span class="nf">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Vector3</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
                        <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
                        <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>
</div>
    <span class="n">__pos__</span> <span class="o">=</span> <span class="n">__copy__</span>
    
<div class="viewcode-block" id="Vector3.__abs__"><a class="viewcode-back" href="../modules/geom.html#geom.Vector3.__abs__">[docs]</a>    <span class="k">def</span> <span class="nf">__abs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> \
                         <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> \
                         <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</div>
    <span class="n">mag</span> <span class="o">=</span> <span class="n">__abs__</span>

<div class="viewcode-block" id="Vector3.mag2"><a class="viewcode-back" href="../modules/geom.html#geom.Vector3.mag2">[docs]</a>    <span class="k">def</span> <span class="nf">mag2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> \
               <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> \
               <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">**</span> <span class="mi">2</span>
</div>
<div class="viewcode-block" id="Vector3.normalize"><a class="viewcode-back" href="../modules/geom.html#geom.Vector3.normalize">[docs]</a>    <span class="k">def</span> <span class="nf">normalize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mag</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">d</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">/=</span> <span class="n">d</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">/=</span> <span class="n">d</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">/=</span> <span class="n">d</span>
        <span class="k">return</span> <span class="bp">self</span>
</div>
<div class="viewcode-block" id="Vector3.normalized"><a class="viewcode-back" href="../modules/geom.html#geom.Vector3.normalized">[docs]</a>    <span class="k">def</span> <span class="nf">normalized</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mag</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">d</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Vector3</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">/</span> <span class="n">d</span><span class="p">,</span> 
                           <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">/</span> <span class="n">d</span><span class="p">,</span> 
                           <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">/</span> <span class="n">d</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Vector3.dot"><a class="viewcode-back" href="../modules/geom.html#geom.Vector3.dot">[docs]</a>    <span class="k">def</span> <span class="nf">dot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Vector3</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">other</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> \
               <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">other</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> \
               <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">*</span> <span class="n">other</span><span class="o">.</span><span class="n">z</span>
</div>
<div class="viewcode-block" id="Vector3.cross"><a class="viewcode-back" href="../modules/geom.html#geom.Vector3.cross">[docs]</a>    <span class="k">def</span> <span class="nf">cross</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Vector3</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Vector3</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">other</span><span class="o">.</span><span class="n">z</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">*</span> <span class="n">other</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
                       <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">other</span><span class="o">.</span><span class="n">z</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">*</span> <span class="n">other</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
                       <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">other</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">other</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Vector3.reflect"><a class="viewcode-back" href="../modules/geom.html#geom.Vector3.reflect">[docs]</a>    <span class="k">def</span> <span class="nf">reflect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">normal</span><span class="p">):</span>
        <span class="c"># assume normal is normalized</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span> <span class="n">Vector3</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">normal</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">normal</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">*</span> <span class="n">normal</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Vector3</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">d</span> <span class="o">*</span> <span class="n">normal</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
                       <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">d</span> <span class="o">*</span> <span class="n">normal</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
                       <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">-</span> <span class="n">d</span> <span class="o">*</span> <span class="n">normal</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Vector3.rotate_around"><a class="viewcode-back" href="../modules/geom.html#geom.Vector3.rotate_around">[docs]</a>    <span class="k">def</span> <span class="nf">rotate_around</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">theta</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the vector rotated around axis through angle theta. Right hand rule applies&quot;&quot;&quot;</span>

        <span class="c"># Adapted from equations published by Glenn Murray.</span>
        <span class="c"># http://inside.mines.edu/~gmurray/ArbitraryAxisRotation/ArbitraryAxisRotation.html</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span>
        <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">axis</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">axis</span><span class="o">.</span><span class="n">z</span>

        <span class="c"># Extracted common factors for simplicity and efficiency</span>
        <span class="n">r2</span> <span class="o">=</span> <span class="n">u</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">v</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">w</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">r2</span><span class="p">)</span>
        <span class="n">ct</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="n">st</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">/</span> <span class="n">r</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="p">(</span><span class="n">u</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">v</span><span class="o">*</span><span class="n">y</span> <span class="o">+</span> <span class="n">w</span><span class="o">*</span><span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">ct</span><span class="p">)</span> <span class="o">/</span> <span class="n">r2</span>
        <span class="k">return</span> <span class="n">Vector3</span><span class="p">((</span><span class="n">u</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">+</span> <span class="n">x</span> <span class="o">*</span> <span class="n">ct</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="n">w</span> <span class="o">*</span> <span class="n">y</span> <span class="o">+</span> <span class="n">v</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">st</span><span class="p">),</span>
                       <span class="p">(</span><span class="n">v</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="n">ct</span> <span class="o">+</span> <span class="p">(</span> <span class="n">w</span> <span class="o">*</span> <span class="n">x</span> <span class="o">-</span> <span class="n">u</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">st</span><span class="p">),</span>
                       <span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="n">ct</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="n">v</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">u</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span> <span class="o">*</span> <span class="n">st</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Vector3.angle"><a class="viewcode-back" href="../modules/geom.html#geom.Vector3.angle">[docs]</a>    <span class="k">def</span> <span class="nf">angle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the angle to the vector other&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">acos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mag</span><span class="p">()</span><span class="o">*</span><span class="n">other</span><span class="o">.</span><span class="n">mag</span><span class="p">()))</span>
</div>
<div class="viewcode-block" id="Vector3.project"><a class="viewcode-back" href="../modules/geom.html#geom.Vector3.project">[docs]</a>    <span class="k">def</span> <span class="nf">project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return one vector projected on the vector other&quot;&quot;&quot;</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">normalized</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">*</span><span class="n">n</span>

</div></div>
<div class="viewcode-block" id="Matrix3"><a class="viewcode-back" href="../modules/geom.html#geom.Matrix3">[docs]</a><span class="k">class</span> <span class="nc">Matrix3</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Two matrix classes are supplied, *Matrix3*, a 3x3 matrix for working with 2D</span>
<span class="sd">    affine transformations, and *Matrix4*, a 4x4 matrix for working with 3D</span>
<span class="sd">    affine transformations.</span>
<span class="sd">    </span>
<span class="sd">    The default constructor intializes the matrix to the identity::</span>
<span class="sd">    </span>
<span class="sd">        &gt;&gt;&gt; Matrix3()</span>
<span class="sd">        Matrix3([    1.00     0.00     0.00</span>
<span class="sd">                     0.00     1.00     0.00</span>
<span class="sd">                     0.00     0.00     1.00])</span>
<span class="sd">        &gt;&gt;&gt; Matrix4()</span>
<span class="sd">        Matrix4([    1.00     0.00     0.00     0.00</span>
<span class="sd">                     0.00     1.00     0.00     0.00</span>
<span class="sd">                     0.00     0.00     1.00     0.00</span>
<span class="sd">                     0.00     0.00     0.00     1.00])</span>
<span class="sd">    </span>
<span class="sd">    **Element access**</span>
<span class="sd">    </span>
<span class="sd">    Internally each matrix is stored as a set of attributes named ``a`` to ``p``.</span>
<span class="sd">    The layout for Matrix3 is::</span>
<span class="sd">    </span>
<span class="sd">        # a b c </span>
<span class="sd">        # e f g </span>
<span class="sd">        # i j k </span>
<span class="sd">    </span>
<span class="sd">    and for Matrix4::</span>
<span class="sd">    </span>
<span class="sd">        # a b c d</span>
<span class="sd">        # e f g h</span>
<span class="sd">        # i j k l</span>
<span class="sd">        # m n o p</span>
<span class="sd">    </span>
<span class="sd">    If you wish to set or retrieve a number of elements at once, you can</span>
<span class="sd">    do so with a slice::</span>
<span class="sd">    </span>
<span class="sd">        &gt;&gt;&gt; m = Matrix4()</span>
<span class="sd">        &gt;&gt;&gt; m[:]</span>
<span class="sd">        [1.0, 0, 0, 0, 0, 1.0, 0, 0, 0, 0, 1.0, 0, 0, 0, 0, 1.0]</span>
<span class="sd">        &gt;&gt;&gt; m[12:15] = (5, 5, 5)</span>
<span class="sd">        &gt;&gt;&gt; m</span>
<span class="sd">        Matrix4([    1.00     0.00     0.00     5.00</span>
<span class="sd">                     0.00     1.00     0.00     5.00</span>
<span class="sd">                     0.00     0.00     1.00     5.00</span>
<span class="sd">                     0.00     0.00     0.00     1.00])</span>
<span class="sd">    </span>
<span class="sd">    Note that slices operate in column-major order, which makes them</span>
<span class="sd">    suitable for working directly with OpenGL&#39;s ``glLoadMatrix`` and</span>
<span class="sd">    ``glGetFloatv`` functions.</span>
<span class="sd">    </span>
<span class="sd">    **Class constructors**</span>
<span class="sd">    </span>
<span class="sd">    There are class constructors for the most common types of transform.</span>
<span class="sd">    </span>
<span class="sd">    ``new_identity``</span>
<span class="sd">        Equivalent to the default constructor.  Example::</span>
<span class="sd">    </span>
<span class="sd">            &gt;&gt;&gt; m = Matrix4.new_identity()</span>
<span class="sd">            &gt;&gt;&gt; m</span>
<span class="sd">            Matrix4([    1.00     0.00     0.00     0.00</span>
<span class="sd">                         0.00     1.00     0.00     0.00</span>
<span class="sd">                         0.00     0.00     1.00     0.00</span>
<span class="sd">                         0.00     0.00     0.00     1.00])</span>
<span class="sd">    </span>
<span class="sd">    ``new_scale(x, y)`` and ``new_scale(x, y, z)``</span>
<span class="sd">        The former is defined on **Matrix3**, the latter on **Matrix4**.</span>
<span class="sd">        Equivalent to the OpenGL call ``glScalef``.</span>
<span class="sd">        Example::</span>
<span class="sd">    </span>
<span class="sd">            &gt;&gt;&gt; m = Matrix4.new_scale(2.0, 3.0, 4.0)</span>
<span class="sd">            &gt;&gt;&gt; m</span>
<span class="sd">            Matrix4([    2.00     0.00     0.00     0.00</span>
<span class="sd">                         0.00     3.00     0.00     0.00</span>
<span class="sd">                         0.00     0.00     4.00     0.00</span>
<span class="sd">                         0.00     0.00     0.00     1.00])</span>
<span class="sd">        </span>
<span class="sd">    ``new_translate(x, y)`` and ``new_translate(x, y, z)``</span>
<span class="sd">        The former is defined on **Matrix3**, the latter on **Matrix4**.</span>
<span class="sd">        Equivalent to the OpenGL call ``glTranslatef``.</span>
<span class="sd">        Example::</span>
<span class="sd">    </span>
<span class="sd">            &gt;&gt;&gt; m = Matrix4.new_translate(3.0, 4.0, 5.0)</span>
<span class="sd">            &gt;&gt;&gt; m</span>
<span class="sd">            Matrix4([    1.00     0.00     0.00     3.00</span>
<span class="sd">                         0.00     1.00     0.00     4.00</span>
<span class="sd">                         0.00     0.00     1.00     5.00</span>
<span class="sd">                         0.00     0.00     0.00     1.00])</span>
<span class="sd">    </span>
<span class="sd">    ``new_rotate(angle)``</span>
<span class="sd">        Create a **Matrix3** for a rotation around the origin.  *angle* is</span>
<span class="sd">        specified in radians, anti-clockwise.  This is not implemented in</span>
<span class="sd">        **Matrix4** (see below for equivalent methods).</span>
<span class="sd">        Example::</span>
<span class="sd">    </span>
<span class="sd">            &gt;&gt;&gt; import math</span>
<span class="sd">            &gt;&gt;&gt; m = Matrix3.new_rotate(math.pi / 2)</span>
<span class="sd">            &gt;&gt;&gt; m</span>
<span class="sd">            Matrix3([    0.00    -1.00     0.00</span>
<span class="sd">                         1.00     0.00     0.00</span>
<span class="sd">                         0.00     0.00     1.00])</span>
<span class="sd">    </span>
<span class="sd">    The following constructors are defined for **Matrix4** only.</span>
<span class="sd">    </span>
<span class="sd">    ``new``</span>
<span class="sd">        Construct a matrix with 16 values in column-major order.</span>
<span class="sd">    </span>
<span class="sd">    ``new_rotatex(angle)``, ``new_rotatey(angle)``, ``new_rotatez(angle)``</span>
<span class="sd">        Create a **Matrix4** for a rotation around the X, Y or Z axis, respectively.</span>
<span class="sd">        *angle* is specified in radians.  Example::</span>
<span class="sd">    </span>
<span class="sd">            &gt;&gt;&gt; m = Matrix4.new_rotatex(math.pi / 2)</span>
<span class="sd">            &gt;&gt;&gt; m</span>
<span class="sd">            Matrix4([    1.00     0.00     0.00     0.00</span>
<span class="sd">                         0.00     0.00    -1.00     0.00</span>
<span class="sd">                         0.00     1.00     0.00     0.00</span>
<span class="sd">                         0.00     0.00     0.00     1.00])</span>
<span class="sd">    </span>
<span class="sd">    ``new_rotate_axis(angle, axis)``</span>
<span class="sd">        Create a **Matrix4** for a rotation around the given axis.  *angle*</span>
<span class="sd">        is specified in radians, and *axis* must be an instance of **Vector3**.</span>
<span class="sd">        It is not necessary to normalize the axis.  Example::</span>
<span class="sd">    </span>
<span class="sd">            &gt;&gt;&gt; m = Matrix4.new_rotate_axis(math.pi / 2, Vector3(1.0, 0.0, 0.0))</span>
<span class="sd">            &gt;&gt;&gt; m        </span>
<span class="sd">            Matrix4([    1.00     0.00     0.00     0.00</span>
<span class="sd">                         0.00     0.00    -1.00     0.00</span>
<span class="sd">                         0.00     1.00     0.00     0.00</span>
<span class="sd">                         0.00     0.00     0.00     1.00])</span>
<span class="sd">    </span>
<span class="sd">    ``new_rotate_euler(heading, attitude, bank)``</span>
<span class="sd">        Create a **Matrix4** for the given Euler rotation.  *heading* is a rotation</span>
<span class="sd">        around the Y axis, *attitude* around the X axis and *bank* around the Z</span>
<span class="sd">        axis.  All rotations are performed simultaneously, so this method avoids</span>
<span class="sd">        &quot;gimbal lock&quot; and is the usual method for implemented 3D rotations in a</span>
<span class="sd">        game.  Example::</span>
<span class="sd">    </span>
<span class="sd">            &gt;&gt;&gt; m = Matrix4.new_rotate_euler(math.pi / 2, math.pi / 2, 0.0)</span>
<span class="sd">            &gt;&gt;&gt; m</span>
<span class="sd">            Matrix4([    0.00    -0.00     1.00     0.00</span>
<span class="sd">                         1.00     0.00    -0.00     0.00</span>
<span class="sd">                        -0.00     1.00     0.00     0.00</span>
<span class="sd">                         0.00     0.00     0.00     1.00])</span>
<span class="sd">    </span>
<span class="sd">    ``new_perspective(fov_y, aspect, near, far)``</span>
<span class="sd">        Create a **Matrix4** for projection onto the 2D viewing plane.  This</span>
<span class="sd">        method is equivalent to the OpenGL call ``gluPerspective``.  *fov_y* is</span>
<span class="sd">        the view angle in the Y direction, in radians.  *aspect* is the aspect</span>
<span class="sd">        ration *width* / *height* of the viewing plane.  *near* and *far* are</span>
<span class="sd">        the distance to the near and far clipping planes.  They must be</span>
<span class="sd">        positive and non-zero.  Example::</span>
<span class="sd">    </span>
<span class="sd">            &gt;&gt;&gt; m = Matrix4.new_perspective(math.pi / 2, 1024.0 / 768, 1.0, 100.0)</span>
<span class="sd">            &gt;&gt;&gt; m</span>
<span class="sd">            Matrix4([    0.75     0.00     0.00     0.00</span>
<span class="sd">                         0.00     1.00     0.00     0.00</span>
<span class="sd">                         0.00     0.00    -1.02    -2.02</span>
<span class="sd">                         0.00     0.00    -1.00     0.00])</span>
<span class="sd">    </span>
<span class="sd">    **Operators**</span>
<span class="sd">    </span>
<span class="sd">    Matrices of the same dimension may be multiplied to give a new matrix.</span>
<span class="sd">    For example, to create a transform which translates and scales::</span>
<span class="sd">    </span>
<span class="sd">        &gt;&gt;&gt; m1 = Matrix3.new_translate(5.0, 6.0)</span>
<span class="sd">        &gt;&gt;&gt; m2 = Matrix3.new_scale(1.0, 2.0)</span>
<span class="sd">        &gt;&gt;&gt; m1 * m2</span>
<span class="sd">        Matrix3([    1.00     0.00     5.00</span>
<span class="sd">                     0.00     2.00     6.00</span>
<span class="sd">                     0.00     0.00     1.00])</span>
<span class="sd">    </span>
<span class="sd">    Note that multiplication is not commutative (the order that you apply</span>
<span class="sd">    transforms matters)::</span>
<span class="sd">    </span>
<span class="sd">        &gt;&gt;&gt; m2 * m1</span>
<span class="sd">        Matrix3([    1.00     0.00     5.00</span>
<span class="sd">                     0.00     2.00    12.00</span>
<span class="sd">                     0.00     0.00     1.00])</span>
<span class="sd">    </span>
<span class="sd">    In-place multiplication is also permitted (and optimised)::</span>
<span class="sd">    </span>
<span class="sd">        &gt;&gt;&gt; m1 *= m2</span>
<span class="sd">        &gt;&gt;&gt; m1</span>
<span class="sd">        Matrix3([    1.00     0.00     5.00</span>
<span class="sd">                     0.00     2.00     6.00</span>
<span class="sd">                     0.00     0.00     1.00])</span>
<span class="sd">    </span>
<span class="sd">    Multiplying a matrix by a vector returns a vector, and is used to</span>
<span class="sd">    transform a vector::</span>
<span class="sd">    </span>
<span class="sd">        &gt;&gt;&gt; m1 = Matrix3.new_rotate(math.pi / 2)</span>
<span class="sd">        &gt;&gt;&gt; m1 * Vector2(1.0, 1.0)</span>
<span class="sd">        Vector2(-1.00, 1.00)</span>
<span class="sd">    </span>
<span class="sd">    Note that translations have no effect on vectors.  They do affect</span>
<span class="sd">    points, however::</span>
<span class="sd">    </span>
<span class="sd">        &gt;&gt;&gt; m1 = Matrix3.new_translate(5.0, 6.0)</span>
<span class="sd">        &gt;&gt;&gt; m1 * Vector2(1.0, 2.0)</span>
<span class="sd">        Vector2(1.00, 2.00)</span>
<span class="sd">        &gt;&gt;&gt; m1 * Point2(1.0, 2.0)</span>
<span class="sd">        Point2(6.00, 8.00)</span>
<span class="sd">    </span>
<span class="sd">    Multiplication is currently incorrect between matrices and vectors -- the</span>
<span class="sd">    projection component is ignored.  Use the **Matrix4.transform** method</span>
<span class="sd">    instead.</span>
<span class="sd">    </span>
<span class="sd">    Matrix4 also defines **transpose** (in-place), **transposed** (functional),</span>
<span class="sd">    **determinant** and **inverse** (functional) methods.</span>
<span class="sd">    </span>
<span class="sd">    A **Matrix3** can be multiplied with a **Vector2** or any of the 2D geometry</span>
<span class="sd">    objects (**Point2**, **Line2**, **Circle**, etc).  </span>
<span class="sd">    </span>
<span class="sd">    A **Matrix4** can be multiplied with a **Vector3** or any of the 3D geometry</span>
<span class="sd">    objects (**Point3**, **Line3**, **Sphere**, etc).</span>
<span class="sd">    </span>
<span class="sd">    For convenience, each of the matrix constructors are also available as</span>
<span class="sd">    in-place operators.  For example, instead of writing::</span>
<span class="sd">    </span>
<span class="sd">        &gt;&gt;&gt; m1 = Matrix3.new_translate(5.0, 6.0)</span>
<span class="sd">        &gt;&gt;&gt; m2 = Matrix3.new_scale(1.0, 2.0)</span>
<span class="sd">        &gt;&gt;&gt; m1 *= m2</span>
<span class="sd">    </span>
<span class="sd">    you can apply the scale directly to *m1*::</span>
<span class="sd">    </span>
<span class="sd">        &gt;&gt;&gt; m1 = Matrix3.new_translate(5.0, 6.0)</span>
<span class="sd">        &gt;&gt;&gt; m1.scale(1.0, 2.0)</span>
<span class="sd">        Matrix3([    1.00     0.00     5.00</span>
<span class="sd">                     0.00     2.00     6.00</span>
<span class="sd">                     0.00     0.00     1.00])</span>
<span class="sd">        &gt;&gt;&gt; m1</span>
<span class="sd">        Matrix3([    1.00     0.00     5.00</span>
<span class="sd">                     0.00     2.00     6.00</span>
<span class="sd">                     0.00     0.00     1.00])</span>
<span class="sd">    </span>
<span class="sd">    Note that these methods operate in-place (they modify the original matrix),</span>
<span class="sd">    and they also return themselves as a result.  This allows you to chain</span>
<span class="sd">    transforms together directly::</span>
<span class="sd">    </span>
<span class="sd">        &gt;&gt;&gt; Matrix3().translate(1.0, 2.0).rotate(math.pi / 2).scale(4.0, 4.0)</span>
<span class="sd">        Matrix3([    0.00    -4.00     1.00</span>
<span class="sd">                     4.00     0.00     2.00</span>
<span class="sd">                     0.00     0.00     1.00])</span>
<span class="sd">    </span>
<span class="sd">    All constructors have an equivalent in-place method.  For **Matrix3**, they</span>
<span class="sd">    are ``identity``, ``translate``, ``scale`` and ``rotate``.  For **Matrix4**,</span>
<span class="sd">    they are ``identity``, ``translate``, ``scale``, ``rotatex``, ``rotatey``, </span>
<span class="sd">    ``rotatez``, ``rotate_axis`` and ``rotate_euler``.  Both **Matrix3** and</span>
<span class="sd">    **Matrix4** also have an in-place ``transpose`` method.</span>
<span class="sd">    </span>
<span class="sd">    The ``copy`` method is also implemented in both matrix classes and</span>
<span class="sd">    behaves in the obvious way.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Matrix3.__init__"><a class="viewcode-back" href="../modules/geom.html#geom.Matrix3.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">identity</span><span class="p">()</span>
        </div>
<div class="viewcode-block" id="Matrix3.__copy__"><a class="viewcode-back" href="../modules/geom.html#geom.Matrix3.__copy__">[docs]</a>    <span class="k">def</span> <span class="nf">__copy__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Matrix3</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="p">[:])</span>
</div>
    <span class="n">copy</span> <span class="o">=</span> <span class="n">__copy__</span>
<div class="viewcode-block" id="Matrix3.__repr__"><a class="viewcode-back" href="../modules/geom.html#geom.Matrix3.__repr__">[docs]</a>    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">t</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">transposed</span><span class="p">()</span> <span class="c">#repr is by line while [:] is by column</span>
        <span class="k">return</span> <span class="p">(</span><span class="s">&#39;</span><span class="si">%s%s</span><span class="s">&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span><span class="nb">tuple</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Matrix3.__getitem__"><a class="viewcode-back" href="../modules/geom.html#geom.Matrix3.__getitem__">[docs]</a>    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">e</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">i</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">j</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">g</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">][</span><span class="n">key</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="Matrix3.__setitem__"><a class="viewcode-back" href="../modules/geom.html#geom.Matrix3.__setitem__">[docs]</a>    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">L</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[:]</span>
        <span class="n">L</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">e</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">i</span><span class="p">,</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">j</span><span class="p">,</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">g</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">L</span>
         </div>
<div class="viewcode-block" id="Matrix3.__eq__"><a class="viewcode-back" href="../modules/geom.html#geom.Matrix3.__eq__">[docs]</a>    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">==</span><span class="nb">list</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
    </div>
<div class="viewcode-block" id="Matrix3.__sub__"><a class="viewcode-back" href="../modules/geom.html#geom.Matrix3.__sub__">[docs]</a>    <span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Matrix3</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">ai</span><span class="o">-</span><span class="n">bi</span> <span class="k">for</span> <span class="n">ai</span><span class="p">,</span><span class="n">bi</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="p">[:],</span><span class="n">other</span><span class="p">[:])))</span>
</div>
<div class="viewcode-block" id="Matrix3.__mul__"><a class="viewcode-back" href="../modules/geom.html#geom.Matrix3.__mul__">[docs]</a>    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Matrix3</span><span class="p">):</span>
            <span class="c"># Caching repeatedly accessed attributes in local variables</span>
            <span class="c"># apparently increases performance by 20%.  Attrib: Will McGugan.</span>
            <span class="n">Aa</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span>
            <span class="n">Ab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span>
            <span class="n">Ac</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>
            <span class="n">Ae</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">e</span>
            <span class="n">Af</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span>
            <span class="n">Ag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">g</span>
            <span class="n">Ai</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">i</span>
            <span class="n">Aj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">j</span>
            <span class="n">Ak</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span>
            <span class="n">Ba</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">a</span>
            <span class="n">Bb</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">b</span>
            <span class="n">Bc</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">c</span>
            <span class="n">Be</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">e</span>
            <span class="n">Bf</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">f</span>
            <span class="n">Bg</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">g</span>
            <span class="n">Bi</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">i</span>
            <span class="n">Bj</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">j</span>
            <span class="n">Bk</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">k</span>
            <span class="n">C</span> <span class="o">=</span> <span class="n">Matrix3</span><span class="p">()</span>
            <span class="n">C</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">Aa</span> <span class="o">*</span> <span class="n">Ba</span> <span class="o">+</span> <span class="n">Ab</span> <span class="o">*</span> <span class="n">Be</span> <span class="o">+</span> <span class="n">Ac</span> <span class="o">*</span> <span class="n">Bi</span>
            <span class="n">C</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">Aa</span> <span class="o">*</span> <span class="n">Bb</span> <span class="o">+</span> <span class="n">Ab</span> <span class="o">*</span> <span class="n">Bf</span> <span class="o">+</span> <span class="n">Ac</span> <span class="o">*</span> <span class="n">Bj</span>
            <span class="n">C</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">Aa</span> <span class="o">*</span> <span class="n">Bc</span> <span class="o">+</span> <span class="n">Ab</span> <span class="o">*</span> <span class="n">Bg</span> <span class="o">+</span> <span class="n">Ac</span> <span class="o">*</span> <span class="n">Bk</span>
            <span class="n">C</span><span class="o">.</span><span class="n">e</span> <span class="o">=</span> <span class="n">Ae</span> <span class="o">*</span> <span class="n">Ba</span> <span class="o">+</span> <span class="n">Af</span> <span class="o">*</span> <span class="n">Be</span> <span class="o">+</span> <span class="n">Ag</span> <span class="o">*</span> <span class="n">Bi</span>
            <span class="n">C</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">Ae</span> <span class="o">*</span> <span class="n">Bb</span> <span class="o">+</span> <span class="n">Af</span> <span class="o">*</span> <span class="n">Bf</span> <span class="o">+</span> <span class="n">Ag</span> <span class="o">*</span> <span class="n">Bj</span>
            <span class="n">C</span><span class="o">.</span><span class="n">g</span> <span class="o">=</span> <span class="n">Ae</span> <span class="o">*</span> <span class="n">Bc</span> <span class="o">+</span> <span class="n">Af</span> <span class="o">*</span> <span class="n">Bg</span> <span class="o">+</span> <span class="n">Ag</span> <span class="o">*</span> <span class="n">Bk</span>
            <span class="n">C</span><span class="o">.</span><span class="n">i</span> <span class="o">=</span> <span class="n">Ai</span> <span class="o">*</span> <span class="n">Ba</span> <span class="o">+</span> <span class="n">Aj</span> <span class="o">*</span> <span class="n">Be</span> <span class="o">+</span> <span class="n">Ak</span> <span class="o">*</span> <span class="n">Bi</span>
            <span class="n">C</span><span class="o">.</span><span class="n">j</span> <span class="o">=</span> <span class="n">Ai</span> <span class="o">*</span> <span class="n">Bb</span> <span class="o">+</span> <span class="n">Aj</span> <span class="o">*</span> <span class="n">Bf</span> <span class="o">+</span> <span class="n">Ak</span> <span class="o">*</span> <span class="n">Bj</span>
            <span class="n">C</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">Ai</span> <span class="o">*</span> <span class="n">Bc</span> <span class="o">+</span> <span class="n">Aj</span> <span class="o">*</span> <span class="n">Bg</span> <span class="o">+</span> <span class="n">Ak</span> <span class="o">*</span> <span class="n">Bk</span>
            <span class="k">return</span> <span class="n">C</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Point2</span><span class="p">):</span>
            <span class="n">A</span> <span class="o">=</span> <span class="bp">self</span>
            <span class="n">B</span> <span class="o">=</span> <span class="n">other</span>
            <span class="n">P</span> <span class="o">=</span> <span class="n">Point2</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">P</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">a</span> <span class="o">*</span> <span class="n">B</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">A</span><span class="o">.</span><span class="n">b</span> <span class="o">*</span> <span class="n">B</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">A</span><span class="o">.</span><span class="n">c</span>
            <span class="n">P</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">e</span> <span class="o">*</span> <span class="n">B</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">A</span><span class="o">.</span><span class="n">f</span> <span class="o">*</span> <span class="n">B</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">A</span><span class="o">.</span><span class="n">g</span>
            <span class="k">return</span> <span class="n">P</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Vector2</span><span class="p">):</span>
            <span class="n">A</span> <span class="o">=</span> <span class="bp">self</span>
            <span class="n">B</span> <span class="o">=</span> <span class="n">other</span>
            <span class="n">V</span> <span class="o">=</span> <span class="n">Vector2</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">V</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">a</span> <span class="o">*</span> <span class="n">B</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">A</span><span class="o">.</span><span class="n">b</span> <span class="o">*</span> <span class="n">B</span><span class="o">.</span><span class="n">y</span> 
            <span class="n">V</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">e</span> <span class="o">*</span> <span class="n">B</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">A</span><span class="o">.</span><span class="n">f</span> <span class="o">*</span> <span class="n">B</span><span class="o">.</span><span class="n">y</span> 
            <span class="k">return</span> <span class="n">V</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">other</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">other</span><span class="o">.</span><span class="n">_apply_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">other</span>
        </div>
<div class="viewcode-block" id="Matrix3.__call__"><a class="viewcode-back" href="../modules/geom.html#geom.Matrix3.__call__">[docs]</a>    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">*</span><span class="n">other</span>
</div>
<div class="viewcode-block" id="Matrix3.__imul__"><a class="viewcode-back" href="../modules/geom.html#geom.Matrix3.__imul__">[docs]</a>    <span class="k">def</span> <span class="nf">__imul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Matrix3</span><span class="p">)</span>
        <span class="c"># Cache attributes in local vars (see Matrix3.__mul__).</span>
        <span class="n">Aa</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span>
        <span class="n">Ab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span>
        <span class="n">Ac</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>
        <span class="n">Ae</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">e</span>
        <span class="n">Af</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span>
        <span class="n">Ag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">g</span>
        <span class="n">Ai</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">i</span>
        <span class="n">Aj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">j</span>
        <span class="n">Ak</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span>
        <span class="n">Ba</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">a</span>
        <span class="n">Bb</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">b</span>
        <span class="n">Bc</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">c</span>
        <span class="n">Be</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">e</span>
        <span class="n">Bf</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">f</span>
        <span class="n">Bg</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">g</span>
        <span class="n">Bi</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">i</span>
        <span class="n">Bj</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">j</span>
        <span class="n">Bk</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">k</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">Aa</span> <span class="o">*</span> <span class="n">Ba</span> <span class="o">+</span> <span class="n">Ab</span> <span class="o">*</span> <span class="n">Be</span> <span class="o">+</span> <span class="n">Ac</span> <span class="o">*</span> <span class="n">Bi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">Aa</span> <span class="o">*</span> <span class="n">Bb</span> <span class="o">+</span> <span class="n">Ab</span> <span class="o">*</span> <span class="n">Bf</span> <span class="o">+</span> <span class="n">Ac</span> <span class="o">*</span> <span class="n">Bj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">Aa</span> <span class="o">*</span> <span class="n">Bc</span> <span class="o">+</span> <span class="n">Ab</span> <span class="o">*</span> <span class="n">Bg</span> <span class="o">+</span> <span class="n">Ac</span> <span class="o">*</span> <span class="n">Bk</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">e</span> <span class="o">=</span> <span class="n">Ae</span> <span class="o">*</span> <span class="n">Ba</span> <span class="o">+</span> <span class="n">Af</span> <span class="o">*</span> <span class="n">Be</span> <span class="o">+</span> <span class="n">Ag</span> <span class="o">*</span> <span class="n">Bi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">Ae</span> <span class="o">*</span> <span class="n">Bb</span> <span class="o">+</span> <span class="n">Af</span> <span class="o">*</span> <span class="n">Bf</span> <span class="o">+</span> <span class="n">Ag</span> <span class="o">*</span> <span class="n">Bj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g</span> <span class="o">=</span> <span class="n">Ae</span> <span class="o">*</span> <span class="n">Bc</span> <span class="o">+</span> <span class="n">Af</span> <span class="o">*</span> <span class="n">Bg</span> <span class="o">+</span> <span class="n">Ag</span> <span class="o">*</span> <span class="n">Bk</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">=</span> <span class="n">Ai</span> <span class="o">*</span> <span class="n">Ba</span> <span class="o">+</span> <span class="n">Aj</span> <span class="o">*</span> <span class="n">Be</span> <span class="o">+</span> <span class="n">Ak</span> <span class="o">*</span> <span class="n">Bi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">j</span> <span class="o">=</span> <span class="n">Ai</span> <span class="o">*</span> <span class="n">Bb</span> <span class="o">+</span> <span class="n">Aj</span> <span class="o">*</span> <span class="n">Bf</span> <span class="o">+</span> <span class="n">Ak</span> <span class="o">*</span> <span class="n">Bj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">Ai</span> <span class="o">*</span> <span class="n">Bc</span> <span class="o">+</span> <span class="n">Aj</span> <span class="o">*</span> <span class="n">Bg</span> <span class="o">+</span> <span class="n">Ak</span> <span class="o">*</span> <span class="n">Bk</span>
        <span class="k">return</span> <span class="bp">self</span>
</div>
<div class="viewcode-block" id="Matrix3.identity"><a class="viewcode-back" href="../modules/geom.html#geom.Matrix3.identity">[docs]</a>    <span class="k">def</span> <span class="nf">identity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="mf">1.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="bp">self</span>
</div>
<div class="viewcode-block" id="Matrix3.scale"><a class="viewcode-back" href="../modules/geom.html#geom.Matrix3.scale">[docs]</a>    <span class="k">def</span> <span class="nf">scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">y</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">y</span><span class="o">=</span><span class="n">x</span>
        <span class="k">return</span> <span class="n">Matrix3</span><span class="o">.</span><span class="n">new_scale</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span>
    </div>
<div class="viewcode-block" id="Matrix3.offset"><a class="viewcode-back" href="../modules/geom.html#geom.Matrix3.offset">[docs]</a>    <span class="k">def</span> <span class="nf">offset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">*</span><span class="n">Point2</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Matrix3.angle"><a class="viewcode-back" href="../modules/geom.html#geom.Matrix3.angle">[docs]</a>    <span class="k">def</span> <span class="nf">angle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">angle</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param angle: angle in radians of a unit vector starting at origin</span>
<span class="sd">        :return: float bearing in radians of the transformed vector</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">v</span><span class="o">=</span><span class="bp">self</span><span class="o">*</span><span class="n">Polar</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="n">angle</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">atan2</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">y</span><span class="p">,</span><span class="n">v</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
    </div>
<div class="viewcode-block" id="Matrix3.mag"><a class="viewcode-back" href="../modules/geom.html#geom.Matrix3.mag">[docs]</a>    <span class="k">def</span> <span class="nf">mag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">v</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the net (uniform) scaling of this transform.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">v</span><span class="p">:</span>
            <span class="n">v</span><span class="o">=</span><span class="n">Vector2</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">*</span><span class="n">v</span><span class="p">)</span><span class="o">.</span><span class="n">mag</span><span class="p">()</span><span class="o">/</span><span class="n">v</span><span class="o">.</span><span class="n">mag</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Matrix3.translate"><a class="viewcode-back" href="../modules/geom.html#geom.Matrix3.translate">[docs]</a>    <span class="k">def</span> <span class="nf">translate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param *args: x,y values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">argPair</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Matrix3</span><span class="o">.</span><span class="n">new_translate</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span>
</div>
<div class="viewcode-block" id="Matrix3.rotate"><a class="viewcode-back" href="../modules/geom.html#geom.Matrix3.rotate">[docs]</a>    <span class="k">def</span> <span class="nf">rotate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">angle</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Matrix3</span><span class="o">.</span><span class="n">new_rotate</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span>
</div>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="Matrix3.new"><a class="viewcode-back" href="../modules/geom.html#geom.Matrix3.new">[docs]</a>    <span class="k">def</span> <span class="nf">new</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">values</span><span class="p">):</span>
        <span class="n">M</span> <span class="o">=</span> <span class="n">cls</span><span class="p">()</span>
        <span class="n">M</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">values</span>
        <span class="k">return</span> <span class="n">M</span>
    </div>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="Matrix3.new_identity"><a class="viewcode-back" href="../modules/geom.html#geom.Matrix3.new_identity">[docs]</a>    <span class="k">def</span> <span class="nf">new_identity</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="bp">self</span> <span class="o">=</span> <span class="n">cls</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span>
</div>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="Matrix3.new_scale"><a class="viewcode-back" href="../modules/geom.html#geom.Matrix3.new_scale">[docs]</a>    <span class="k">def</span> <span class="nf">new_scale</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="bp">self</span> <span class="o">=</span> <span class="n">cls</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">y</span>
        <span class="k">return</span> <span class="bp">self</span></div>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="Matrix3.new_translate"><a class="viewcode-back" href="../modules/geom.html#geom.Matrix3.new_translate">[docs]</a>    <span class="k">def</span> <span class="nf">new_translate</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="bp">self</span> <span class="o">=</span> <span class="n">cls</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g</span> <span class="o">=</span> <span class="n">y</span>
        <span class="k">return</span> <span class="bp">self</span>
    </div>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="Matrix3.new_rotate"><a class="viewcode-back" href="../modules/geom.html#geom.Matrix3.new_rotate">[docs]</a>    <span class="k">def</span> <span class="nf">new_rotate</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">angle</span><span class="p">):</span>
        <span class="bp">self</span> <span class="o">=</span> <span class="n">cls</span><span class="p">()</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">c</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="o">-</span><span class="n">s</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">e</span> <span class="o">=</span> <span class="n">s</span>
        <span class="k">return</span> <span class="bp">self</span>
    </div>
<div class="viewcode-block" id="Matrix3.mag2"><a class="viewcode-back" href="../modules/geom.html#geom.Matrix3.mag2">[docs]</a>    <span class="k">def</span> <span class="nf">mag2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Matrix3.__abs__"><a class="viewcode-back" href="../modules/geom.html#geom.Matrix3.__abs__">[docs]</a>    <span class="k">def</span> <span class="nf">__abs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mag2</span><span class="p">())</span>
    </div>
<div class="viewcode-block" id="Matrix3.transpose"><a class="viewcode-back" href="../modules/geom.html#geom.Matrix3.transpose">[docs]</a>    <span class="k">def</span> <span class="nf">transpose</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">e</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">i</span><span class="p">,</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">j</span><span class="p">,</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">g</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> \
        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">e</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">g</span><span class="p">,</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">j</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Matrix3.transposed"><a class="viewcode-back" href="../modules/geom.html#geom.Matrix3.transposed">[docs]</a>    <span class="k">def</span> <span class="nf">transposed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">M</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">M</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">M</span>
</div>
<div class="viewcode-block" id="Matrix3.determinant"><a class="viewcode-back" href="../modules/geom.html#geom.Matrix3.determinant">[docs]</a>    <span class="k">def</span> <span class="nf">determinant</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span> 
                <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">g</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">i</span> 
                <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">e</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">j</span> 
                <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">g</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">j</span> 
                <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">e</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span> 
                <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">i</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Matrix3.inverse"><a class="viewcode-back" href="../modules/geom.html#geom.Matrix3.inverse">[docs]</a>    <span class="k">def</span> <span class="nf">inverse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">Matrix3</span><span class="p">()</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">determinant</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.001</span><span class="p">:</span>
            <span class="c"># No inverse, return identity</span>
            <span class="k">return</span> <span class="n">tmp</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">d</span>

            <span class="n">tmp</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">d</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">g</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">j</span><span class="p">)</span>
            <span class="n">tmp</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">d</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">j</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)</span>
            <span class="n">tmp</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">d</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">g</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">)</span>
            <span class="n">tmp</span><span class="o">.</span><span class="n">e</span> <span class="o">=</span> <span class="n">d</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">g</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">e</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)</span>
            <span class="n">tmp</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">d</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">i</span><span class="p">)</span>
            <span class="n">tmp</span><span class="o">.</span><span class="n">g</span> <span class="o">=</span> <span class="n">d</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">e</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">g</span><span class="p">)</span>
            <span class="n">tmp</span><span class="o">.</span><span class="n">i</span> <span class="o">=</span> <span class="n">d</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">j</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">i</span><span class="p">)</span>
            <span class="n">tmp</span><span class="o">.</span><span class="n">j</span> <span class="o">=</span> <span class="n">d</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">j</span><span class="p">)</span>
            <span class="n">tmp</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">d</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">e</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">tmp</span>

<span class="c"># a b c d</span>
<span class="c"># e f g h</span>
<span class="c"># i j k l</span>
<span class="c"># m n o p</span>
</div></div>
<div class="viewcode-block" id="Matrix4"><a class="viewcode-back" href="../modules/geom.html#geom.Matrix4">[docs]</a><span class="k">class</span> <span class="nc">Matrix4</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

<div class="viewcode-block" id="Matrix4.__init__"><a class="viewcode-back" href="../modules/geom.html#geom.Matrix4.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">identity</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Matrix4.__copy__"><a class="viewcode-back" href="../modules/geom.html#geom.Matrix4.__copy__">[docs]</a>    <span class="k">def</span> <span class="nf">__copy__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">M</span> <span class="o">=</span> <span class="n">Matrix4</span><span class="p">()</span>
        <span class="n">M</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span>
        <span class="n">M</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span>
        <span class="n">M</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>
        <span class="n">M</span><span class="o">.</span><span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span>
        <span class="n">M</span><span class="o">.</span><span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">e</span> 
        <span class="n">M</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span>
        <span class="n">M</span><span class="o">.</span><span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">g</span>
        <span class="n">M</span><span class="o">.</span><span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span>
        <span class="n">M</span><span class="o">.</span><span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">i</span>
        <span class="n">M</span><span class="o">.</span><span class="n">j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">j</span>
        <span class="n">M</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span>
        <span class="n">M</span><span class="o">.</span><span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">l</span>
        <span class="n">M</span><span class="o">.</span><span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span>
        <span class="n">M</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span>
        <span class="n">M</span><span class="o">.</span><span class="n">o</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">o</span>
        <span class="n">M</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span>
        <span class="k">return</span> <span class="n">M</span>
</div>
    <span class="n">copy</span> <span class="o">=</span> <span class="n">__copy__</span>


<div class="viewcode-block" id="Matrix4.__repr__"><a class="viewcode-back" href="../modules/geom.html#geom.Matrix4.__repr__">[docs]</a>    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">([</span><span class="si">%g</span><span class="s"> </span><span class="si">%g</span><span class="s"> </span><span class="si">%g</span><span class="s"> </span><span class="si">%g</span><span class="se">\n</span><span class="s">&#39;</span>  \
                <span class="s">&#39;         </span><span class="si">%g</span><span class="s"> </span><span class="si">%g</span><span class="s"> </span><span class="si">%g</span><span class="s"> </span><span class="si">%g</span><span class="se">\n</span><span class="s">&#39;</span>  \
                <span class="s">&#39;         </span><span class="si">%g</span><span class="s"> </span><span class="si">%g</span><span class="s"> </span><span class="si">%g</span><span class="s"> </span><span class="si">%g</span><span class="se">\n</span><span class="s">&#39;</span>  \
                <span class="s">&#39;         </span><span class="si">%g</span><span class="s"> </span><span class="si">%g</span><span class="s"> </span><span class="si">%g</span><span class="s"> </span><span class="si">%g</span><span class="s">])&#39;</span><span class="p">)</span> \
                <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">,</span>
                   <span class="bp">self</span><span class="o">.</span><span class="n">e</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">g</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">,</span>
                   <span class="bp">self</span><span class="o">.</span><span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">j</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">l</span><span class="p">,</span>
                   <span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">o</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Matrix4.__getitem__"><a class="viewcode-back" href="../modules/geom.html#geom.Matrix4.__getitem__">[docs]</a>    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">e</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">j</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">g</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">o</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">l</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">][</span><span class="n">key</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="Matrix4.__setitem__"><a class="viewcode-back" href="../modules/geom.html#geom.Matrix4.__setitem__">[docs]</a>    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">L</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[:]</span>
        <span class="n">L</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">e</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">,</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">j</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">g</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">o</span><span class="p">,</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">l</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">)</span> <span class="o">=</span> <span class="n">L</span>
</div>
<div class="viewcode-block" id="Matrix4.__mul__"><a class="viewcode-back" href="../modules/geom.html#geom.Matrix4.__mul__">[docs]</a>    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Matrix4</span><span class="p">):</span>
            <span class="c"># Cache attributes in local vars (see Matrix3.__mul__).</span>
            <span class="n">Aa</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span>
            <span class="n">Ab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span>
            <span class="n">Ac</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>
            <span class="n">Ad</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span>
            <span class="n">Ae</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">e</span>
            <span class="n">Af</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span>
            <span class="n">Ag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">g</span>
            <span class="n">Ah</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span>
            <span class="n">Ai</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">i</span>
            <span class="n">Aj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">j</span>
            <span class="n">Ak</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span>
            <span class="n">Al</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">l</span>
            <span class="n">Am</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span>
            <span class="n">An</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span>
            <span class="n">Ao</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">o</span>
            <span class="n">Ap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span>
            <span class="n">Ba</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">a</span>
            <span class="n">Bb</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">b</span>
            <span class="n">Bc</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">c</span>
            <span class="n">Bd</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">d</span>
            <span class="n">Be</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">e</span>
            <span class="n">Bf</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">f</span>
            <span class="n">Bg</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">g</span>
            <span class="n">Bh</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">h</span>
            <span class="n">Bi</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">i</span>
            <span class="n">Bj</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">j</span>
            <span class="n">Bk</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">k</span>
            <span class="n">Bl</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">l</span>
            <span class="n">Bm</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">m</span>
            <span class="n">Bn</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">n</span>
            <span class="n">Bo</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">o</span>
            <span class="n">Bp</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">p</span>
            <span class="n">C</span> <span class="o">=</span> <span class="n">Matrix4</span><span class="p">()</span>
            <span class="n">C</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">Aa</span> <span class="o">*</span> <span class="n">Ba</span> <span class="o">+</span> <span class="n">Ab</span> <span class="o">*</span> <span class="n">Be</span> <span class="o">+</span> <span class="n">Ac</span> <span class="o">*</span> <span class="n">Bi</span> <span class="o">+</span> <span class="n">Ad</span> <span class="o">*</span> <span class="n">Bm</span>
            <span class="n">C</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">Aa</span> <span class="o">*</span> <span class="n">Bb</span> <span class="o">+</span> <span class="n">Ab</span> <span class="o">*</span> <span class="n">Bf</span> <span class="o">+</span> <span class="n">Ac</span> <span class="o">*</span> <span class="n">Bj</span> <span class="o">+</span> <span class="n">Ad</span> <span class="o">*</span> <span class="n">Bn</span>
            <span class="n">C</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">Aa</span> <span class="o">*</span> <span class="n">Bc</span> <span class="o">+</span> <span class="n">Ab</span> <span class="o">*</span> <span class="n">Bg</span> <span class="o">+</span> <span class="n">Ac</span> <span class="o">*</span> <span class="n">Bk</span> <span class="o">+</span> <span class="n">Ad</span> <span class="o">*</span> <span class="n">Bo</span>
            <span class="n">C</span><span class="o">.</span><span class="n">d</span> <span class="o">=</span> <span class="n">Aa</span> <span class="o">*</span> <span class="n">Bd</span> <span class="o">+</span> <span class="n">Ab</span> <span class="o">*</span> <span class="n">Bh</span> <span class="o">+</span> <span class="n">Ac</span> <span class="o">*</span> <span class="n">Bl</span> <span class="o">+</span> <span class="n">Ad</span> <span class="o">*</span> <span class="n">Bp</span>
            <span class="n">C</span><span class="o">.</span><span class="n">e</span> <span class="o">=</span> <span class="n">Ae</span> <span class="o">*</span> <span class="n">Ba</span> <span class="o">+</span> <span class="n">Af</span> <span class="o">*</span> <span class="n">Be</span> <span class="o">+</span> <span class="n">Ag</span> <span class="o">*</span> <span class="n">Bi</span> <span class="o">+</span> <span class="n">Ah</span> <span class="o">*</span> <span class="n">Bm</span>
            <span class="n">C</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">Ae</span> <span class="o">*</span> <span class="n">Bb</span> <span class="o">+</span> <span class="n">Af</span> <span class="o">*</span> <span class="n">Bf</span> <span class="o">+</span> <span class="n">Ag</span> <span class="o">*</span> <span class="n">Bj</span> <span class="o">+</span> <span class="n">Ah</span> <span class="o">*</span> <span class="n">Bn</span>
            <span class="n">C</span><span class="o">.</span><span class="n">g</span> <span class="o">=</span> <span class="n">Ae</span> <span class="o">*</span> <span class="n">Bc</span> <span class="o">+</span> <span class="n">Af</span> <span class="o">*</span> <span class="n">Bg</span> <span class="o">+</span> <span class="n">Ag</span> <span class="o">*</span> <span class="n">Bk</span> <span class="o">+</span> <span class="n">Ah</span> <span class="o">*</span> <span class="n">Bo</span>
            <span class="n">C</span><span class="o">.</span><span class="n">h</span> <span class="o">=</span> <span class="n">Ae</span> <span class="o">*</span> <span class="n">Bd</span> <span class="o">+</span> <span class="n">Af</span> <span class="o">*</span> <span class="n">Bh</span> <span class="o">+</span> <span class="n">Ag</span> <span class="o">*</span> <span class="n">Bl</span> <span class="o">+</span> <span class="n">Ah</span> <span class="o">*</span> <span class="n">Bp</span>
            <span class="n">C</span><span class="o">.</span><span class="n">i</span> <span class="o">=</span> <span class="n">Ai</span> <span class="o">*</span> <span class="n">Ba</span> <span class="o">+</span> <span class="n">Aj</span> <span class="o">*</span> <span class="n">Be</span> <span class="o">+</span> <span class="n">Ak</span> <span class="o">*</span> <span class="n">Bi</span> <span class="o">+</span> <span class="n">Al</span> <span class="o">*</span> <span class="n">Bm</span>
            <span class="n">C</span><span class="o">.</span><span class="n">j</span> <span class="o">=</span> <span class="n">Ai</span> <span class="o">*</span> <span class="n">Bb</span> <span class="o">+</span> <span class="n">Aj</span> <span class="o">*</span> <span class="n">Bf</span> <span class="o">+</span> <span class="n">Ak</span> <span class="o">*</span> <span class="n">Bj</span> <span class="o">+</span> <span class="n">Al</span> <span class="o">*</span> <span class="n">Bn</span>
            <span class="n">C</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">Ai</span> <span class="o">*</span> <span class="n">Bc</span> <span class="o">+</span> <span class="n">Aj</span> <span class="o">*</span> <span class="n">Bg</span> <span class="o">+</span> <span class="n">Ak</span> <span class="o">*</span> <span class="n">Bk</span> <span class="o">+</span> <span class="n">Al</span> <span class="o">*</span> <span class="n">Bo</span>
            <span class="n">C</span><span class="o">.</span><span class="n">l</span> <span class="o">=</span> <span class="n">Ai</span> <span class="o">*</span> <span class="n">Bd</span> <span class="o">+</span> <span class="n">Aj</span> <span class="o">*</span> <span class="n">Bh</span> <span class="o">+</span> <span class="n">Ak</span> <span class="o">*</span> <span class="n">Bl</span> <span class="o">+</span> <span class="n">Al</span> <span class="o">*</span> <span class="n">Bp</span>
            <span class="n">C</span><span class="o">.</span><span class="n">m</span> <span class="o">=</span> <span class="n">Am</span> <span class="o">*</span> <span class="n">Ba</span> <span class="o">+</span> <span class="n">An</span> <span class="o">*</span> <span class="n">Be</span> <span class="o">+</span> <span class="n">Ao</span> <span class="o">*</span> <span class="n">Bi</span> <span class="o">+</span> <span class="n">Ap</span> <span class="o">*</span> <span class="n">Bm</span>
            <span class="n">C</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">Am</span> <span class="o">*</span> <span class="n">Bb</span> <span class="o">+</span> <span class="n">An</span> <span class="o">*</span> <span class="n">Bf</span> <span class="o">+</span> <span class="n">Ao</span> <span class="o">*</span> <span class="n">Bj</span> <span class="o">+</span> <span class="n">Ap</span> <span class="o">*</span> <span class="n">Bn</span>
            <span class="n">C</span><span class="o">.</span><span class="n">o</span> <span class="o">=</span> <span class="n">Am</span> <span class="o">*</span> <span class="n">Bc</span> <span class="o">+</span> <span class="n">An</span> <span class="o">*</span> <span class="n">Bg</span> <span class="o">+</span> <span class="n">Ao</span> <span class="o">*</span> <span class="n">Bk</span> <span class="o">+</span> <span class="n">Ap</span> <span class="o">*</span> <span class="n">Bo</span>
            <span class="n">C</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">Am</span> <span class="o">*</span> <span class="n">Bd</span> <span class="o">+</span> <span class="n">An</span> <span class="o">*</span> <span class="n">Bh</span> <span class="o">+</span> <span class="n">Ao</span> <span class="o">*</span> <span class="n">Bl</span> <span class="o">+</span> <span class="n">Ap</span> <span class="o">*</span> <span class="n">Bp</span>
            <span class="k">return</span> <span class="n">C</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Point3</span><span class="p">):</span>
            <span class="n">A</span> <span class="o">=</span> <span class="bp">self</span>
            <span class="n">B</span> <span class="o">=</span> <span class="n">other</span>
            <span class="n">P</span> <span class="o">=</span> <span class="n">Point3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">P</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">a</span> <span class="o">*</span> <span class="n">B</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">A</span><span class="o">.</span><span class="n">b</span> <span class="o">*</span> <span class="n">B</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">A</span><span class="o">.</span><span class="n">c</span> <span class="o">*</span> <span class="n">B</span><span class="o">.</span><span class="n">z</span> <span class="o">+</span> <span class="n">A</span><span class="o">.</span><span class="n">d</span>
            <span class="n">P</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">e</span> <span class="o">*</span> <span class="n">B</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">A</span><span class="o">.</span><span class="n">f</span> <span class="o">*</span> <span class="n">B</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">A</span><span class="o">.</span><span class="n">g</span> <span class="o">*</span> <span class="n">B</span><span class="o">.</span><span class="n">z</span> <span class="o">+</span> <span class="n">A</span><span class="o">.</span><span class="n">h</span>
            <span class="n">P</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">i</span> <span class="o">*</span> <span class="n">B</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">A</span><span class="o">.</span><span class="n">j</span> <span class="o">*</span> <span class="n">B</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">A</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="n">B</span><span class="o">.</span><span class="n">z</span> <span class="o">+</span> <span class="n">A</span><span class="o">.</span><span class="n">l</span>
            <span class="k">return</span> <span class="n">P</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Vector3</span><span class="p">):</span>
            <span class="n">A</span> <span class="o">=</span> <span class="bp">self</span>
            <span class="n">B</span> <span class="o">=</span> <span class="n">other</span>
            <span class="n">V</span> <span class="o">=</span> <span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">V</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">a</span> <span class="o">*</span> <span class="n">B</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">A</span><span class="o">.</span><span class="n">b</span> <span class="o">*</span> <span class="n">B</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">A</span><span class="o">.</span><span class="n">c</span> <span class="o">*</span> <span class="n">B</span><span class="o">.</span><span class="n">z</span>
            <span class="n">V</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">e</span> <span class="o">*</span> <span class="n">B</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">A</span><span class="o">.</span><span class="n">f</span> <span class="o">*</span> <span class="n">B</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">A</span><span class="o">.</span><span class="n">g</span> <span class="o">*</span> <span class="n">B</span><span class="o">.</span><span class="n">z</span>
            <span class="n">V</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">i</span> <span class="o">*</span> <span class="n">B</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">A</span><span class="o">.</span><span class="n">j</span> <span class="o">*</span> <span class="n">B</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">A</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="n">B</span><span class="o">.</span><span class="n">z</span>
            <span class="k">return</span> <span class="n">V</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">other</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">other</span><span class="o">.</span><span class="n">_apply_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">other</span>
        </div>
<div class="viewcode-block" id="Matrix4.__call__"><a class="viewcode-back" href="../modules/geom.html#geom.Matrix4.__call__">[docs]</a>    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">*</span><span class="n">other</span>
</div>
<div class="viewcode-block" id="Matrix4.__imul__"><a class="viewcode-back" href="../modules/geom.html#geom.Matrix4.__imul__">[docs]</a>    <span class="k">def</span> <span class="nf">__imul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Matrix4</span><span class="p">)</span>
        <span class="c"># Cache attributes in local vars (see Matrix3.__mul__).</span>
        <span class="n">Aa</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span>
        <span class="n">Ab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span>
        <span class="n">Ac</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>
        <span class="n">Ad</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span>
        <span class="n">Ae</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">e</span>
        <span class="n">Af</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span>
        <span class="n">Ag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">g</span>
        <span class="n">Ah</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span>
        <span class="n">Ai</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">i</span>
        <span class="n">Aj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">j</span>
        <span class="n">Ak</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span>
        <span class="n">Al</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">l</span>
        <span class="n">Am</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span>
        <span class="n">An</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span>
        <span class="n">Ao</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">o</span>
        <span class="n">Ap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span>
        <span class="n">Ba</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">a</span>
        <span class="n">Bb</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">b</span>
        <span class="n">Bc</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">c</span>
        <span class="n">Bd</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">d</span>
        <span class="n">Be</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">e</span>
        <span class="n">Bf</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">f</span>
        <span class="n">Bg</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">g</span>
        <span class="n">Bh</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">h</span>
        <span class="n">Bi</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">i</span>
        <span class="n">Bj</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">j</span>
        <span class="n">Bk</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">k</span>
        <span class="n">Bl</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">l</span>
        <span class="n">Bm</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">m</span>
        <span class="n">Bn</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">n</span>
        <span class="n">Bo</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">o</span>
        <span class="n">Bp</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">p</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">Aa</span> <span class="o">*</span> <span class="n">Ba</span> <span class="o">+</span> <span class="n">Ab</span> <span class="o">*</span> <span class="n">Be</span> <span class="o">+</span> <span class="n">Ac</span> <span class="o">*</span> <span class="n">Bi</span> <span class="o">+</span> <span class="n">Ad</span> <span class="o">*</span> <span class="n">Bm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">Aa</span> <span class="o">*</span> <span class="n">Bb</span> <span class="o">+</span> <span class="n">Ab</span> <span class="o">*</span> <span class="n">Bf</span> <span class="o">+</span> <span class="n">Ac</span> <span class="o">*</span> <span class="n">Bj</span> <span class="o">+</span> <span class="n">Ad</span> <span class="o">*</span> <span class="n">Bn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">Aa</span> <span class="o">*</span> <span class="n">Bc</span> <span class="o">+</span> <span class="n">Ab</span> <span class="o">*</span> <span class="n">Bg</span> <span class="o">+</span> <span class="n">Ac</span> <span class="o">*</span> <span class="n">Bk</span> <span class="o">+</span> <span class="n">Ad</span> <span class="o">*</span> <span class="n">Bo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d</span> <span class="o">=</span> <span class="n">Aa</span> <span class="o">*</span> <span class="n">Bd</span> <span class="o">+</span> <span class="n">Ab</span> <span class="o">*</span> <span class="n">Bh</span> <span class="o">+</span> <span class="n">Ac</span> <span class="o">*</span> <span class="n">Bl</span> <span class="o">+</span> <span class="n">Ad</span> <span class="o">*</span> <span class="n">Bp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">e</span> <span class="o">=</span> <span class="n">Ae</span> <span class="o">*</span> <span class="n">Ba</span> <span class="o">+</span> <span class="n">Af</span> <span class="o">*</span> <span class="n">Be</span> <span class="o">+</span> <span class="n">Ag</span> <span class="o">*</span> <span class="n">Bi</span> <span class="o">+</span> <span class="n">Ah</span> <span class="o">*</span> <span class="n">Bm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">Ae</span> <span class="o">*</span> <span class="n">Bb</span> <span class="o">+</span> <span class="n">Af</span> <span class="o">*</span> <span class="n">Bf</span> <span class="o">+</span> <span class="n">Ag</span> <span class="o">*</span> <span class="n">Bj</span> <span class="o">+</span> <span class="n">Ah</span> <span class="o">*</span> <span class="n">Bn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g</span> <span class="o">=</span> <span class="n">Ae</span> <span class="o">*</span> <span class="n">Bc</span> <span class="o">+</span> <span class="n">Af</span> <span class="o">*</span> <span class="n">Bg</span> <span class="o">+</span> <span class="n">Ag</span> <span class="o">*</span> <span class="n">Bk</span> <span class="o">+</span> <span class="n">Ah</span> <span class="o">*</span> <span class="n">Bo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">=</span> <span class="n">Ae</span> <span class="o">*</span> <span class="n">Bd</span> <span class="o">+</span> <span class="n">Af</span> <span class="o">*</span> <span class="n">Bh</span> <span class="o">+</span> <span class="n">Ag</span> <span class="o">*</span> <span class="n">Bl</span> <span class="o">+</span> <span class="n">Ah</span> <span class="o">*</span> <span class="n">Bp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">=</span> <span class="n">Ai</span> <span class="o">*</span> <span class="n">Ba</span> <span class="o">+</span> <span class="n">Aj</span> <span class="o">*</span> <span class="n">Be</span> <span class="o">+</span> <span class="n">Ak</span> <span class="o">*</span> <span class="n">Bi</span> <span class="o">+</span> <span class="n">Al</span> <span class="o">*</span> <span class="n">Bm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">j</span> <span class="o">=</span> <span class="n">Ai</span> <span class="o">*</span> <span class="n">Bb</span> <span class="o">+</span> <span class="n">Aj</span> <span class="o">*</span> <span class="n">Bf</span> <span class="o">+</span> <span class="n">Ak</span> <span class="o">*</span> <span class="n">Bj</span> <span class="o">+</span> <span class="n">Al</span> <span class="o">*</span> <span class="n">Bn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">Ai</span> <span class="o">*</span> <span class="n">Bc</span> <span class="o">+</span> <span class="n">Aj</span> <span class="o">*</span> <span class="n">Bg</span> <span class="o">+</span> <span class="n">Ak</span> <span class="o">*</span> <span class="n">Bk</span> <span class="o">+</span> <span class="n">Al</span> <span class="o">*</span> <span class="n">Bo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">l</span> <span class="o">=</span> <span class="n">Ai</span> <span class="o">*</span> <span class="n">Bd</span> <span class="o">+</span> <span class="n">Aj</span> <span class="o">*</span> <span class="n">Bh</span> <span class="o">+</span> <span class="n">Ak</span> <span class="o">*</span> <span class="n">Bl</span> <span class="o">+</span> <span class="n">Al</span> <span class="o">*</span> <span class="n">Bp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">=</span> <span class="n">Am</span> <span class="o">*</span> <span class="n">Ba</span> <span class="o">+</span> <span class="n">An</span> <span class="o">*</span> <span class="n">Be</span> <span class="o">+</span> <span class="n">Ao</span> <span class="o">*</span> <span class="n">Bi</span> <span class="o">+</span> <span class="n">Ap</span> <span class="o">*</span> <span class="n">Bm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">Am</span> <span class="o">*</span> <span class="n">Bb</span> <span class="o">+</span> <span class="n">An</span> <span class="o">*</span> <span class="n">Bf</span> <span class="o">+</span> <span class="n">Ao</span> <span class="o">*</span> <span class="n">Bj</span> <span class="o">+</span> <span class="n">Ap</span> <span class="o">*</span> <span class="n">Bn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">o</span> <span class="o">=</span> <span class="n">Am</span> <span class="o">*</span> <span class="n">Bc</span> <span class="o">+</span> <span class="n">An</span> <span class="o">*</span> <span class="n">Bg</span> <span class="o">+</span> <span class="n">Ao</span> <span class="o">*</span> <span class="n">Bk</span> <span class="o">+</span> <span class="n">Ap</span> <span class="o">*</span> <span class="n">Bo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">Am</span> <span class="o">*</span> <span class="n">Bd</span> <span class="o">+</span> <span class="n">An</span> <span class="o">*</span> <span class="n">Bh</span> <span class="o">+</span> <span class="n">Ao</span> <span class="o">*</span> <span class="n">Bl</span> <span class="o">+</span> <span class="n">Ap</span> <span class="o">*</span> <span class="n">Bp</span>
        <span class="k">return</span> <span class="bp">self</span>
</div>
<div class="viewcode-block" id="Matrix4.transform"><a class="viewcode-back" href="../modules/geom.html#geom.Matrix4.transform">[docs]</a>    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">A</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">B</span> <span class="o">=</span> <span class="n">other</span>
        <span class="n">P</span> <span class="o">=</span> <span class="n">Point3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">P</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">a</span> <span class="o">*</span> <span class="n">B</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">A</span><span class="o">.</span><span class="n">b</span> <span class="o">*</span> <span class="n">B</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">A</span><span class="o">.</span><span class="n">c</span> <span class="o">*</span> <span class="n">B</span><span class="o">.</span><span class="n">z</span> <span class="o">+</span> <span class="n">A</span><span class="o">.</span><span class="n">d</span>
        <span class="n">P</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">e</span> <span class="o">*</span> <span class="n">B</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">A</span><span class="o">.</span><span class="n">f</span> <span class="o">*</span> <span class="n">B</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">A</span><span class="o">.</span><span class="n">g</span> <span class="o">*</span> <span class="n">B</span><span class="o">.</span><span class="n">z</span> <span class="o">+</span> <span class="n">A</span><span class="o">.</span><span class="n">h</span>
        <span class="n">P</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">i</span> <span class="o">*</span> <span class="n">B</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">A</span><span class="o">.</span><span class="n">j</span> <span class="o">*</span> <span class="n">B</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">A</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="n">B</span><span class="o">.</span><span class="n">z</span> <span class="o">+</span> <span class="n">A</span><span class="o">.</span><span class="n">l</span>
        <span class="n">w</span> <span class="o">=</span>   <span class="n">A</span><span class="o">.</span><span class="n">m</span> <span class="o">*</span> <span class="n">B</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">A</span><span class="o">.</span><span class="n">n</span> <span class="o">*</span> <span class="n">B</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">A</span><span class="o">.</span><span class="n">o</span> <span class="o">*</span> <span class="n">B</span><span class="o">.</span><span class="n">z</span> <span class="o">+</span> <span class="n">A</span><span class="o">.</span><span class="n">p</span>
        <span class="k">if</span> <span class="n">w</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">P</span><span class="o">.</span><span class="n">x</span> <span class="o">/=</span> <span class="n">w</span>
            <span class="n">P</span><span class="o">.</span><span class="n">y</span> <span class="o">/=</span> <span class="n">w</span>
            <span class="n">P</span><span class="o">.</span><span class="n">z</span> <span class="o">/=</span> <span class="n">w</span>
        <span class="k">return</span> <span class="n">P</span>
</div>
<div class="viewcode-block" id="Matrix4.identity"><a class="viewcode-back" href="../modules/geom.html#geom.Matrix4.identity">[docs]</a>    <span class="k">def</span> <span class="nf">identity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="mf">1.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">=</span> \
        <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">o</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="bp">self</span>
</div>
<div class="viewcode-block" id="Matrix4.scale"><a class="viewcode-back" href="../modules/geom.html#geom.Matrix4.scale">[docs]</a>    <span class="k">def</span> <span class="nf">scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
        <span class="bp">self</span> <span class="o">*=</span> <span class="n">Matrix4</span><span class="o">.</span><span class="n">new_scale</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>
</div>
<div class="viewcode-block" id="Matrix4.translate"><a class="viewcode-back" href="../modules/geom.html#geom.Matrix4.translate">[docs]</a>    <span class="k">def</span> <span class="nf">translate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
        <span class="bp">self</span> <span class="o">*=</span> <span class="n">Matrix4</span><span class="o">.</span><span class="n">new_translate</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span> 
</div>
<div class="viewcode-block" id="Matrix4.rotatex"><a class="viewcode-back" href="../modules/geom.html#geom.Matrix4.rotatex">[docs]</a>    <span class="k">def</span> <span class="nf">rotatex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">angle</span><span class="p">):</span>
        <span class="bp">self</span> <span class="o">*=</span> <span class="n">Matrix4</span><span class="o">.</span><span class="n">new_rotatex</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>
</div>
<div class="viewcode-block" id="Matrix4.rotatey"><a class="viewcode-back" href="../modules/geom.html#geom.Matrix4.rotatey">[docs]</a>    <span class="k">def</span> <span class="nf">rotatey</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">angle</span><span class="p">):</span>
        <span class="bp">self</span> <span class="o">*=</span> <span class="n">Matrix4</span><span class="o">.</span><span class="n">new_rotatey</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>
</div>
<div class="viewcode-block" id="Matrix4.rotatez"><a class="viewcode-back" href="../modules/geom.html#geom.Matrix4.rotatez">[docs]</a>    <span class="k">def</span> <span class="nf">rotatez</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">angle</span><span class="p">):</span>
        <span class="bp">self</span> <span class="o">*=</span> <span class="n">Matrix4</span><span class="o">.</span><span class="n">new_rotatez</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>
</div>
<div class="viewcode-block" id="Matrix4.rotate_axis"><a class="viewcode-back" href="../modules/geom.html#geom.Matrix4.rotate_axis">[docs]</a>    <span class="k">def</span> <span class="nf">rotate_axis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>
        <span class="bp">self</span> <span class="o">*=</span> <span class="n">Matrix4</span><span class="o">.</span><span class="n">new_rotate_axis</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span> <span class="n">axis</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>
</div>
<div class="viewcode-block" id="Matrix4.rotate_euler"><a class="viewcode-back" href="../modules/geom.html#geom.Matrix4.rotate_euler">[docs]</a>    <span class="k">def</span> <span class="nf">rotate_euler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">heading</span><span class="p">,</span> <span class="n">attitude</span><span class="p">,</span> <span class="n">bank</span><span class="p">):</span>
        <span class="bp">self</span> <span class="o">*=</span> <span class="n">Matrix4</span><span class="o">.</span><span class="n">new_rotate_euler</span><span class="p">(</span><span class="n">heading</span><span class="p">,</span> <span class="n">attitude</span><span class="p">,</span> <span class="n">bank</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>
</div>
<div class="viewcode-block" id="Matrix4.rotate_triple_axis"><a class="viewcode-back" href="../modules/geom.html#geom.Matrix4.rotate_triple_axis">[docs]</a>    <span class="k">def</span> <span class="nf">rotate_triple_axis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
        <span class="bp">self</span> <span class="o">*=</span> <span class="n">Matrix4</span><span class="o">.</span><span class="n">new_rotate_triple_axis</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>
</div>
<div class="viewcode-block" id="Matrix4.transpose"><a class="viewcode-back" href="../modules/geom.html#geom.Matrix4.transpose">[docs]</a>    <span class="k">def</span> <span class="nf">transpose</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">e</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">,</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">j</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">g</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">o</span><span class="p">,</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">l</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">)</span> <span class="o">=</span> \
        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">,</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">e</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">g</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">,</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">j</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">l</span><span class="p">,</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">o</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Matrix4.transposed"><a class="viewcode-back" href="../modules/geom.html#geom.Matrix4.transposed">[docs]</a>    <span class="k">def</span> <span class="nf">transposed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">M</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">M</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">M</span>

    <span class="c"># Static constructors</span></div>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="Matrix4.new"><a class="viewcode-back" href="../modules/geom.html#geom.Matrix4.new">[docs]</a>    <span class="k">def</span> <span class="nf">new</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">values</span><span class="p">):</span>
        <span class="n">M</span> <span class="o">=</span> <span class="n">cls</span><span class="p">()</span>
        <span class="n">M</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">values</span>
        <span class="k">return</span> <span class="n">M</span>
</div>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="Matrix4.new_identity"><a class="viewcode-back" href="../modules/geom.html#geom.Matrix4.new_identity">[docs]</a>    <span class="k">def</span> <span class="nf">new_identity</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="bp">self</span> <span class="o">=</span> <span class="n">cls</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span>
</div>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="Matrix4.new_scale"><a class="viewcode-back" href="../modules/geom.html#geom.Matrix4.new_scale">[docs]</a>    <span class="k">def</span> <span class="nf">new_scale</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
        <span class="bp">self</span> <span class="o">=</span> <span class="n">cls</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">z</span>
        <span class="k">return</span> <span class="bp">self</span>
</div>
    <span class="nb">classmethod</span>
<div class="viewcode-block" id="Matrix4.new_translate"><a class="viewcode-back" href="../modules/geom.html#geom.Matrix4.new_translate">[docs]</a>    <span class="k">def</span> <span class="nf">new_translate</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
        <span class="bp">self</span> <span class="o">=</span> <span class="n">cls</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d</span> <span class="o">=</span> <span class="n">x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">=</span> <span class="n">y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">l</span> <span class="o">=</span> <span class="n">z</span>
        <span class="k">return</span> <span class="bp">self</span>
</div>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="Matrix4.new_rotatex"><a class="viewcode-back" href="../modules/geom.html#geom.Matrix4.new_rotatex">[docs]</a>    <span class="k">def</span> <span class="nf">new_rotatex</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">angle</span><span class="p">):</span>
        <span class="bp">self</span> <span class="o">=</span> <span class="n">cls</span><span class="p">()</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">c</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g</span> <span class="o">=</span> <span class="o">-</span><span class="n">s</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">j</span> <span class="o">=</span> <span class="n">s</span>
        <span class="k">return</span> <span class="bp">self</span>
    </div>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="Matrix4.new_rotatey"><a class="viewcode-back" href="../modules/geom.html#geom.Matrix4.new_rotatey">[docs]</a>    <span class="k">def</span> <span class="nf">new_rotatey</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">angle</span><span class="p">):</span>
        <span class="bp">self</span> <span class="o">=</span> <span class="n">cls</span><span class="p">()</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">c</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">s</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">=</span> <span class="o">-</span><span class="n">s</span>
        <span class="k">return</span> <span class="bp">self</span>    
    </div>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="Matrix4.new_rotatez"><a class="viewcode-back" href="../modules/geom.html#geom.Matrix4.new_rotatez">[docs]</a>    <span class="k">def</span> <span class="nf">new_rotatez</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">angle</span><span class="p">):</span>
        <span class="bp">self</span> <span class="o">=</span> <span class="n">cls</span><span class="p">()</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">c</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="o">-</span><span class="n">s</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">e</span> <span class="o">=</span> <span class="n">s</span>
        <span class="k">return</span> <span class="bp">self</span>
    </div>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="Matrix4.new_rotate_axis"><a class="viewcode-back" href="../modules/geom.html#geom.Matrix4.new_rotate_axis">[docs]</a>    <span class="k">def</span> <span class="nf">new_rotate_axis</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>
        <span class="k">assert</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">Vector3</span><span class="p">))</span>
        <span class="n">vector</span> <span class="o">=</span> <span class="n">axis</span><span class="o">.</span><span class="n">normalized</span><span class="p">()</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">vector</span><span class="o">.</span><span class="n">x</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">vector</span><span class="o">.</span><span class="n">y</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">vector</span><span class="o">.</span><span class="n">z</span>

        <span class="bp">self</span> <span class="o">=</span> <span class="n">cls</span><span class="p">()</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
        <span class="n">c1</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">-</span> <span class="n">c</span>
        
        <span class="c"># from the glRotate man page</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span> <span class="o">*</span> <span class="n">c1</span> <span class="o">+</span> <span class="n">c</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span> <span class="o">*</span> <span class="n">c1</span> <span class="o">-</span> <span class="n">z</span> <span class="o">*</span> <span class="n">s</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">z</span> <span class="o">*</span> <span class="n">c1</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="n">s</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">e</span> <span class="o">=</span> <span class="n">y</span> <span class="o">*</span> <span class="n">x</span> <span class="o">*</span> <span class="n">c1</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="n">s</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">y</span> <span class="o">*</span> <span class="n">y</span> <span class="o">*</span> <span class="n">c1</span> <span class="o">+</span> <span class="n">c</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g</span> <span class="o">=</span> <span class="n">y</span> <span class="o">*</span> <span class="n">z</span> <span class="o">*</span> <span class="n">c1</span> <span class="o">-</span> <span class="n">x</span> <span class="o">*</span> <span class="n">s</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">z</span> <span class="o">*</span> <span class="n">c1</span> <span class="o">-</span> <span class="n">y</span> <span class="o">*</span> <span class="n">s</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">j</span> <span class="o">=</span> <span class="n">y</span> <span class="o">*</span> <span class="n">z</span> <span class="o">*</span> <span class="n">c1</span> <span class="o">+</span> <span class="n">x</span> <span class="o">*</span> <span class="n">s</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">z</span> <span class="o">*</span> <span class="n">z</span> <span class="o">*</span> <span class="n">c1</span> <span class="o">+</span> <span class="n">c</span>
        <span class="k">return</span> <span class="bp">self</span>
    </div>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="Matrix4.new_rotate_euler"><a class="viewcode-back" href="../modules/geom.html#geom.Matrix4.new_rotate_euler">[docs]</a>    <span class="k">def</span> <span class="nf">new_rotate_euler</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">heading</span><span class="p">,</span> <span class="n">attitude</span><span class="p">,</span> <span class="n">bank</span><span class="p">):</span>
        <span class="c"># from http://www.euclideanspace.com/</span>
        <span class="n">ch</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">heading</span><span class="p">)</span>
        <span class="n">sh</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">heading</span><span class="p">)</span>
        <span class="n">ca</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">attitude</span><span class="p">)</span>
        <span class="n">sa</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">attitude</span><span class="p">)</span>
        <span class="n">cb</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">bank</span><span class="p">)</span>
        <span class="n">sb</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">bank</span><span class="p">)</span>

        <span class="bp">self</span> <span class="o">=</span> <span class="n">cls</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">ch</span> <span class="o">*</span> <span class="n">ca</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">sh</span> <span class="o">*</span> <span class="n">sb</span> <span class="o">-</span> <span class="n">ch</span> <span class="o">*</span> <span class="n">sa</span> <span class="o">*</span> <span class="n">cb</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">ch</span> <span class="o">*</span> <span class="n">sa</span> <span class="o">*</span> <span class="n">sb</span> <span class="o">+</span> <span class="n">sh</span> <span class="o">*</span> <span class="n">cb</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">e</span> <span class="o">=</span> <span class="n">sa</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">ca</span> <span class="o">*</span> <span class="n">cb</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g</span> <span class="o">=</span> <span class="o">-</span><span class="n">ca</span> <span class="o">*</span> <span class="n">sb</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">=</span> <span class="o">-</span><span class="n">sh</span> <span class="o">*</span> <span class="n">ca</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">j</span> <span class="o">=</span> <span class="n">sh</span> <span class="o">*</span> <span class="n">sa</span> <span class="o">*</span> <span class="n">cb</span> <span class="o">+</span> <span class="n">ch</span> <span class="o">*</span> <span class="n">sb</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="o">-</span><span class="n">sh</span> <span class="o">*</span> <span class="n">sa</span> <span class="o">*</span> <span class="n">sb</span> <span class="o">+</span> <span class="n">ch</span> <span class="o">*</span> <span class="n">cb</span>
        <span class="k">return</span> <span class="bp">self</span>
</div>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="Matrix4.new_rotate_triple_axis"><a class="viewcode-back" href="../modules/geom.html#geom.Matrix4.new_rotate_triple_axis">[docs]</a>    <span class="k">def</span> <span class="nf">new_rotate_triple_axis</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">cls</span><span class="p">()</span>
        
        <span class="n">m</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="o">.</span><span class="n">x</span>
        <span class="n">m</span><span class="o">.</span><span class="n">e</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">g</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="o">.</span><span class="n">y</span>
        <span class="n">m</span><span class="o">.</span><span class="n">i</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">j</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">z</span><span class="o">.</span><span class="n">z</span>
        
        <span class="k">return</span> <span class="n">m</span>
</div>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="Matrix4.new_look_at"><a class="viewcode-back" href="../modules/geom.html#geom.Matrix4.new_look_at">[docs]</a>    <span class="k">def</span> <span class="nf">new_look_at</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">eye</span><span class="p">,</span> <span class="n">at</span><span class="p">,</span> <span class="n">up</span><span class="p">):</span>
        <span class="n">z</span> <span class="o">=</span> <span class="p">(</span><span class="n">eye</span> <span class="o">-</span> <span class="n">at</span><span class="p">)</span><span class="o">.</span><span class="n">normalized</span><span class="p">()</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">up</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">z</span><span class="p">)</span><span class="o">.</span><span class="n">normalized</span><span class="p">()</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">z</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        
        <span class="n">m</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">new_rotate_triple_axis</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
        <span class="n">m</span><span class="o">.</span><span class="n">d</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">h</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">l</span> <span class="o">=</span> <span class="n">eye</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">eye</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">eye</span><span class="o">.</span><span class="n">z</span>
        <span class="k">return</span> <span class="n">m</span>
    </div>
    <span class="nd">@classmethod</span>    
<div class="viewcode-block" id="Matrix4.new_perspective"><a class="viewcode-back" href="../modules/geom.html#geom.Matrix4.new_perspective">[docs]</a>    <span class="k">def</span> <span class="nf">new_perspective</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">fov_y</span><span class="p">,</span> <span class="n">aspect</span><span class="p">,</span> <span class="n">near</span><span class="p">,</span> <span class="n">far</span><span class="p">):</span>
        <span class="c"># from the gluPerspective man page</span>
        <span class="n">f</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">tan</span><span class="p">(</span><span class="n">fov_y</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span> <span class="o">=</span> <span class="n">cls</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">near</span> <span class="o">!=</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="n">near</span> <span class="o">!=</span> <span class="n">far</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">f</span> <span class="o">/</span> <span class="n">aspect</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">f</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="p">(</span><span class="n">far</span> <span class="o">+</span> <span class="n">near</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">near</span> <span class="o">-</span> <span class="n">far</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">l</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">far</span> <span class="o">*</span> <span class="n">near</span> <span class="o">/</span> <span class="p">(</span><span class="n">near</span> <span class="o">-</span> <span class="n">far</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">o</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="bp">self</span>
</div>
<div class="viewcode-block" id="Matrix4.determinant"><a class="viewcode-back" href="../modules/geom.html#geom.Matrix4.determinant">[docs]</a>    <span class="k">def</span> <span class="nf">determinant</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">e</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">)</span>
              <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">o</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">l</span><span class="p">)</span>
              <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">j</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">)</span>
              <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">g</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">o</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">)</span>
              <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">)</span>
              <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">g</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">l</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">)</span>
              <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">j</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">)</span>
              <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">o</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">)</span>
              <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">)</span>
              <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">l</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">)</span>
              <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">j</span><span class="p">)</span>
              <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">g</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Matrix4.inverse"><a class="viewcode-back" href="../modules/geom.html#geom.Matrix4.inverse">[docs]</a>    <span class="k">def</span> <span class="nf">inverse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">Matrix4</span><span class="p">()</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">determinant</span><span class="p">();</span>

        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.001</span><span class="p">:</span>
            <span class="c"># No inverse, return identity</span>
            <span class="k">return</span> <span class="n">tmp</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">d</span><span class="p">;</span>

            <span class="n">tmp</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">d</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">o</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">l</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">j</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">o</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">g</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">g</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">l</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">));</span>
            <span class="n">tmp</span><span class="o">.</span><span class="n">e</span> <span class="o">=</span> <span class="n">d</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">g</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">l</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">e</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">o</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">l</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">));</span>
            <span class="n">tmp</span><span class="o">.</span><span class="n">i</span> <span class="o">=</span> <span class="n">d</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">j</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">l</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">e</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">j</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">));</span>
            <span class="n">tmp</span><span class="o">.</span><span class="n">m</span> <span class="o">=</span> <span class="n">d</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">j</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">o</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">o</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">g</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">j</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">g</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">));</span>
            
            <span class="n">tmp</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">d</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">j</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">o</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">l</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">o</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">l</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">));</span>
            <span class="n">tmp</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">d</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">o</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">l</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">l</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">));</span>
            <span class="n">tmp</span><span class="o">.</span><span class="n">j</span> <span class="o">=</span> <span class="n">d</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">l</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">j</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">j</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">));</span>
            <span class="n">tmp</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">d</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">o</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">j</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">j</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">o</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">));</span>
            
            <span class="n">tmp</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">d</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">g</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">g</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">o</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">o</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">));</span>
            <span class="n">tmp</span><span class="o">.</span><span class="n">g</span> <span class="o">=</span> <span class="n">d</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">o</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">e</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">g</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">));</span>
            <span class="n">tmp</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">d</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">e</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">));</span>
            <span class="n">tmp</span><span class="o">.</span><span class="n">o</span> <span class="o">=</span> <span class="n">d</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">g</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">g</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">o</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">e</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">o</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">));</span>
            
            <span class="n">tmp</span><span class="o">.</span><span class="n">d</span> <span class="o">=</span> <span class="n">d</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">g</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">l</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">l</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">j</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">g</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">));</span>
            <span class="n">tmp</span><span class="o">.</span><span class="n">h</span> <span class="o">=</span> <span class="n">d</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">e</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">l</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">g</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">l</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">));</span>
            <span class="n">tmp</span><span class="o">.</span><span class="n">l</span> <span class="o">=</span> <span class="n">d</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">e</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">j</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">j</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">l</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">));</span>
            <span class="n">tmp</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">d</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">j</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">g</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">e</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">j</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">g</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">));</span>

        <span class="k">return</span> <span class="n">tmp</span><span class="p">;</span>
        </div></div>
<div class="viewcode-block" id="Quaternion"><a class="viewcode-back" href="../modules/geom.html#geom.Quaternion">[docs]</a><span class="k">class</span> <span class="nc">Quaternion</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A quaternion represents a three-dimensional rotation or reflection</span>
<span class="sd">    transformation.  They are the preferred way to store and manipulate</span>
<span class="sd">    rotations in 3D applications, as they do not suffer the same numerical</span>
<span class="sd">    degredation that matrices do.</span>
<span class="sd">    </span>
<span class="sd">    The quaternion constructor initializes to the identity transform::</span>
<span class="sd">    </span>
<span class="sd">        &gt;&gt;&gt; q = Quaternion()</span>
<span class="sd">        &gt;&gt;&gt; q</span>
<span class="sd">        Quaternion(real=1.00, imag=&lt;0.00, 0.00, 0.00&gt;)</span>
<span class="sd">    </span>
<span class="sd">    **Element access**</span>
<span class="sd">    </span>
<span class="sd">    Internally, the quaternion is stored as four attributes: ``x``, ``y`` and</span>
<span class="sd">    ``z`` forming the imaginary vector, and ``w`` the real component.</span>
<span class="sd">    </span>
<span class="sd">    **Constructors**</span>
<span class="sd">    </span>
<span class="sd">    Rotations can be formed using the constructors:</span>
<span class="sd">    </span>
<span class="sd">    ``new_identity()``</span>
<span class="sd">        Equivalent to the default constructor.</span>
<span class="sd">    </span>
<span class="sd">    ``new_rotate_axis(angle, axis)``</span>
<span class="sd">        Equivalent to the Matrix4 constructor of the same name.  *angle* is</span>
<span class="sd">        specified in radians, *axis* is an instance of **Vector3**.  It is</span>
<span class="sd">        not necessary to normalize the axis.  Example::</span>
<span class="sd">    </span>
<span class="sd">            &gt;&gt;&gt; q = Quaternion.new_rotate_axis(math.pi / 2, Vector3(1, 0, 0))</span>
<span class="sd">            &gt;&gt;&gt; q</span>
<span class="sd">            Quaternion(real=0.71, imag=&lt;0.71, 0.00, 0.00&gt;)</span>
<span class="sd">    </span>
<span class="sd">    ``new_rotate_euler(heading, attitude, bank)``</span>
<span class="sd">        Equivalent to the Matrix4 constructor of the same name.  *heading*</span>
<span class="sd">        is a rotation around the Y axis, *attitude* around the X axis and</span>
<span class="sd">        *bank* around the Z axis.  All angles are given in radians.  Example::</span>
<span class="sd">    </span>
<span class="sd">            &gt;&gt;&gt; q = Quaternion.new_rotate_euler(math.pi / 2, math.pi / 2, 0)</span>
<span class="sd">            &gt;&gt;&gt; q</span>
<span class="sd">            Quaternion(real=0.50, imag=&lt;0.50, 0.50, 0.50&gt;)</span>
<span class="sd">    </span>
<span class="sd">    ``new_interpolate(q1, q2, t)``</span>
<span class="sd">        Create a quaternion which gives a (SLERP) interpolated rotation</span>
<span class="sd">        between *q1* and *q2*.  *q1* and *q2* are instances of **Quaternion**,</span>
<span class="sd">        and *t* is a value between 0.0 and 1.0.  For example::</span>
<span class="sd">    </span>
<span class="sd">            &gt;&gt;&gt; q1 = Quaternion.new_rotate_axis(math.pi / 2, Vector3(1, 0, 0))</span>
<span class="sd">            &gt;&gt;&gt; q2 = Quaternion.new_rotate_axis(math.pi / 2, Vector3(0, 1, 0))</span>
<span class="sd">            &gt;&gt;&gt; for i in range(11):</span>
<span class="sd">            ...     print Quaternion.new_interpolate(q1, q2, i / 10.0)</span>
<span class="sd">            ...</span>
<span class="sd">            Quaternion(real=0.71, imag=&lt;0.71, 0.00, 0.00&gt;)</span>
<span class="sd">            Quaternion(real=0.75, imag=&lt;0.66, 0.09, 0.00&gt;)</span>
<span class="sd">            Quaternion(real=0.78, imag=&lt;0.61, 0.17, 0.00&gt;)</span>
<span class="sd">            Quaternion(real=0.80, imag=&lt;0.55, 0.25, 0.00&gt;)</span>
<span class="sd">            Quaternion(real=0.81, imag=&lt;0.48, 0.33, 0.00&gt;)</span>
<span class="sd">            Quaternion(real=0.82, imag=&lt;0.41, 0.41, 0.00&gt;)</span>
<span class="sd">            Quaternion(real=0.81, imag=&lt;0.33, 0.48, 0.00&gt;)</span>
<span class="sd">            Quaternion(real=0.80, imag=&lt;0.25, 0.55, 0.00&gt;)</span>
<span class="sd">            Quaternion(real=0.78, imag=&lt;0.17, 0.61, 0.00&gt;)</span>
<span class="sd">            Quaternion(real=0.75, imag=&lt;0.09, 0.66, 0.00&gt;)</span>
<span class="sd">            Quaternion(real=0.71, imag=&lt;0.00, 0.71, 0.00&gt;)</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    **Operators**</span>
<span class="sd">    </span>
<span class="sd">    Quaternions may be multiplied to compound rotations.  For example, to</span>
<span class="sd">    rotate 90 degrees around the X axis and then 90 degrees around the Y axis::</span>
<span class="sd">    </span>
<span class="sd">        &gt;&gt;&gt; q1 = Quaternion.new_rotate_axis(math.pi / 2, Vector3(1, 0, 0))</span>
<span class="sd">        &gt;&gt;&gt; q2 = Quaternion.new_rotate_axis(math.pi / 2, Vector3(0, 1, 0))</span>
<span class="sd">        &gt;&gt;&gt; q1 * q2</span>
<span class="sd">        Quaternion(real=0.50, imag=&lt;0.50, 0.50, 0.50&gt;)</span>
<span class="sd">    </span>
<span class="sd">    Multiplying a quaternion by a vector gives a vector, transformed</span>
<span class="sd">    appropriately::</span>
<span class="sd">    </span>
<span class="sd">        &gt;&gt;&gt; q = Quaternion.new_rotate_axis(math.pi / 2, Vector3(0, 1, 0))</span>
<span class="sd">        &gt;&gt;&gt; q * Vector3(1.0, 0, 0)</span>
<span class="sd">        Vector3(0.00, 0.00, -1.00)</span>
<span class="sd">    </span>
<span class="sd">    Similarly, any 3D object can be multiplied (e.g., **Point3**, **Line3**,</span>
<span class="sd">    **Sphere**, etc)::</span>
<span class="sd">    </span>
<span class="sd">        &gt;&gt;&gt; q * Ray3(Point3(1., 1., 1.), Vector3(1., 1., 1.))</span>
<span class="sd">        Ray3(&lt;1.00, 1.00, -1.00&gt; + u&lt;1.00, 1.00, -1.00&gt;)</span>
<span class="sd">    </span>
<span class="sd">    As with the matrix classes, the constructors are also available as in-place</span>
<span class="sd">    operators.  These are named ``identity``, ``rotate_euler`` and</span>
<span class="sd">    ``rotate_axis``.  For example::</span>
<span class="sd">    </span>
<span class="sd">        &gt;&gt;&gt; q1 = Quaternion()</span>
<span class="sd">        &gt;&gt;&gt; q1.rotate_euler(math.pi / 2, math.pi / 2, 0)</span>
<span class="sd">        Quaternion(real=0.50, imag=&lt;0.50, 0.50, 0.50&gt;)</span>
<span class="sd">        &gt;&gt;&gt; q1</span>
<span class="sd">        Quaternion(real=0.50, imag=&lt;0.50, 0.50, 0.50&gt;)</span>
<span class="sd">    </span>
<span class="sd">    Quaternions are usually unit length, but you may wish to use sized</span>
<span class="sd">    quaternions.  In this case, you can find the magnitude using ``abs``,</span>
<span class="sd">    ``magnitude`` and ``magnitude_squared``, as with the vector classes.</span>
<span class="sd">    Example::</span>
<span class="sd">    </span>
<span class="sd">        &gt;&gt;&gt; q1 = Quaternion()</span>
<span class="sd">        &gt;&gt;&gt; abs(q1)</span>
<span class="sd">        1.0</span>
<span class="sd">        &gt;&gt;&gt; q1.magnitude()</span>
<span class="sd">        1.0</span>
<span class="sd">    </span>
<span class="sd">    Similarly, the class implements ``normalize`` and ``normalized`` in the</span>
<span class="sd">    same way as the vectors.</span>
<span class="sd">    </span>
<span class="sd">    The following methods do not alter the quaternion:</span>
<span class="sd">    </span>
<span class="sd">    ``conjugated()``</span>
<span class="sd">        Returns a quaternion that is the conjugate of the instance.  For</span>
<span class="sd">        example::</span>
<span class="sd">            </span>
<span class="sd">            &gt;&gt;&gt; q1 = Quaternion.new_rotate_axis(math.pi / 2, Vector3(1, 0, 0))</span>
<span class="sd">            &gt;&gt;&gt; q1.conjugated()</span>
<span class="sd">            Quaternion(real=0.71, imag=&lt;-0.71, -0.00, -0.00&gt;)</span>
<span class="sd">            &gt;&gt;&gt; q1</span>
<span class="sd">            Quaternion(real=0.71, imag=&lt;0.71, 0.00, 0.00&gt;)</span>
<span class="sd">    </span>
<span class="sd">    ``get_angle_axis()``</span>
<span class="sd">        Returns a tuple (angle, axis), giving the angle to rotate around an</span>
<span class="sd">        axis equivalent to the quaternion.  For example::</span>
<span class="sd">    </span>
<span class="sd">            &gt;&gt;&gt; q1 = Quaternion.new_rotate_axis(math.pi / 2, Vector3(1, 0, 0))</span>
<span class="sd">            &gt;&gt;&gt; q1.get_angle_axis()</span>
<span class="sd">            (1.5707963267948966, Vector3(1.00, 0.00, 0.00))</span>
<span class="sd">    </span>
<span class="sd">    ``get_matrix()``</span>
<span class="sd">        Returns a **Matrix4** implementing the transformation of the quaternion.</span>
<span class="sd">        For example::</span>
<span class="sd">            </span>
<span class="sd">            &gt;&gt;&gt; q1 = Quaternion.new_rotate_axis(math.pi / 2, Vector3(1, 0, 0))</span>
<span class="sd">            &gt;&gt;&gt; q1.get_matrix()</span>
<span class="sd">            Matrix4([    1.00     0.00     0.00     0.00</span>
<span class="sd">                         0.00     0.00    -1.00     0.00</span>
<span class="sd">                         0.00     1.00     0.00     0.00</span>
<span class="sd">                         0.00     0.00     0.00     1.00])</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># All methods and naming conventions based off </span>
    <span class="c"># http://www.euclideanspace.com/maths/algebra/realNormedAlgebra/quaternions</span>

    <span class="c"># w is the real part, (x, y, z) are the imaginary parts</span>

<div class="viewcode-block" id="Quaternion.__init__"><a class="viewcode-back" href="../modules/geom.html#geom.Quaternion.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">=</span> <span class="n">w</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">z</span>
</div>
<div class="viewcode-block" id="Quaternion.__copy__"><a class="viewcode-back" href="../modules/geom.html#geom.Quaternion.__copy__">[docs]</a>    <span class="k">def</span> <span class="nf">__copy__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Q</span> <span class="o">=</span> <span class="n">Quaternion</span><span class="p">()</span>
        <span class="n">Q</span><span class="o">.</span><span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span>
        <span class="n">Q</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
        <span class="n">Q</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
        <span class="n">Q</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span>
        <span class="k">return</span> <span class="n">Q</span>
</div>
    <span class="n">copy</span> <span class="o">=</span> <span class="n">__copy__</span>

<div class="viewcode-block" id="Quaternion.__repr__"><a class="viewcode-back" href="../modules/geom.html#geom.Quaternion.__repr__">[docs]</a>    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">(</span><span class="si">%g</span><span class="s">,</span><span class="si">%g</span><span class="s">,</span><span class="si">%g</span><span class="s">,</span><span class="si">%g</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Quaternion.__mul__"><a class="viewcode-back" href="../modules/geom.html#geom.Quaternion.__mul__">[docs]</a>    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Quaternion</span><span class="p">):</span>
            <span class="n">Ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
            <span class="n">Ay</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
            <span class="n">Az</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span>
            <span class="n">Aw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span>
            <span class="n">Bx</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">x</span>
            <span class="n">By</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">y</span>
            <span class="n">Bz</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">z</span>
            <span class="n">Bw</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">w</span>
            <span class="n">Q</span> <span class="o">=</span> <span class="n">Quaternion</span><span class="p">()</span>
            <span class="n">Q</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span>  <span class="n">Ax</span> <span class="o">*</span> <span class="n">Bw</span> <span class="o">+</span> <span class="n">Ay</span> <span class="o">*</span> <span class="n">Bz</span> <span class="o">-</span> <span class="n">Az</span> <span class="o">*</span> <span class="n">By</span> <span class="o">+</span> <span class="n">Aw</span> <span class="o">*</span> <span class="n">Bx</span>    
            <span class="n">Q</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="n">Ax</span> <span class="o">*</span> <span class="n">Bz</span> <span class="o">+</span> <span class="n">Ay</span> <span class="o">*</span> <span class="n">Bw</span> <span class="o">+</span> <span class="n">Az</span> <span class="o">*</span> <span class="n">Bx</span> <span class="o">+</span> <span class="n">Aw</span> <span class="o">*</span> <span class="n">By</span>
            <span class="n">Q</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span>  <span class="n">Ax</span> <span class="o">*</span> <span class="n">By</span> <span class="o">-</span> <span class="n">Ay</span> <span class="o">*</span> <span class="n">Bx</span> <span class="o">+</span> <span class="n">Az</span> <span class="o">*</span> <span class="n">Bw</span> <span class="o">+</span> <span class="n">Aw</span> <span class="o">*</span> <span class="n">Bz</span>
            <span class="n">Q</span><span class="o">.</span><span class="n">w</span> <span class="o">=</span> <span class="o">-</span><span class="n">Ax</span> <span class="o">*</span> <span class="n">Bx</span> <span class="o">-</span> <span class="n">Ay</span> <span class="o">*</span> <span class="n">By</span> <span class="o">-</span> <span class="n">Az</span> <span class="o">*</span> <span class="n">Bz</span> <span class="o">+</span> <span class="n">Aw</span> <span class="o">*</span> <span class="n">Bw</span>
            <span class="k">return</span> <span class="n">Q</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Vector3</span><span class="p">):</span>
            <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span>
            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
            <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
            <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span>
            <span class="n">Vx</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">x</span>
            <span class="n">Vy</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">y</span>
            <span class="n">Vz</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">z</span>
            <span class="n">ww</span> <span class="o">=</span> <span class="n">w</span> <span class="o">*</span> <span class="n">w</span>
            <span class="n">w2</span> <span class="o">=</span> <span class="n">w</span> <span class="o">*</span> <span class="mi">2</span>
            <span class="n">wx2</span> <span class="o">=</span> <span class="n">w2</span> <span class="o">*</span> <span class="n">x</span>
            <span class="n">wy2</span> <span class="o">=</span> <span class="n">w2</span> <span class="o">*</span> <span class="n">y</span>
            <span class="n">wz2</span> <span class="o">=</span> <span class="n">w2</span> <span class="o">*</span> <span class="n">z</span>
            <span class="n">xx</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span>
            <span class="n">x2</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="mi">2</span>
            <span class="n">xy2</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">y</span>
            <span class="n">xz2</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">z</span>
            <span class="n">yy</span> <span class="o">=</span> <span class="n">y</span> <span class="o">*</span> <span class="n">y</span>
            <span class="n">yz2</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">y</span> <span class="o">*</span> <span class="n">z</span>
            <span class="n">zz</span> <span class="o">=</span> <span class="n">z</span> <span class="o">*</span> <span class="n">z</span>
            <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span>\
               <span class="n">ww</span> <span class="o">*</span> <span class="n">Vx</span> <span class="o">+</span> <span class="n">wy2</span> <span class="o">*</span> <span class="n">Vz</span> <span class="o">-</span> <span class="n">wz2</span> <span class="o">*</span> <span class="n">Vy</span> <span class="o">+</span> \
               <span class="n">xx</span> <span class="o">*</span> <span class="n">Vx</span> <span class="o">+</span> <span class="n">xy2</span> <span class="o">*</span> <span class="n">Vy</span> <span class="o">+</span> <span class="n">xz2</span> <span class="o">*</span> <span class="n">Vz</span> <span class="o">-</span> \
               <span class="n">zz</span> <span class="o">*</span> <span class="n">Vx</span> <span class="o">-</span> <span class="n">yy</span> <span class="o">*</span> <span class="n">Vx</span><span class="p">,</span>
               <span class="n">xy2</span> <span class="o">*</span> <span class="n">Vx</span> <span class="o">+</span> <span class="n">yy</span> <span class="o">*</span> <span class="n">Vy</span> <span class="o">+</span> <span class="n">yz2</span> <span class="o">*</span> <span class="n">Vz</span> <span class="o">+</span> \
               <span class="n">wz2</span> <span class="o">*</span> <span class="n">Vx</span> <span class="o">-</span> <span class="n">zz</span> <span class="o">*</span> <span class="n">Vy</span> <span class="o">+</span> <span class="n">ww</span> <span class="o">*</span> <span class="n">Vy</span> <span class="o">-</span> \
               <span class="n">wx2</span> <span class="o">*</span> <span class="n">Vz</span> <span class="o">-</span> <span class="n">xx</span> <span class="o">*</span> <span class="n">Vy</span><span class="p">,</span>
               <span class="n">xz2</span> <span class="o">*</span> <span class="n">Vx</span> <span class="o">+</span> <span class="n">yz2</span> <span class="o">*</span> <span class="n">Vy</span> <span class="o">+</span> \
               <span class="n">zz</span> <span class="o">*</span> <span class="n">Vz</span> <span class="o">-</span> <span class="n">wy2</span> <span class="o">*</span> <span class="n">Vx</span> <span class="o">-</span> <span class="n">yy</span> <span class="o">*</span> <span class="n">Vz</span> <span class="o">+</span> \
               <span class="n">wx2</span> <span class="o">*</span> <span class="n">Vy</span> <span class="o">-</span> <span class="n">xx</span> <span class="o">*</span> <span class="n">Vz</span> <span class="o">+</span> <span class="n">ww</span> <span class="o">*</span> <span class="n">Vz</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">other</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">other</span><span class="o">.</span><span class="n">_apply_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">other</span>
</div>
<div class="viewcode-block" id="Quaternion.__imul__"><a class="viewcode-back" href="../modules/geom.html#geom.Quaternion.__imul__">[docs]</a>    <span class="k">def</span> <span class="nf">__imul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Quaternion</span><span class="p">)</span>
        <span class="n">Ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
        <span class="n">Ay</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
        <span class="n">Az</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span>
        <span class="n">Aw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span>
        <span class="n">Bx</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">x</span>
        <span class="n">By</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">y</span>
        <span class="n">Bz</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">z</span>
        <span class="n">Bw</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">w</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span>  <span class="n">Ax</span> <span class="o">*</span> <span class="n">Bw</span> <span class="o">+</span> <span class="n">Ay</span> <span class="o">*</span> <span class="n">Bz</span> <span class="o">-</span> <span class="n">Az</span> <span class="o">*</span> <span class="n">By</span> <span class="o">+</span> <span class="n">Aw</span> <span class="o">*</span> <span class="n">Bx</span>    
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="n">Ax</span> <span class="o">*</span> <span class="n">Bz</span> <span class="o">+</span> <span class="n">Ay</span> <span class="o">*</span> <span class="n">Bw</span> <span class="o">+</span> <span class="n">Az</span> <span class="o">*</span> <span class="n">Bx</span> <span class="o">+</span> <span class="n">Aw</span> <span class="o">*</span> <span class="n">By</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span>  <span class="n">Ax</span> <span class="o">*</span> <span class="n">By</span> <span class="o">-</span> <span class="n">Ay</span> <span class="o">*</span> <span class="n">Bx</span> <span class="o">+</span> <span class="n">Az</span> <span class="o">*</span> <span class="n">Bw</span> <span class="o">+</span> <span class="n">Aw</span> <span class="o">*</span> <span class="n">Bz</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">=</span> <span class="o">-</span><span class="n">Ax</span> <span class="o">*</span> <span class="n">Bx</span> <span class="o">-</span> <span class="n">Ay</span> <span class="o">*</span> <span class="n">By</span> <span class="o">-</span> <span class="n">Az</span> <span class="o">*</span> <span class="n">Bz</span> <span class="o">+</span> <span class="n">Aw</span> <span class="o">*</span> <span class="n">Bw</span>
        <span class="k">return</span> <span class="bp">self</span>
    
</div>
<div class="viewcode-block" id="Quaternion.mag2"><a class="viewcode-back" href="../modules/geom.html#geom.Quaternion.mag2">[docs]</a>    <span class="k">def</span> <span class="nf">mag2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">**</span> <span class="mi">2</span> 
</div>
<div class="viewcode-block" id="Quaternion.__abs__"><a class="viewcode-back" href="../modules/geom.html#geom.Quaternion.__abs__">[docs]</a>    <span class="k">def</span> <span class="nf">__abs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mag2</span><span class="p">())</span>
            </div>
    <span class="n">mag</span> <span class="o">=</span> <span class="n">__abs__</span>



<div class="viewcode-block" id="Quaternion.identity"><a class="viewcode-back" href="../modules/geom.html#geom.Quaternion.identity">[docs]</a>    <span class="k">def</span> <span class="nf">identity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="bp">self</span>
</div>
<div class="viewcode-block" id="Quaternion.rotate_axis"><a class="viewcode-back" href="../modules/geom.html#geom.Quaternion.rotate_axis">[docs]</a>    <span class="k">def</span> <span class="nf">rotate_axis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>
        <span class="bp">self</span> <span class="o">*=</span> <span class="n">Quaternion</span><span class="o">.</span><span class="n">new_rotate_axis</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span> <span class="n">axis</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>
</div>
<div class="viewcode-block" id="Quaternion.rotate_euler"><a class="viewcode-back" href="../modules/geom.html#geom.Quaternion.rotate_euler">[docs]</a>    <span class="k">def</span> <span class="nf">rotate_euler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">heading</span><span class="p">,</span> <span class="n">attitude</span><span class="p">,</span> <span class="n">bank</span><span class="p">):</span>
        <span class="bp">self</span> <span class="o">*=</span> <span class="n">Quaternion</span><span class="o">.</span><span class="n">new_rotate_euler</span><span class="p">(</span><span class="n">heading</span><span class="p">,</span> <span class="n">attitude</span><span class="p">,</span> <span class="n">bank</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>
</div>
<div class="viewcode-block" id="Quaternion.rotate_matrix"><a class="viewcode-back" href="../modules/geom.html#geom.Quaternion.rotate_matrix">[docs]</a>    <span class="k">def</span> <span class="nf">rotate_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
        <span class="bp">self</span> <span class="o">*=</span> <span class="n">Quaternion</span><span class="o">.</span><span class="n">new_rotate_matrix</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>
</div>
<div class="viewcode-block" id="Quaternion.conjugated"><a class="viewcode-back" href="../modules/geom.html#geom.Quaternion.conjugated">[docs]</a>    <span class="k">def</span> <span class="nf">conjugated</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Q</span> <span class="o">=</span> <span class="n">Quaternion</span><span class="p">()</span>
        <span class="n">Q</span><span class="o">.</span><span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span>
        <span class="n">Q</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span>
        <span class="n">Q</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span>
        <span class="n">Q</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span>
        <span class="k">return</span> <span class="n">Q</span>
</div>
<div class="viewcode-block" id="Quaternion.normalize"><a class="viewcode-back" href="../modules/geom.html#geom.Quaternion.normalize">[docs]</a>    <span class="k">def</span> <span class="nf">normalize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mag</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">d</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">/=</span> <span class="n">d</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">/=</span> <span class="n">d</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">/=</span> <span class="n">d</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">/=</span> <span class="n">d</span>
        <span class="k">return</span> <span class="bp">self</span>
</div>
<div class="viewcode-block" id="Quaternion.normalized"><a class="viewcode-back" href="../modules/geom.html#geom.Quaternion.normalized">[docs]</a>    <span class="k">def</span> <span class="nf">normalized</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mag</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">d</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">Q</span> <span class="o">=</span> <span class="n">Quaternion</span><span class="p">()</span>
            <span class="n">Q</span><span class="o">.</span><span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">/</span> <span class="n">d</span>
            <span class="n">Q</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">/</span> <span class="n">d</span>
            <span class="n">Q</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">/</span> <span class="n">d</span>
            <span class="n">Q</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">/</span> <span class="n">d</span>
            <span class="k">return</span> <span class="n">Q</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Quaternion.get_angle_axis"><a class="viewcode-back" href="../modules/geom.html#geom.Quaternion.get_angle_axis">[docs]</a>    <span class="k">def</span> <span class="nf">get_angle_axis</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalized</span><span class="p">()</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">acos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">s</span> <span class="o">&lt;</span> <span class="mf">0.001</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">angle</span><span class="p">,</span> <span class="n">Vector3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">angle</span><span class="p">,</span> <span class="n">Vector3</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">/</span> <span class="n">s</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">/</span> <span class="n">s</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">/</span> <span class="n">s</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Quaternion.get_euler"><a class="viewcode-back" href="../modules/geom.html#geom.Quaternion.get_euler">[docs]</a>    <span class="k">def</span> <span class="nf">get_euler</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span>
        <span class="k">if</span> <span class="n">t</span> <span class="o">&gt;</span> <span class="mf">0.4999</span><span class="p">:</span>
            <span class="n">heading</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">atan2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">)</span>
            <span class="n">attitude</span> <span class="o">=</span> <span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">bank</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">0.4999</span><span class="p">:</span>
            <span class="n">heading</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">atan2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">)</span>
            <span class="n">attitude</span> <span class="o">=</span> <span class="o">-</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">bank</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sqx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span>
            <span class="n">sqy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">**</span> <span class="mi">2</span>
            <span class="n">sqz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">**</span> <span class="mi">2</span>
            <span class="n">heading</span> <span class="o">=</span> <span class="n">atan2</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">,</span>
                                 <span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">sqy</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">sqz</span><span class="p">)</span>
            <span class="n">attitude</span> <span class="o">=</span> <span class="n">asin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>
            <span class="n">bank</span> <span class="o">=</span> <span class="n">atan2</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">,</span>
                              <span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">sqx</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">sqz</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">heading</span><span class="p">,</span> <span class="n">attitude</span><span class="p">,</span> <span class="n">bank</span>
</div>
<div class="viewcode-block" id="Quaternion.get_matrix"><a class="viewcode-back" href="../modules/geom.html#geom.Quaternion.get_matrix">[docs]</a>    <span class="k">def</span> <span class="nf">get_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">xx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="n">xy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
        <span class="n">xz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span>
        <span class="n">xw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span>
        <span class="n">yy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="n">yz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span>
        <span class="n">yw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span>
        <span class="n">zz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="n">zw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span>
        <span class="n">M</span> <span class="o">=</span> <span class="n">Matrix4</span><span class="p">()</span>
        <span class="n">M</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">yy</span> <span class="o">+</span> <span class="n">zz</span><span class="p">)</span>
        <span class="n">M</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">xy</span> <span class="o">-</span> <span class="n">zw</span><span class="p">)</span>
        <span class="n">M</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">xz</span> <span class="o">+</span> <span class="n">yw</span><span class="p">)</span>
        <span class="n">M</span><span class="o">.</span><span class="n">e</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">xy</span> <span class="o">+</span> <span class="n">zw</span><span class="p">)</span>
        <span class="n">M</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">xx</span> <span class="o">+</span> <span class="n">zz</span><span class="p">)</span>
        <span class="n">M</span><span class="o">.</span><span class="n">g</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">yz</span> <span class="o">-</span> <span class="n">xw</span><span class="p">)</span>
        <span class="n">M</span><span class="o">.</span><span class="n">i</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">xz</span> <span class="o">-</span> <span class="n">yw</span><span class="p">)</span>
        <span class="n">M</span><span class="o">.</span><span class="n">j</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">yz</span> <span class="o">+</span> <span class="n">xw</span><span class="p">)</span>
        <span class="n">M</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">xx</span> <span class="o">+</span> <span class="n">yy</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">M</span>

    <span class="c"># Static constructors</span></div>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="Quaternion.new_identity"><a class="viewcode-back" href="../modules/geom.html#geom.Quaternion.new_identity">[docs]</a>    <span class="k">def</span> <span class="nf">new_identity</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">cls</span><span class="p">()</span>
</div>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="Quaternion.new_rotate_axis"><a class="viewcode-back" href="../modules/geom.html#geom.Quaternion.new_rotate_axis">[docs]</a>    <span class="k">def</span> <span class="nf">new_rotate_axis</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>
        <span class="k">assert</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">Vector3</span><span class="p">))</span>
        <span class="n">axis</span> <span class="o">=</span> <span class="n">axis</span><span class="o">.</span><span class="n">normalized</span><span class="p">()</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">angle</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">Q</span> <span class="o">=</span> <span class="n">cls</span><span class="p">()</span>
        <span class="n">Q</span><span class="o">.</span><span class="n">w</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">angle</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">Q</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">axis</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">s</span>
        <span class="n">Q</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">axis</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">s</span>
        <span class="n">Q</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">axis</span><span class="o">.</span><span class="n">z</span> <span class="o">*</span> <span class="n">s</span>
        <span class="k">return</span> <span class="n">Q</span>
</div>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="Quaternion.new_rotate_euler"><a class="viewcode-back" href="../modules/geom.html#geom.Quaternion.new_rotate_euler">[docs]</a>    <span class="k">def</span> <span class="nf">new_rotate_euler</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">heading</span><span class="p">,</span> <span class="n">attitude</span><span class="p">,</span> <span class="n">bank</span><span class="p">):</span>
        <span class="n">Q</span> <span class="o">=</span> <span class="n">cls</span><span class="p">()</span>
        <span class="n">c1</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">heading</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">s1</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">heading</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">c2</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">attitude</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">s2</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">attitude</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">c3</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">bank</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">s3</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">bank</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">Q</span><span class="o">.</span><span class="n">w</span> <span class="o">=</span> <span class="n">c1</span> <span class="o">*</span> <span class="n">c2</span> <span class="o">*</span> <span class="n">c3</span> <span class="o">-</span> <span class="n">s1</span> <span class="o">*</span> <span class="n">s2</span> <span class="o">*</span> <span class="n">s3</span>
        <span class="n">Q</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">s1</span> <span class="o">*</span> <span class="n">s2</span> <span class="o">*</span> <span class="n">c3</span> <span class="o">+</span> <span class="n">c1</span> <span class="o">*</span> <span class="n">c2</span> <span class="o">*</span> <span class="n">s3</span>
        <span class="n">Q</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">s1</span> <span class="o">*</span> <span class="n">c2</span> <span class="o">*</span> <span class="n">c3</span> <span class="o">+</span> <span class="n">c1</span> <span class="o">*</span> <span class="n">s2</span> <span class="o">*</span> <span class="n">s3</span>
        <span class="n">Q</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">c1</span> <span class="o">*</span> <span class="n">s2</span> <span class="o">*</span> <span class="n">c3</span> <span class="o">-</span> <span class="n">s1</span> <span class="o">*</span> <span class="n">c2</span> <span class="o">*</span> <span class="n">s3</span>
        <span class="k">return</span> <span class="n">Q</span>
    </div>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="Quaternion.new_rotate_matrix"><a class="viewcode-back" href="../modules/geom.html#geom.Quaternion.new_rotate_matrix">[docs]</a>    <span class="k">def</span> <span class="nf">new_rotate_matrix</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.00000001</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1.0</span>
            <span class="n">s</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">/</span><span class="n">sqrt</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        
            <span class="k">return</span> <span class="n">cls</span><span class="p">(</span>
              <span class="n">s</span><span class="o">*</span><span class="n">t</span><span class="p">,</span>
              <span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">m</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">s</span><span class="p">,</span>
              <span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">2</span><span class="p">])</span><span class="o">*</span><span class="n">s</span><span class="p">,</span>
              <span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">s</span>
              <span class="p">)</span>
        
        <span class="k">elif</span> <span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">m</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">m</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1.0</span>
            <span class="n">s</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">/</span><span class="n">sqrt</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
            
            <span class="k">return</span> <span class="n">cls</span><span class="p">(</span>
              <span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">m</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">s</span><span class="p">,</span>
              <span class="n">s</span><span class="o">*</span><span class="n">t</span><span class="p">,</span>
              <span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">s</span><span class="p">,</span>
              <span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">2</span><span class="p">])</span><span class="o">*</span><span class="n">s</span>
              <span class="p">)</span>
        
        <span class="k">elif</span> <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">m</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="o">-</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">m</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1.0</span>
            <span class="n">s</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">/</span><span class="n">sqrt</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
            
            <span class="k">return</span> <span class="n">cls</span><span class="p">(</span>
              <span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">2</span><span class="p">])</span><span class="o">*</span><span class="n">s</span><span class="p">,</span>
              <span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">s</span><span class="p">,</span>
              <span class="n">s</span><span class="o">*</span><span class="n">t</span><span class="p">,</span>
              <span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">s</span>
              <span class="p">)</span>
        
        <span class="k">else</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="o">-</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1.0</span>
            <span class="n">s</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">/</span><span class="n">sqrt</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        
            <span class="k">return</span> <span class="n">cls</span><span class="p">(</span>
              <span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">s</span><span class="p">,</span>
              <span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">2</span><span class="p">])</span><span class="o">*</span><span class="n">s</span><span class="p">,</span>
              <span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">s</span><span class="p">,</span>
              <span class="n">s</span><span class="o">*</span><span class="n">t</span>
              <span class="p">)</span></div>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="Quaternion.new_interpolate"><a class="viewcode-back" href="../modules/geom.html#geom.Quaternion.new_interpolate">[docs]</a>    <span class="k">def</span> <span class="nf">new_interpolate</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">q1</span><span class="p">,</span> <span class="n">q2</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">q1</span><span class="p">,</span> <span class="n">Quaternion</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">q2</span><span class="p">,</span> <span class="n">Quaternion</span><span class="p">)</span>
        <span class="n">Q</span> <span class="o">=</span> <span class="n">cls</span><span class="p">()</span>

        <span class="n">costheta</span> <span class="o">=</span> <span class="n">q1</span><span class="o">.</span><span class="n">w</span> <span class="o">*</span> <span class="n">q2</span><span class="o">.</span><span class="n">w</span> <span class="o">+</span> <span class="n">q1</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">q2</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">q1</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">q2</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">q1</span><span class="o">.</span><span class="n">z</span> <span class="o">*</span> <span class="n">q2</span><span class="o">.</span><span class="n">z</span>
        <span class="k">if</span> <span class="n">costheta</span> <span class="o">&lt;</span> <span class="mf">0.</span><span class="p">:</span>
            <span class="n">costheta</span> <span class="o">=</span> <span class="o">-</span><span class="n">costheta</span>
            <span class="n">q1</span> <span class="o">=</span> <span class="n">q1</span><span class="o">.</span><span class="n">conjugated</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">costheta</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">costheta</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="n">theta</span> <span class="o">=</span> <span class="n">acos</span><span class="p">(</span><span class="n">costheta</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.01</span><span class="p">:</span>
            <span class="n">Q</span><span class="o">.</span><span class="n">w</span> <span class="o">=</span> <span class="n">q2</span><span class="o">.</span><span class="n">w</span>
            <span class="n">Q</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">q2</span><span class="o">.</span><span class="n">x</span>
            <span class="n">Q</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">q2</span><span class="o">.</span><span class="n">y</span>
            <span class="n">Q</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">q2</span><span class="o">.</span><span class="n">z</span>
            <span class="k">return</span> <span class="n">Q</span>

        <span class="n">sintheta</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">costheta</span> <span class="o">*</span> <span class="n">costheta</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">sintheta</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.01</span><span class="p">:</span>
            <span class="n">Q</span><span class="o">.</span><span class="n">w</span> <span class="o">=</span> <span class="p">(</span><span class="n">q1</span><span class="o">.</span><span class="n">w</span> <span class="o">+</span> <span class="n">q2</span><span class="o">.</span><span class="n">w</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span>
            <span class="n">Q</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">q1</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">q2</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span>
            <span class="n">Q</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">q1</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">q2</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span>
            <span class="n">Q</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="p">(</span><span class="n">q1</span><span class="o">.</span><span class="n">z</span> <span class="o">+</span> <span class="n">q2</span><span class="o">.</span><span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span>
            <span class="k">return</span> <span class="n">Q</span>

        <span class="n">ratio1</span> <span class="o">=</span> <span class="n">sin</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">t</span><span class="p">)</span> <span class="o">*</span> <span class="n">theta</span><span class="p">)</span> <span class="o">/</span> <span class="n">sintheta</span>
        <span class="n">ratio2</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">t</span> <span class="o">*</span> <span class="n">theta</span><span class="p">)</span> <span class="o">/</span> <span class="n">sintheta</span>

        <span class="n">Q</span><span class="o">.</span><span class="n">w</span> <span class="o">=</span> <span class="n">q1</span><span class="o">.</span><span class="n">w</span> <span class="o">*</span> <span class="n">ratio1</span> <span class="o">+</span> <span class="n">q2</span><span class="o">.</span><span class="n">w</span> <span class="o">*</span> <span class="n">ratio2</span>
        <span class="n">Q</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">q1</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">ratio1</span> <span class="o">+</span> <span class="n">q2</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">ratio2</span>
        <span class="n">Q</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">q1</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">ratio1</span> <span class="o">+</span> <span class="n">q2</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">ratio2</span>
        <span class="n">Q</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">q1</span><span class="o">.</span><span class="n">z</span> <span class="o">*</span> <span class="n">ratio1</span> <span class="o">+</span> <span class="n">q2</span><span class="o">.</span><span class="n">z</span> <span class="o">*</span> <span class="n">ratio2</span>
        <span class="k">return</span> <span class="n">Q</span>

<span class="c"># Geometry</span>
<span class="c"># Much maths thanks to Paul Bourke, http://astronomy.swin.edu.au/~pbourke</span>
<span class="c"># ---------------------------------------------------------------------------</span>
</div></div>
<span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABCMeta</span> <span class="c">#Abstract Base Class</span>
    
<div class="viewcode-block" id="Geometry"><a class="viewcode-back" href="../modules/geom.html#geom.Geometry">[docs]</a><span class="k">class</span> <span class="nc">Geometry</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The following classes are available for dealing with simple 2D geometry.</span>
<span class="sd">    The interface to each shape is similar; in particular, the ``connect``</span>
<span class="sd">    and ``distance`` methods are defined identically for each.</span>
<span class="sd">    </span>
<span class="sd">    For example, to find the closest point on a line to a circle::</span>
<span class="sd">    </span>
<span class="sd">        &gt;&gt;&gt; circ = Circle(Point2(3., 2.), 2.)</span>
<span class="sd">        &gt;&gt;&gt; line = Line2(Point2(0., 0.), Point2(-1., 1.))</span>
<span class="sd">        &gt;&gt;&gt; line.connect(circ).p1</span>
<span class="sd">        Point2(0.50, -0.50)</span>
<span class="sd">    </span>
<span class="sd">    To find the corresponding closest point on the circle to the line::</span>
<span class="sd">    </span>
<span class="sd">        &gt;&gt;&gt; line.connect(circ).p2</span>
<span class="sd">        Point2(1.59, 0.59)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">__metaclass__</span> <span class="o">=</span> <span class="n">ABCMeta</span>
    <span class="k">def</span> <span class="nf">_connect_unimplemented</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">,</span> <span class="s">&#39;Cannot connect </span><span class="si">%s</span><span class="s"> to </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> \
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">__class__</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_intersect_unimplemented</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">,</span> <span class="s">&#39;Cannot intersect </span><span class="si">%s</span><span class="s"> and </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> \
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">__class__</span><span class="p">)</span>

    <span class="n">_intersect_point2</span> <span class="o">=</span> <span class="n">_intersect_unimplemented</span>
    <span class="n">_intersect_line2</span> <span class="o">=</span> <span class="n">_intersect_unimplemented</span>
    <span class="n">_intersect_circle</span> <span class="o">=</span> <span class="n">_intersect_unimplemented</span>
    <span class="n">_connect_point2</span> <span class="o">=</span> <span class="n">_connect_unimplemented</span>
    <span class="n">_connect_line2</span> <span class="o">=</span> <span class="n">_connect_unimplemented</span>
    <span class="n">_connect_circle</span> <span class="o">=</span> <span class="n">_connect_unimplemented</span>

    <span class="n">_intersect_point3</span> <span class="o">=</span> <span class="n">_intersect_unimplemented</span>
    <span class="n">_intersect_line3</span> <span class="o">=</span> <span class="n">_intersect_unimplemented</span>
    <span class="n">_intersect_sphere</span> <span class="o">=</span> <span class="n">_intersect_unimplemented</span>
    <span class="n">_intersect_plane</span> <span class="o">=</span> <span class="n">_intersect_unimplemented</span>
    <span class="n">_connect_point3</span> <span class="o">=</span> <span class="n">_connect_unimplemented</span>
    <span class="n">_connect_line3</span> <span class="o">=</span> <span class="n">_connect_unimplemented</span>
    <span class="n">_connect_sphere</span> <span class="o">=</span> <span class="n">_connect_unimplemented</span>
    <span class="n">_connect_plane</span> <span class="o">=</span> <span class="n">_connect_unimplemented</span>
    
<div class="viewcode-block" id="Geometry.point"><a class="viewcode-back" href="../modules/geom.html#geom.Geometry.point">[docs]</a>    <span class="k">def</span> <span class="nf">point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u</span><span class="p">):</span>
        <span class="s">&quot;:return: Point2 or Point3 at parameter u&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
    </div>
<div class="viewcode-block" id="Geometry.tangent"><a class="viewcode-back" href="../modules/geom.html#geom.Geometry.tangent">[docs]</a>    <span class="k">def</span> <span class="nf">tangent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u</span><span class="p">):</span>
        <span class="s">&quot;:return: Vector2 or Vector3 tangent at parameter u&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
    </div>
<div class="viewcode-block" id="Geometry.intersect"><a class="viewcode-back" href="../modules/geom.html#geom.Geometry.intersect">[docs]</a>    <span class="k">def</span> <span class="nf">intersect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</div>
<div class="viewcode-block" id="Geometry.connect"><a class="viewcode-back" href="../modules/geom.html#geom.Geometry.connect">[docs]</a>    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="s">&quot;:return: Geometry shortest (Segment2 or Segment3) that connects self to other&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</div>
<div class="viewcode-block" id="Geometry.distance"><a class="viewcode-back" href="../modules/geom.html#geom.Geometry.distance">[docs]</a>    <span class="k">def</span> <span class="nf">distance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">c</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">c</span><span class="o">.</span><span class="n">length</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
</div></div>
<span class="k">def</span> <span class="nf">_intersect_point2_circle</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">C</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="n">P</span> <span class="o">-</span> <span class="n">C</span><span class="o">.</span><span class="n">c</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">C</span><span class="o">.</span><span class="n">r</span>
    
<span class="k">def</span> <span class="nf">_intersect_line2_line2</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">):</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">A</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">B</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">A</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">y</span>
    <span class="k">if</span> <span class="n">d</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="c">#both lines are parallel</span>
        <span class="k">if</span> <span class="n">A</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">B</span><span class="o">.</span><span class="n">p</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> <span class="c">#colinear</span>
            <span class="k">return</span> <span class="n">A</span> 
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

    <span class="n">dy</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">B</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">y</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">B</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">x</span>
    <span class="n">ua</span> <span class="o">=</span> <span class="p">(</span><span class="n">B</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">dy</span> <span class="o">-</span> <span class="n">B</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">dx</span><span class="p">)</span> <span class="o">/</span> <span class="n">d</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">A</span><span class="o">.</span><span class="n">_u_in</span><span class="p">(</span><span class="n">ua</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="n">ub</span> <span class="o">=</span> <span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">dy</span> <span class="o">-</span> <span class="n">A</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">dx</span><span class="p">)</span> <span class="o">/</span> <span class="n">d</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">B</span><span class="o">.</span><span class="n">_u_in</span><span class="p">(</span><span class="n">ub</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">None</span>

    <span class="k">return</span> <span class="n">Point2</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">ua</span> <span class="o">*</span> <span class="n">A</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
                  <span class="n">A</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">ua</span> <span class="o">*</span> <span class="n">A</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_intersect_line2_circle</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">C</span><span class="p">):</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">mag2</span><span class="p">()</span>
    <span class="n">b</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">L</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="n">L</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">C</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> \
             <span class="n">L</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="n">L</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">C</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">mag2</span><span class="p">()</span> <span class="o">+</span> \
        <span class="n">L</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">mag2</span><span class="p">()</span> <span class="o">-</span> \
        <span class="mi">2</span> <span class="o">*</span> <span class="n">C</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">L</span><span class="o">.</span><span class="n">p</span><span class="p">)</span> <span class="o">-</span> \
        <span class="n">C</span><span class="o">.</span><span class="n">r</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="n">det</span> <span class="o">=</span> <span class="n">b</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">a</span> <span class="o">*</span> <span class="n">c</span>
    <span class="k">if</span> <span class="n">det</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="n">sq</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">det</span><span class="p">)</span>
    <span class="n">u1</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">b</span> <span class="o">+</span> <span class="n">sq</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">a</span><span class="p">)</span>
    <span class="n">u2</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">b</span> <span class="o">-</span> <span class="n">sq</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">a</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">L</span><span class="o">.</span><span class="n">_u_in</span><span class="p">(</span><span class="n">u1</span><span class="p">):</span>
        <span class="n">u1</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">u1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">L</span><span class="o">.</span><span class="n">_u_in</span><span class="p">(</span><span class="n">u2</span><span class="p">):</span>
        <span class="n">u2</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">u2</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">)</span>

    <span class="c"># Tangent</span>
    <span class="k">if</span> <span class="n">u1</span> <span class="o">==</span> <span class="n">u2</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Point2</span><span class="p">(</span><span class="n">L</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">u1</span> <span class="o">*</span> <span class="n">L</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
                      <span class="n">L</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">u1</span> <span class="o">*</span> <span class="n">L</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">Segment2</span><span class="p">(</span><span class="n">Point2</span><span class="p">(</span><span class="n">L</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">u1</span> <span class="o">*</span> <span class="n">L</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
                               <span class="n">L</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">u1</span> <span class="o">*</span> <span class="n">L</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">y</span><span class="p">),</span>
                        <span class="n">Point2</span><span class="p">(</span><span class="n">L</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">u2</span> <span class="o">*</span> <span class="n">L</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
                               <span class="n">L</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">u2</span> <span class="o">*</span> <span class="n">L</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">_connect_point2_line2</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">L</span><span class="p">):</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">mag2</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">d</span> <span class="o">!=</span> <span class="mi">0</span>
    <span class="n">u</span> <span class="o">=</span> <span class="p">((</span><span class="n">P</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">L</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">L</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> \
         <span class="p">(</span><span class="n">P</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">L</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">*</span> <span class="n">L</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">/</span> <span class="n">d</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">L</span><span class="o">.</span><span class="n">_u_in</span><span class="p">(</span><span class="n">u</span><span class="p">):</span>
        <span class="n">u</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Segment2</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> 
                        <span class="n">Point2</span><span class="p">(</span><span class="n">L</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">u</span> <span class="o">*</span> <span class="n">L</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
                               <span class="n">L</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">u</span> <span class="o">*</span> <span class="n">L</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">_connect_point2_circle</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">C</span><span class="p">):</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">P</span> <span class="o">-</span> <span class="n">C</span><span class="o">.</span><span class="n">c</span>
    <span class="n">v</span><span class="o">.</span><span class="n">normalize</span><span class="p">()</span>
    <span class="n">v</span> <span class="o">*=</span> <span class="n">C</span><span class="o">.</span><span class="n">r</span>
    <span class="k">return</span> <span class="n">Segment2</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">Point2</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">v</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">C</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">v</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">_connect_line2_line2</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">):</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">A</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">B</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">A</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">y</span>
    <span class="k">if</span> <span class="n">d</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c"># Parallel, connect an endpoint with a line</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="p">(</span><span class="n">Ray2</span><span class="p">,</span><span class="n">Segment2</span><span class="p">)):</span>
            <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">_connect_point2_line2</span><span class="p">(</span><span class="n">B</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="n">A</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p1</span>
        <span class="c"># No endpoint (or endpoint is on A), possibly choose arbitrary point</span>
        <span class="c"># on line.</span>
        <span class="k">return</span> <span class="n">_connect_point2_line2</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span>

    <span class="n">dy</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">B</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">y</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">B</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">x</span>
    <span class="n">ua</span> <span class="o">=</span> <span class="p">(</span><span class="n">B</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">dy</span> <span class="o">-</span> <span class="n">B</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">dx</span><span class="p">)</span> <span class="o">/</span> <span class="n">d</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">A</span><span class="o">.</span><span class="n">_u_in</span><span class="p">(</span><span class="n">ua</span><span class="p">):</span>
        <span class="n">ua</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">ua</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">)</span>
    <span class="n">ub</span> <span class="o">=</span> <span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">dy</span> <span class="o">-</span> <span class="n">A</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">dx</span><span class="p">)</span> <span class="o">/</span> <span class="n">d</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">B</span><span class="o">.</span><span class="n">_u_in</span><span class="p">(</span><span class="n">ub</span><span class="p">):</span>
        <span class="n">ub</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">ub</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">Segment2</span><span class="p">(</span><span class="n">Point2</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">ua</span> <span class="o">*</span> <span class="n">A</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">A</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">ua</span> <span class="o">*</span> <span class="n">A</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">y</span><span class="p">),</span>
                        <span class="n">Point2</span><span class="p">(</span><span class="n">B</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">ub</span> <span class="o">*</span> <span class="n">B</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">B</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">ub</span> <span class="o">*</span> <span class="n">B</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">_connect_circle_line2</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">L</span><span class="p">):</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">mag2</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">d</span> <span class="o">!=</span> <span class="mi">0</span>
    <span class="n">u</span> <span class="o">=</span> <span class="p">((</span><span class="n">C</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">L</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">L</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">L</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">*</span> <span class="n">L</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">/</span> <span class="n">d</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">L</span><span class="o">.</span><span class="n">_u_in</span><span class="p">(</span><span class="n">u</span><span class="p">):</span>
        <span class="n">u</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">)</span>
    <span class="n">point</span> <span class="o">=</span> <span class="n">Point2</span><span class="p">(</span><span class="n">L</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">u</span> <span class="o">*</span> <span class="n">L</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">L</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">u</span> <span class="o">*</span> <span class="n">L</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
    <span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">point</span> <span class="o">-</span> <span class="n">C</span><span class="o">.</span><span class="n">c</span><span class="p">)</span>
    <span class="n">v</span><span class="o">.</span><span class="n">normalize</span><span class="p">()</span>
    <span class="n">v</span> <span class="o">*=</span> <span class="n">C</span><span class="o">.</span><span class="n">r</span>
    <span class="k">return</span> <span class="n">Segment2</span><span class="p">(</span><span class="n">Point2</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">v</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">C</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">v</span><span class="o">.</span><span class="n">y</span><span class="p">),</span> <span class="n">point</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_connect_circle_circle</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">):</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="n">c</span> <span class="o">-</span> <span class="n">A</span><span class="o">.</span><span class="n">c</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">mag</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">A</span><span class="o">.</span><span class="n">r</span> <span class="o">&gt;=</span> <span class="n">B</span><span class="o">.</span><span class="n">r</span> <span class="ow">and</span> <span class="n">d</span> <span class="o">&lt;</span> <span class="n">A</span><span class="o">.</span><span class="n">r</span><span class="p">:</span>
        <span class="c">#centre B inside A</span>
        <span class="n">s1</span><span class="p">,</span><span class="n">s2</span> <span class="o">=</span> <span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="o">+</span><span class="mi">1</span>
    <span class="k">elif</span> <span class="n">B</span><span class="o">.</span><span class="n">r</span> <span class="o">&gt;</span> <span class="n">A</span><span class="o">.</span><span class="n">r</span> <span class="ow">and</span> <span class="n">d</span> <span class="o">&lt;</span> <span class="n">B</span><span class="o">.</span><span class="n">r</span><span class="p">:</span>
        <span class="c">#centre A inside B</span>
        <span class="n">s1</span><span class="p">,</span><span class="n">s2</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">elif</span> <span class="n">d</span> <span class="o">&gt;=</span> <span class="n">A</span><span class="o">.</span><span class="n">r</span> <span class="ow">and</span> <span class="n">d</span> <span class="o">&gt;=</span> <span class="n">B</span><span class="o">.</span><span class="n">r</span><span class="p">:</span>
        <span class="n">s1</span><span class="p">,</span><span class="n">s2</span> <span class="o">=</span> <span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">v</span><span class="o">.</span><span class="n">normalize</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">Segment2</span><span class="p">(</span><span class="n">Point2</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">s1</span> <span class="o">*</span> <span class="n">v</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">A</span><span class="o">.</span><span class="n">r</span><span class="p">,</span> <span class="n">A</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">s1</span> <span class="o">*</span> <span class="n">v</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">A</span><span class="o">.</span><span class="n">r</span><span class="p">),</span>
                        <span class="n">Point2</span><span class="p">(</span><span class="n">B</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">s2</span> <span class="o">*</span> <span class="n">v</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">B</span><span class="o">.</span><span class="n">r</span><span class="p">,</span> <span class="n">B</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">s2</span> <span class="o">*</span> <span class="n">v</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">B</span><span class="o">.</span><span class="n">r</span><span class="p">))</span>

<div class="viewcode-block" id="Point2"><a class="viewcode-back" href="../modules/geom.html#geom.Point2">[docs]</a><span class="k">class</span> <span class="nc">Point2</span><span class="p">(</span><span class="n">Vector2</span><span class="p">,</span> <span class="n">Geometry</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A point on a 2D plane.  Construct in the obvious way::</span>

<span class="sd">    &gt;&gt;&gt; p = Point2(1.0, 2.0)</span>
<span class="sd">    &gt;&gt;&gt; p</span>
<span class="sd">    Point2(1.00, 2.00)</span>

<span class="sd">    **Point2** subclasses **Vector2**, so all of **Vector2** operators and</span>
<span class="sd">    methods apply.  In particular, subtracting two points gives a vector::</span>

<span class="sd">    &gt;&gt;&gt; Point2(2.0, 3.0) - Point2(1.0, 0.0)</span>
<span class="sd">    Vector2(1.00, 3.00)</span>

<span class="sd">    The following methods are also defined:</span>

<span class="sd">    ``connect(other)``</span>
<span class="sd">        Returns a **LineSegment2** which is the minimum length line segment</span>
<span class="sd">        that can connect the two shapes.  *other* may be a **Point2**, **Line2**,</span>
<span class="sd">        **Ray2**, **LineSegment2** or **Circle**.</span>
<span class="sd">    </span>
<span class="sd">    ``distance(other)``</span>
<span class="sd">        Returns the absolute minimum distance to *other*.  Internally this</span>
<span class="sd">        simply returns the length of the result of ``connect``. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
<div class="viewcode-block" id="Point2.dist"><a class="viewcode-back" href="../modules/geom.html#geom.Point2.dist">[docs]</a>    <span class="k">def</span> <span class="nf">dist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">-</span><span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="n">mag</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Point2.intersect"><a class="viewcode-back" href="../modules/geom.html#geom.Point2.intersect">[docs]</a>    <span class="k">def</span> <span class="nf">intersect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">_intersect_point2</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_intersect_circle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_intersect_point2_circle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>

<div class="viewcode-block" id="Point2.connect"><a class="viewcode-back" href="../modules/geom.html#geom.Point2.connect">[docs]</a>    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">_connect_point2</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_connect_point2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Segment2</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">_connect_line2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">_connect_point2_line2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">c</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">c</span><span class="o">.</span><span class="n">swap</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_connect_circle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">_connect_point2_circle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">c</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">c</span><span class="o">.</span><span class="n">swap</span><span class="p">()</span>
        </div>
<div class="viewcode-block" id="Polar"><a class="viewcode-back" href="../modules/geom.html#geom.Polar">[docs]</a><span class="k">def</span> <span class="nf">Polar</span><span class="p">(</span><span class="n">mag</span><span class="p">,</span><span class="n">angle</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Vector2</span><span class="p">(</span><span class="n">mag</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">),</span><span class="n">mag</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="Line2"><a class="viewcode-back" href="../modules/geom.html#geom.Line2">[docs]</a><span class="k">class</span> <span class="nc">Line2</span><span class="p">(</span><span class="n">Geometry</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A **Line2** is a line on a 2D plane extending to infinity in both directions;</span>
<span class="sd">    a **Ray2** has a finite end-point and extends to infinity in a single</span>
<span class="sd">    direction; a **LineSegment2** joins two points.  </span>
<span class="sd">    </span>
<span class="sd">    All three classes support the same constructors, operators and methods,</span>
<span class="sd">    but may behave differently when calculating intersections etc.</span>
<span class="sd">    </span>
<span class="sd">    You may construct a line, ray or line segment using any of:</span>
<span class="sd">    </span>
<span class="sd">    * another line, ray or line segment</span>
<span class="sd">    * two points</span>
<span class="sd">    * a point and a vector</span>
<span class="sd">    * a point, a vector and a length</span>
<span class="sd">    </span>
<span class="sd">    For example::</span>
<span class="sd">    </span>
<span class="sd">        &gt;&gt;&gt; Line2(Point2(1.0, 1.0), Point2(2.0, 3.0))</span>
<span class="sd">        Line2(&lt;1.00, 1.00&gt; + u&lt;1.00, 2.00&gt;)</span>
<span class="sd">        &gt;&gt;&gt; Line2(Point2(1.0, 1.0), Vector2(1.0, 2.0))</span>
<span class="sd">        Line2(&lt;1.00, 1.00&gt; + u&lt;1.00, 2.00&gt;)</span>
<span class="sd">        &gt;&gt;&gt; Ray2(Point2(1.0, 1.0), Vector2(1.0, 2.0), 1.0)</span>
<span class="sd">        Ray2(&lt;1.00, 1.00&gt; + u&lt;0.45, 0.89&gt;)</span>
<span class="sd">    </span>
<span class="sd">    Internally, lines, rays and line segments store a Point2 *p* and a</span>
<span class="sd">    Vector2 *v*.  You can also access (but not set) the two endpoints</span>
<span class="sd">    *p1* and *p2*.  These may or may not be meaningful for all types of lines.</span>
<span class="sd">    </span>
<span class="sd">    The following methods are supported by all three classes:</span>
<span class="sd">    </span>
<span class="sd">    ``intersect(other)``</span>
<span class="sd">        If *other* is a **Line2**, **Ray2** or **LineSegment2**, returns</span>
<span class="sd">        a **Point2** of intersection, or None if the lines are parallel.</span>
<span class="sd">    </span>
<span class="sd">        If *other* is a **Circle**, returns a **LineSegment2** or **Point2** giving</span>
<span class="sd">        the part of the line that intersects the circle, or None if there</span>
<span class="sd">        is no intersection.</span>
<span class="sd">    </span>
<span class="sd">    ``connect(other)``</span>
<span class="sd">        Returns a **LineSegment2** which is the minimum length line segment</span>
<span class="sd">        that can connect the two shapes.  For two parallel lines, this</span>
<span class="sd">        line segment may be in an arbitrary position.  *other* may be</span>
<span class="sd">        a **Point2**, **Line2**, **Ray2**, **LineSegment2** or **Circle**.</span>
<span class="sd">    </span>
<span class="sd">    ``distance(other)``</span>
<span class="sd">        Returns the absolute minimum distance to *other*.  Internally this</span>
<span class="sd">        simply returns the length of the result of ``connect``.</span>
<span class="sd">    </span>
<span class="sd">    **LineSegment2** also has a *length* property which is read-only.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Line2.__init__"><a class="viewcode-back" href="../modules/geom.html#geom.Line2.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c"># Line2 or derived class</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">Point2</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">is</span> <span class="n">Vector2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="n">Vector2</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="n">Point2</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span>
            
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="o">*</span><span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">)</span>
        </div>
<div class="viewcode-block" id="Line2.__eq__"><a class="viewcode-back" href="../modules/geom.html#geom.Line2.__eq__">[docs]</a>    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;lines are &quot;equal&quot; only if base points and vector are strictly equal.</span>
<span class="sd">        to compare if lines are &quot;same&quot;, use line1.distance(line2)==0</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">==</span><span class="n">other</span><span class="o">.</span><span class="n">p</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="o">==</span><span class="n">other</span><span class="o">.</span><span class="n">v</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
</div>
<div class="viewcode-block" id="Line2.__copy__"><a class="viewcode-back" href="../modules/geom.html#geom.Line2.__copy__">[docs]</a>    <span class="k">def</span> <span class="nf">__copy__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">)</span>
</div>
    <span class="n">copy</span> <span class="o">=</span> <span class="n">__copy__</span>

<div class="viewcode-block" id="Line2.__repr__"><a class="viewcode-back" href="../modules/geom.html#geom.Line2.__repr__">[docs]</a>    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">(</span><span class="si">%s</span><span class="s">,</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">)</span>
            </div>
    <span class="k">def</span> <span class="nf">_u_in</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">True</span>
    
<div class="viewcode-block" id="Line2.point"><a class="viewcode-back" href="../modules/geom.html#geom.Line2.point">[docs]</a>    <span class="k">def</span> <span class="nf">point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u</span><span class="p">):</span>
        <span class="s">&quot;:return: Point2 at parameter u&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_u_in</span><span class="p">(</span><span class="n">u</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">+</span><span class="n">u</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
    </div>
<div class="viewcode-block" id="Line2.tangent"><a class="viewcode-back" href="../modules/geom.html#geom.Line2.tangent">[docs]</a>    <span class="k">def</span> <span class="nf">tangent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u</span><span class="p">):</span>
        <span class="s">&quot;:return: Vector2 tangent at parameter u. Warning : tangent is generally not a unit vector&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_u_in</span><span class="p">(</span><span class="n">u</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
</div>
    <span class="k">def</span> <span class="nf">_apply_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">t</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="n">t</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span>

<div class="viewcode-block" id="Line2.intersect"><a class="viewcode-back" href="../modules/geom.html#geom.Line2.intersect">[docs]</a>    <span class="k">def</span> <span class="nf">intersect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">_intersect_line2</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_intersect_line2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_intersect_line2_line2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_intersect_circle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_intersect_line2_circle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>

<div class="viewcode-block" id="Line2.connect"><a class="viewcode-back" href="../modules/geom.html#geom.Line2.connect">[docs]</a>    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">_connect_line2</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_connect_point2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_connect_point2_line2</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_connect_line2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_connect_line2_line2</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_connect_circle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_connect_circle_line2</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
    

</div>
<div class="viewcode-block" id="Ray2"><a class="viewcode-back" href="../modules/geom.html#geom.Ray2">[docs]</a><span class="k">class</span> <span class="nc">Ray2</span><span class="p">(</span><span class="n">Line2</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">_u_in</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">u</span> <span class="o">&gt;=</span> <span class="mf">0.0</span>
</div>
<div class="viewcode-block" id="Segment2"><a class="viewcode-back" href="../modules/geom.html#geom.Segment2">[docs]</a><span class="k">class</span> <span class="nc">Segment2</span><span class="p">(</span><span class="n">Line2</span><span class="p">):</span>
    <span class="n">p1</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">)</span>
    <span class="n">p2</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="n">Point2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> 
                                      <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
    
<div class="viewcode-block" id="Segment2.__repr__"><a class="viewcode-back" href="../modules/geom.html#geom.Segment2.__repr__">[docs]</a>    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">(</span><span class="si">%s</span><span class="s">,</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">p2</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_u_in</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">u</span> <span class="o">&gt;=</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="n">u</span> <span class="o">&lt;=</span> <span class="mf">1.0</span>

<div class="viewcode-block" id="Segment2.__abs__"><a class="viewcode-back" href="../modules/geom.html#geom.Segment2.__abs__">[docs]</a>    <span class="k">def</span> <span class="nf">__abs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Segment2.mag2"><a class="viewcode-back" href="../modules/geom.html#geom.Segment2.mag2">[docs]</a>    <span class="k">def</span> <span class="nf">mag2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">mag2</span><span class="p">()</span>
</div>
    <span class="n">length</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">))</span>
    
<div class="viewcode-block" id="Segment2.swap"><a class="viewcode-back" href="../modules/geom.html#geom.Segment2.swap">[docs]</a>    <span class="k">def</span> <span class="nf">swap</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># used by connect methods to switch order of points</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">return</span> <span class="bp">self</span>
</div></div>
<div class="viewcode-block" id="Circle"><a class="viewcode-back" href="../modules/geom.html#geom.Circle">[docs]</a><span class="k">class</span> <span class="nc">Circle</span><span class="p">(</span><span class="n">Geometry</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Circles are constructed with a center **Point2** and a radius::</span>

<span class="sd">    &gt;&gt;&gt; c = Circle(Point2(1.0, 1.0), 0.5)</span>
<span class="sd">    &gt;&gt;&gt; c</span>
<span class="sd">    Circle(&lt;1.00, 1.00&gt;, radius=0.50)</span>

<span class="sd">    Internally there are two attributes: *c*, giving the center point and</span>
<span class="sd">    *r*, giving the radius.</span>
<span class="sd">    </span>
<span class="sd">    The following methods are supported:</span>
<span class="sd">    </span>
<span class="sd">    ``intersect(other)``</span>
<span class="sd">        If *other* is a **Line2**, **Ray2** or **LineSegment2**, returns</span>
<span class="sd">        a **LineSegment2** giving the part of the line that intersects the</span>
<span class="sd">        circle, or None if there is no intersection.</span>
<span class="sd">    </span>
<span class="sd">    ``connect(other)``</span>
<span class="sd">        Returns a **LineSegment2** which is the minimum length line segment</span>
<span class="sd">        that can connect the two shapes. *other* may be a **Point2**, **Line2**,</span>
<span class="sd">        **Ray2**, **LineSegment2** or **Circle**.</span>
<span class="sd">    </span>
<span class="sd">    ``distance(other)``</span>
<span class="sd">        Returns the absolute minimum distance to *other*.  Internally this</span>
<span class="sd">        simply returns the length of the result of ``connect``. </span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Circle.__init__"><a class="viewcode-back" href="../modules/geom.html#geom.Circle.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">radius</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">Point2</span><span class="p">(</span><span class="n">center</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">radius</span><span class="p">,(</span><span class="nb">float</span><span class="p">,</span><span class="nb">int</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">=</span> <span class="n">radius</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">center</span><span class="o">+</span><span class="n">Vector2</span><span class="p">(</span><span class="n">radius</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="c">#for coherency + transform</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">=</span><span class="n">radius</span> <span class="c">#one point on circle</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Circle.point"><a class="viewcode-back" href="../modules/geom.html#geom.Circle.point">[docs]</a>    <span class="k">def</span> <span class="nf">point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u</span><span class="p">):</span>
        <span class="s">&quot;:return: Point2 at angle u radians&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">+</span><span class="n">Polar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">,</span><span class="n">u</span><span class="p">)</span>
    </div>
<div class="viewcode-block" id="Circle.tangent"><a class="viewcode-back" href="../modules/geom.html#geom.Circle.tangent">[docs]</a>    <span class="k">def</span> <span class="nf">tangent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u</span><span class="p">):</span>
        <span class="s">&quot;:return: Vector2 tangent at angle u. Warning : tangent has magnitude r != 1&quot;</span>
        <span class="k">return</span> <span class="n">Polar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">,</span><span class="n">u</span><span class="o">+</span><span class="n">pi</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
        </div>
<div class="viewcode-block" id="Circle.__copy__"><a class="viewcode-back" href="../modules/geom.html#geom.Circle.__copy__">[docs]</a>    <span class="k">def</span> <span class="nf">__copy__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">)</span>
    </div>
<div class="viewcode-block" id="Circle.__eq__"><a class="viewcode-back" href="../modules/geom.html#geom.Circle.__eq__">[docs]</a>    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span><span class="n">Circle</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">==</span><span class="n">other</span><span class="o">.</span><span class="n">c</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">==</span><span class="n">other</span><span class="o">.</span><span class="n">r</span>
</div>
    <span class="n">copy</span> <span class="o">=</span> <span class="n">__copy__</span>

<div class="viewcode-block" id="Circle.__repr__"><a class="viewcode-back" href="../modules/geom.html#geom.Circle.__repr__">[docs]</a>    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">(</span><span class="si">%s</span><span class="s">,</span><span class="si">%g</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_apply_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">t</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">t</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">)</span>
        
<div class="viewcode-block" id="Circle.__abs__"><a class="viewcode-back" href="../modules/geom.html#geom.Circle.__abs__">[docs]</a>    <span class="k">def</span> <span class="nf">__abs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;:return: float perimeter&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span>
    </div>
    <span class="n">length</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

<div class="viewcode-block" id="Circle.intersect"><a class="viewcode-back" href="../modules/geom.html#geom.Circle.intersect">[docs]</a>    <span class="k">def</span> <span class="nf">intersect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">_intersect_circle</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_intersect_point2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_intersect_point2_circle</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_intersect_line2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_intersect_line2_circle</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

<div class="viewcode-block" id="Circle.connect"><a class="viewcode-back" href="../modules/geom.html#geom.Circle.connect">[docs]</a>    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">_connect_circle</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_connect_point2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_connect_point2_circle</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_connect_line2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">_connect_circle_line2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">c</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">c</span><span class="o">.</span><span class="n">swap</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_connect_circle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_connect_circle_circle</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
    </div>
<div class="viewcode-block" id="Arc2"><a class="viewcode-back" href="../modules/geom.html#geom.Arc2">[docs]</a><span class="k">class</span> <span class="nc">Arc2</span><span class="p">(</span><span class="n">Circle</span><span class="p">):</span>
<div class="viewcode-block" id="Arc2.__init__"><a class="viewcode-back" href="../modules/geom.html#geom.Arc2.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span><span class="n">p2</span><span class="p">,</span><span class="n">r</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="nb">dir</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param center: Point2 or (x,y) tuple</span>
<span class="sd">        :param p1: starting Point2 or angle in radians </span>
<span class="sd">        :param p2: ending Point2 or angle in radians </span>
<span class="sd">        :param r: float radius, needed onyl if p1 or p2 is an angle</span>
<span class="sd">        .param dir: arc direction. +1 is trig positive (CCW) and -1 is Clockwise</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">c</span><span class="o">=</span><span class="n">Point2</span><span class="p">(</span><span class="n">center</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">center</span><span class="p">,</span><span class="n">Point2</span><span class="p">)</span> <span class="k">else</span> <span class="n">center</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p1</span><span class="p">,(</span><span class="nb">int</span><span class="p">,</span><span class="nb">float</span><span class="p">)):</span>
            <span class="n">p</span><span class="o">=</span><span class="n">c</span><span class="o">+</span><span class="n">Polar</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">p1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">p</span><span class="o">=</span><span class="n">Point2</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>
            <span class="n">r</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">dist</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Arc2</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p2</span><span class="p">,(</span><span class="nb">int</span><span class="p">,</span><span class="nb">float</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p2</span><span class="o">=</span><span class="n">c</span><span class="o">+</span><span class="n">Polar</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">p2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p2</span><span class="o">=</span><span class="n">Point2</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">=</span><span class="nb">dir</span> 
            
        <span class="bp">self</span><span class="o">.</span><span class="n">_apply_transform</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span> <span class="c">#to set start/end angles</span>
        <span class="c"># self.a is now start angle in [-pi,pi]</span>
        <span class="c"># self.b is now end angle in [-pi,pi]</span>
        </div>
<div class="viewcode-block" id="Arc2.angle"><a class="viewcode-back" href="../modules/geom.html#geom.Arc2.angle">[docs]</a>    <span class="k">def</span> <span class="nf">angle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;:return: float signed arc angle&quot;&quot;&quot;</span>
        <span class="n">a</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span>
        <span class="n">b</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span>
        <span class="k">if</span> <span class="n">b</span><span class="o">&lt;</span><span class="n">a</span><span class="p">:</span> <span class="n">b</span><span class="o">=</span><span class="n">b</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span> <span class="c"># now b&gt;a</span>
        <span class="n">res</span><span class="o">=</span><span class="n">b</span><span class="o">-</span><span class="n">a</span> <span class="c">#positive angle</span>
        <span class="k">if</span> <span class="nb">cmp</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">a</span><span class="p">)</span><span class="o">!=</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="p">:</span> <span class="c">#complementary angle</span>
            <span class="n">res</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">-</span><span class="n">res</span>
        <span class="k">return</span> <span class="n">res</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span>
        </div>
<div class="viewcode-block" id="Arc2.__abs__"><a class="viewcode-back" href="../modules/geom.html#geom.Arc2.__abs__">[docs]</a>    <span class="k">def</span> <span class="nf">__abs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;:return: float arc length&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">angle</span><span class="p">())</span>
        </div>
    <span class="k">def</span> <span class="nf">_u_in</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u</span><span class="p">):</span> <span class="c">#unlike Circle, Arc2 is parametrized on [0,1] for coherency with Segment2</span>
        <span class="k">return</span> <span class="n">u</span> <span class="o">&gt;=</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="n">u</span> <span class="o">&lt;=</span> <span class="mf">1.0</span>
    
<div class="viewcode-block" id="Arc2.point"><a class="viewcode-back" href="../modules/geom.html#geom.Arc2.point">[docs]</a>    <span class="k">def</span> <span class="nf">point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u</span><span class="p">):</span>
        <span class="s">&quot;:return: Point2 at parameter u&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_u_in</span><span class="p">(</span><span class="n">u</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">+</span><span class="n">u</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
    </div>
<div class="viewcode-block" id="Arc2.tangent"><a class="viewcode-back" href="../modules/geom.html#geom.Arc2.tangent">[docs]</a>    <span class="k">def</span> <span class="nf">tangent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u</span><span class="p">):</span>
        <span class="s">&quot;:return: Vector2 tangent at parameter u. Warning : tangent not a unit vector&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_u_in</span><span class="p">(</span><span class="n">u</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
            </div>
    <span class="k">def</span> <span class="nf">_apply_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">t</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">Arc2</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_apply_transform</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p2</span> <span class="o">=</span> <span class="n">t</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">)</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span> <span class="c">#start angle</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p2</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">)</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span> <span class="c">#end angle</span>
        
<div class="viewcode-block" id="Arc2.__copy__"><a class="viewcode-back" href="../modules/geom.html#geom.Arc2.__copy__">[docs]</a>    <span class="k">def</span> <span class="nf">__copy__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2</span><span class="p">)</span>
</div>
    <span class="n">copy</span> <span class="o">=</span> <span class="n">__copy__</span>
    
<div class="viewcode-block" id="Arc2.__eq__"><a class="viewcode-back" href="../modules/geom.html#geom.Arc2.__eq__">[docs]</a>    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">super</span><span class="p">(</span><span class="n">Arc2</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">):</span> <span class="c">#support Circles must be the same</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">==</span><span class="n">other</span><span class="o">.</span><span class="n">p</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2</span><span class="o">==</span><span class="n">other</span><span class="o">.</span><span class="n">p2</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">==</span><span class="n">other</span><span class="o">.</span><span class="n">dir</span>
        </div>
<div class="viewcode-block" id="Arc2.__repr__"><a class="viewcode-back" href="../modules/geom.html#geom.Arc2.__repr__">[docs]</a>    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">(center=</span><span class="si">%s</span><span class="s">,p1=</span><span class="si">%s</span><span class="s">,p2=</span><span class="si">%s</span><span class="s">,r=</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">p2</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Arc2.swap"><a class="viewcode-back" href="../modules/geom.html#geom.Arc2.swap">[docs]</a>    <span class="k">def</span> <span class="nf">swap</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># used by connect methods to switch order of points</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">p2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">=-</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span>
        <span class="k">return</span> <span class="bp">self</span>


<span class="c"># 3D Geometry</span>
<span class="c"># -------------------------------------------------------------------------</span>
</div></div>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">**3D Geometry**</span>

<span class="sd">The following classes are available for dealing with simple 3D geometry.</span>
<span class="sd">The interfaces are very similar to the 2D classes (but note that you</span>
<span class="sd">cannot mix and match 2D and 3D operations).</span>

<span class="sd">For example, to find the closest point on a line to a sphere::</span>

<span class="sd">    &gt;&gt;&gt; sphere = Sphere(Point3(1., 2., 3.,), 2.)</span>
<span class="sd">    &gt;&gt;&gt; line = Line3(Point3(0., 0., 0.), Point3(-1., -1., 0.))</span>
<span class="sd">    &gt;&gt;&gt; line.connect(sphere).p1</span>
<span class="sd">    Point3(1.50, 1.50, 0.00)</span>

<span class="sd">To find the corresponding closest point on the sphere to the line::</span>

<span class="sd">    &gt;&gt;&gt; line.connect(sphere).p2</span>
<span class="sd">    Point3(1.32, 1.68, 1.05)</span>

<span class="sd">XXX I have not checked if these are correct.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="k">def</span> <span class="nf">_connect_point3_line3</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">L</span><span class="p">):</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">mag2</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">d</span> <span class="o">!=</span> <span class="mi">0</span>
    <span class="n">u</span> <span class="o">=</span> <span class="p">((</span><span class="n">P</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">L</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">L</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> \
         <span class="p">(</span><span class="n">P</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">L</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">*</span> <span class="n">L</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> \
         <span class="p">(</span><span class="n">P</span><span class="o">.</span><span class="n">z</span> <span class="o">-</span> <span class="n">L</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">L</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">z</span><span class="p">)</span> <span class="o">/</span> <span class="n">d</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">L</span><span class="o">.</span><span class="n">_u_in</span><span class="p">(</span><span class="n">u</span><span class="p">):</span>
        <span class="n">u</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Segment3</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">Point3</span><span class="p">(</span><span class="n">L</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">u</span> <span class="o">*</span> <span class="n">L</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
                                  <span class="n">L</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">u</span> <span class="o">*</span> <span class="n">L</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
                                  <span class="n">L</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">z</span> <span class="o">+</span> <span class="n">u</span> <span class="o">*</span> <span class="n">L</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">z</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">_connect_point3_sphere</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">S</span><span class="p">):</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">P</span> <span class="o">-</span> <span class="n">S</span><span class="o">.</span><span class="n">c</span>
    <span class="n">v</span><span class="o">.</span><span class="n">normalize</span><span class="p">()</span>
    <span class="n">v</span> <span class="o">*=</span> <span class="n">S</span><span class="o">.</span><span class="n">r</span>
    <span class="k">return</span> <span class="n">Segment3</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">Point3</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">v</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">S</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">v</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">S</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">z</span> <span class="o">+</span> <span class="n">v</span><span class="o">.</span><span class="n">z</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">_connect_point3_plane</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">plane</span><span class="p">):</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">plane</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">normalized</span><span class="p">()</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">plane</span><span class="o">.</span><span class="n">n</span><span class="p">)</span> <span class="o">-</span> <span class="n">plane</span><span class="o">.</span><span class="n">k</span>
    <span class="k">return</span> <span class="n">Segment3</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">Point3</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">n</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">d</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">n</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">d</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">z</span> <span class="o">-</span> <span class="n">n</span><span class="o">.</span><span class="n">z</span> <span class="o">*</span> <span class="n">d</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">_connect_line3_line3</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">A</span><span class="o">.</span><span class="n">v</span> <span class="ow">and</span> <span class="n">B</span><span class="o">.</span><span class="n">v</span>
    <span class="n">p13</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">p</span> <span class="o">-</span> <span class="n">B</span><span class="o">.</span><span class="n">p</span>
    <span class="n">d1343</span> <span class="o">=</span> <span class="n">p13</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">B</span><span class="o">.</span><span class="n">v</span><span class="p">)</span>
    <span class="n">d4321</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">v</span><span class="p">)</span>
    <span class="n">d1321</span> <span class="o">=</span> <span class="n">p13</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">v</span><span class="p">)</span>
    <span class="n">d4343</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">mag2</span><span class="p">()</span>
    <span class="n">denom</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">mag2</span><span class="p">()</span> <span class="o">*</span> <span class="n">d4343</span> <span class="o">-</span> <span class="n">d4321</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="k">if</span> <span class="n">denom</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c"># Parallel, connect an endpoint with a line</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">Ray3</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">Segment3</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">_connect_point3_line3</span><span class="p">(</span><span class="n">B</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="n">A</span><span class="p">)</span><span class="o">.</span><span class="n">swap</span><span class="p">()</span>
        <span class="c"># No endpoint (or endpoint is on A), possibly choose arbitrary</span>
        <span class="c"># point on line.</span>
        <span class="k">return</span> <span class="n">_connect_point3_line3</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span>

    <span class="n">ua</span> <span class="o">=</span> <span class="p">(</span><span class="n">d1343</span> <span class="o">*</span> <span class="n">d4321</span> <span class="o">-</span> <span class="n">d1321</span> <span class="o">*</span> <span class="n">d4343</span><span class="p">)</span> <span class="o">/</span> <span class="n">denom</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">A</span><span class="o">.</span><span class="n">_u_in</span><span class="p">(</span><span class="n">ua</span><span class="p">):</span>
        <span class="n">ua</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">ua</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">)</span>
    <span class="n">ub</span> <span class="o">=</span> <span class="p">(</span><span class="n">d1343</span> <span class="o">+</span> <span class="n">d4321</span> <span class="o">*</span> <span class="n">ua</span><span class="p">)</span> <span class="o">/</span> <span class="n">d4343</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">B</span><span class="o">.</span><span class="n">_u_in</span><span class="p">(</span><span class="n">ub</span><span class="p">):</span>
        <span class="n">ub</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">ub</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Segment3</span><span class="p">(</span><span class="n">Point3</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">ua</span> <span class="o">*</span> <span class="n">A</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
                               <span class="n">A</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">ua</span> <span class="o">*</span> <span class="n">A</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
                               <span class="n">A</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">z</span> <span class="o">+</span> <span class="n">ua</span> <span class="o">*</span> <span class="n">A</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">z</span><span class="p">),</span>
                        <span class="n">Point3</span><span class="p">(</span><span class="n">B</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">ub</span> <span class="o">*</span> <span class="n">B</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
                               <span class="n">B</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">ub</span> <span class="o">*</span> <span class="n">B</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
                               <span class="n">B</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">z</span> <span class="o">+</span> <span class="n">ub</span> <span class="o">*</span> <span class="n">B</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">z</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">_connect_line3_plane</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">P</span><span class="p">):</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">L</span><span class="o">.</span><span class="n">v</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">d</span><span class="p">:</span>
        <span class="c"># Parallel, choose an endpoint</span>
        <span class="k">return</span> <span class="n">_connect_point3_plane</span><span class="p">(</span><span class="n">L</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="n">P</span><span class="p">)</span>
    <span class="n">u</span> <span class="o">=</span> <span class="p">(</span><span class="n">P</span><span class="o">.</span><span class="n">k</span> <span class="o">-</span> <span class="n">P</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">L</span><span class="o">.</span><span class="n">p</span><span class="p">))</span> <span class="o">/</span> <span class="n">d</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">L</span><span class="o">.</span><span class="n">_u_in</span><span class="p">(</span><span class="n">u</span><span class="p">):</span>
        <span class="c"># intersects out of range, choose nearest endpoint</span>
        <span class="n">u</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_connect_point3_plane</span><span class="p">(</span><span class="n">Point3</span><span class="p">(</span><span class="n">L</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">u</span> <span class="o">*</span> <span class="n">L</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
                                            <span class="n">L</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">u</span> <span class="o">*</span> <span class="n">L</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
                                            <span class="n">L</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">z</span> <span class="o">+</span> <span class="n">u</span> <span class="o">*</span> <span class="n">L</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">z</span><span class="p">),</span> <span class="n">P</span><span class="p">)</span>
    <span class="c"># Intersection</span>
    <span class="k">return</span> <span class="bp">None</span>

<span class="k">def</span> <span class="nf">_connect_sphere_line3</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">L</span><span class="p">):</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">mag2</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">d</span> <span class="o">!=</span> <span class="mi">0</span>
    <span class="n">u</span> <span class="o">=</span> <span class="p">((</span><span class="n">S</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">L</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">L</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> \
         <span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">L</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">*</span> <span class="n">L</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> \
         <span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">z</span> <span class="o">-</span> <span class="n">L</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">L</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">z</span><span class="p">)</span> <span class="o">/</span> <span class="n">d</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">L</span><span class="o">.</span><span class="n">_u_in</span><span class="p">(</span><span class="n">u</span><span class="p">):</span>
        <span class="n">u</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">)</span>
    <span class="n">point</span> <span class="o">=</span> <span class="n">Point3</span><span class="p">(</span><span class="n">L</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">u</span> <span class="o">*</span> <span class="n">L</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">L</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">u</span> <span class="o">*</span> <span class="n">L</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">L</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">z</span> <span class="o">+</span> <span class="n">u</span> <span class="o">*</span> <span class="n">L</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>
    <span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">point</span> <span class="o">-</span> <span class="n">S</span><span class="o">.</span><span class="n">c</span><span class="p">)</span>
    <span class="n">v</span><span class="o">.</span><span class="n">normalize</span><span class="p">()</span>
    <span class="n">v</span> <span class="o">*=</span> <span class="n">S</span><span class="o">.</span><span class="n">r</span>
    <span class="k">return</span> <span class="n">Segment3</span><span class="p">(</span><span class="n">Point3</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">v</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">S</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">v</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">S</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">z</span> <span class="o">+</span> <span class="n">v</span><span class="o">.</span><span class="n">z</span><span class="p">),</span> 
                        <span class="n">point</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_connect_sphere_sphere</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">):</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="n">c</span> <span class="o">-</span> <span class="n">A</span><span class="o">.</span><span class="n">c</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">mag</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">A</span><span class="o">.</span><span class="n">r</span> <span class="o">&gt;=</span> <span class="n">B</span><span class="o">.</span><span class="n">r</span> <span class="ow">and</span> <span class="n">d</span> <span class="o">&lt;</span> <span class="n">A</span><span class="o">.</span><span class="n">r</span><span class="p">:</span>
        <span class="c">#centre B inside A</span>
        <span class="n">s1</span><span class="p">,</span><span class="n">s2</span> <span class="o">=</span> <span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="o">+</span><span class="mi">1</span>
    <span class="k">elif</span> <span class="n">B</span><span class="o">.</span><span class="n">r</span> <span class="o">&gt;</span> <span class="n">A</span><span class="o">.</span><span class="n">r</span> <span class="ow">and</span> <span class="n">d</span> <span class="o">&lt;</span> <span class="n">B</span><span class="o">.</span><span class="n">r</span><span class="p">:</span>
        <span class="c">#centre A inside B</span>
        <span class="n">s1</span><span class="p">,</span><span class="n">s2</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">elif</span> <span class="n">d</span> <span class="o">&gt;=</span> <span class="n">A</span><span class="o">.</span><span class="n">r</span> <span class="ow">and</span> <span class="n">d</span> <span class="o">&gt;=</span> <span class="n">B</span><span class="o">.</span><span class="n">r</span><span class="p">:</span>
        <span class="n">s1</span><span class="p">,</span><span class="n">s2</span> <span class="o">=</span> <span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span>

    <span class="n">v</span><span class="o">.</span><span class="n">normalize</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">Segment3</span><span class="p">(</span><span class="n">Point3</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">s1</span><span class="o">*</span> <span class="n">v</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">A</span><span class="o">.</span><span class="n">r</span><span class="p">,</span>
                               <span class="n">A</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">s1</span><span class="o">*</span> <span class="n">v</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">A</span><span class="o">.</span><span class="n">r</span><span class="p">,</span>
                               <span class="n">A</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">z</span> <span class="o">+</span> <span class="n">s1</span><span class="o">*</span> <span class="n">v</span><span class="o">.</span><span class="n">z</span> <span class="o">*</span> <span class="n">A</span><span class="o">.</span><span class="n">r</span><span class="p">),</span>
                        <span class="n">Point3</span><span class="p">(</span><span class="n">B</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">s2</span><span class="o">*</span> <span class="n">v</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">B</span><span class="o">.</span><span class="n">r</span><span class="p">,</span>
                               <span class="n">B</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">s2</span><span class="o">*</span> <span class="n">v</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">B</span><span class="o">.</span><span class="n">r</span><span class="p">,</span>
                               <span class="n">B</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">z</span> <span class="o">+</span> <span class="n">s2</span><span class="o">*</span> <span class="n">v</span><span class="o">.</span><span class="n">z</span> <span class="o">*</span> <span class="n">B</span><span class="o">.</span><span class="n">r</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">_connect_sphere_plane</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">P</span><span class="p">):</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">_connect_point3_plane</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="n">P</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">c</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="n">p2</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">p2</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">p2</span> <span class="o">-</span> <span class="n">S</span><span class="o">.</span><span class="n">c</span>
    <span class="n">v</span><span class="o">.</span><span class="n">normalize</span><span class="p">()</span>
    <span class="n">v</span> <span class="o">*=</span> <span class="n">S</span><span class="o">.</span><span class="n">r</span>
    <span class="k">return</span> <span class="n">Segment3</span><span class="p">(</span><span class="n">Point3</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">v</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">S</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">v</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">S</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">z</span> <span class="o">+</span> <span class="n">v</span><span class="o">.</span><span class="n">z</span><span class="p">),</span> 
                        <span class="n">p2</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_connect_plane_plane</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">A</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">B</span><span class="o">.</span><span class="n">n</span><span class="p">):</span>
        <span class="c"># Planes intersect</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c"># Planes are parallel, connect to arbitrary point</span>
        <span class="k">return</span> <span class="n">_connect_point3_plane</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">_get_point</span><span class="p">(),</span> <span class="n">B</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_intersect_point3_sphere</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">S</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="n">P</span> <span class="o">-</span> <span class="n">S</span><span class="o">.</span><span class="n">c</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">S</span><span class="o">.</span><span class="n">r</span>
    
<span class="k">def</span> <span class="nf">_intersect_line3_sphere</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">S</span><span class="p">):</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">mag2</span><span class="p">()</span>
    <span class="n">b</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">L</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="n">L</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">S</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> \
             <span class="n">L</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="n">L</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">S</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">+</span> \
             <span class="n">L</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="n">L</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">z</span> <span class="o">-</span> <span class="n">S</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">z</span><span class="p">))</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">mag2</span><span class="p">()</span> <span class="o">+</span> \
        <span class="n">L</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">mag2</span><span class="p">()</span> <span class="o">-</span> \
        <span class="mi">2</span> <span class="o">*</span> <span class="n">S</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">L</span><span class="o">.</span><span class="n">p</span><span class="p">)</span> <span class="o">-</span> \
        <span class="n">S</span><span class="o">.</span><span class="n">r</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="n">det</span> <span class="o">=</span> <span class="n">b</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">a</span> <span class="o">*</span> <span class="n">c</span>
    <span class="k">if</span> <span class="n">det</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="n">sq</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">det</span><span class="p">)</span>
    <span class="n">u1</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">b</span> <span class="o">+</span> <span class="n">sq</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">a</span><span class="p">)</span>
    <span class="n">u2</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">b</span> <span class="o">-</span> <span class="n">sq</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">a</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">L</span><span class="o">.</span><span class="n">_u_in</span><span class="p">(</span><span class="n">u1</span><span class="p">):</span>
        <span class="n">u1</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">u1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">L</span><span class="o">.</span><span class="n">_u_in</span><span class="p">(</span><span class="n">u2</span><span class="p">):</span>
        <span class="n">u2</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">u2</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Segment3</span><span class="p">(</span><span class="n">Point3</span><span class="p">(</span><span class="n">L</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">u1</span> <span class="o">*</span> <span class="n">L</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
                               <span class="n">L</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">u1</span> <span class="o">*</span> <span class="n">L</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
                               <span class="n">L</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">z</span> <span class="o">+</span> <span class="n">u1</span> <span class="o">*</span> <span class="n">L</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">z</span><span class="p">),</span>
                        <span class="n">Point3</span><span class="p">(</span><span class="n">L</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">u2</span> <span class="o">*</span> <span class="n">L</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
                               <span class="n">L</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">u2</span> <span class="o">*</span> <span class="n">L</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
                               <span class="n">L</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">z</span> <span class="o">+</span> <span class="n">u2</span> <span class="o">*</span> <span class="n">L</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">z</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">_intersect_line3_plane</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">P</span><span class="p">):</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">L</span><span class="o">.</span><span class="n">v</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">d</span><span class="p">:</span>
        <span class="c"># Parallel</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="n">u</span> <span class="o">=</span> <span class="p">(</span><span class="n">P</span><span class="o">.</span><span class="n">k</span> <span class="o">-</span> <span class="n">P</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">L</span><span class="o">.</span><span class="n">p</span><span class="p">))</span> <span class="o">/</span> <span class="n">d</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">L</span><span class="o">.</span><span class="n">_u_in</span><span class="p">(</span><span class="n">u</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="k">return</span> <span class="n">Point3</span><span class="p">(</span><span class="n">L</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">u</span> <span class="o">*</span> <span class="n">L</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
                  <span class="n">L</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">u</span> <span class="o">*</span> <span class="n">L</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
                  <span class="n">L</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">z</span> <span class="o">+</span> <span class="n">u</span> <span class="o">*</span> <span class="n">L</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_intersect_plane_plane</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">):</span>
    <span class="n">n1_m</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">mag2</span><span class="p">()</span>
    <span class="n">n2_m</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">mag2</span><span class="p">()</span>
    <span class="n">n1d2</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">B</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
    <span class="n">det</span> <span class="o">=</span> <span class="n">n1_m</span> <span class="o">*</span> <span class="n">n2_m</span> <span class="o">-</span> <span class="n">n1d2</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="k">if</span> <span class="n">det</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c"># Parallel</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="n">c1</span> <span class="o">=</span> <span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="n">n2_m</span> <span class="o">-</span> <span class="n">B</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="n">n1d2</span><span class="p">)</span> <span class="o">/</span> <span class="n">det</span>
    <span class="n">c2</span> <span class="o">=</span> <span class="p">(</span><span class="n">B</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="n">n1_m</span> <span class="o">-</span> <span class="n">A</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="n">n1d2</span><span class="p">)</span> <span class="o">/</span> <span class="n">det</span>
    <span class="k">return</span> <span class="n">Line3</span><span class="p">(</span><span class="n">Point3</span><span class="p">(</span><span class="n">c1</span> <span class="o">*</span> <span class="n">A</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">c2</span> <span class="o">*</span> <span class="n">B</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
                        <span class="n">c1</span> <span class="o">*</span> <span class="n">A</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">c2</span> <span class="o">*</span> <span class="n">B</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
                        <span class="n">c1</span> <span class="o">*</span> <span class="n">A</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">z</span> <span class="o">+</span> <span class="n">c2</span> <span class="o">*</span> <span class="n">B</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">z</span><span class="p">),</span> 
                 <span class="n">A</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">B</span><span class="o">.</span><span class="n">n</span><span class="p">))</span>

<div class="viewcode-block" id="Point3"><a class="viewcode-back" href="../modules/geom.html#geom.Point3">[docs]</a><span class="k">class</span> <span class="nc">Point3</span><span class="p">(</span><span class="n">Vector3</span><span class="p">,</span> <span class="n">Geometry</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A point on a 3D plane.  Construct in the obvious way::</span>

<span class="sd">        &gt;&gt;&gt; p = Point3(1.0, 2.0, 3.0)</span>
<span class="sd">        &gt;&gt;&gt; p</span>
<span class="sd">        Point3(1.00, 2.00, 3.00)</span>
<span class="sd">    </span>
<span class="sd">    **Point3** subclasses **Vector3**, so all of **Vector3** operators and</span>
<span class="sd">    methods apply.  In particular, subtracting two points gives a vector::</span>
<span class="sd">    </span>
<span class="sd">        &gt;&gt;&gt; Point3(1.0, 2.0, 3.0) - Point3(1.0, 0.0, -2.0)</span>
<span class="sd">        Vector3(0.00, 2.00, 5.00)</span>
<span class="sd">    </span>
<span class="sd">    The following methods are also defined:</span>
<span class="sd">    </span>
<span class="sd">    ``intersect(other)``</span>
<span class="sd">        If *other* is a **Sphere**, returns ``True`` iff the point lies within</span>
<span class="sd">        the sphere.</span>
<span class="sd">    </span>
<span class="sd">    ``connect(other)``</span>
<span class="sd">        Returns a **LineSegment3** which is the minimum length line segment</span>
<span class="sd">        that can connect the two shapes.  *other* may be a **Point3**, **Line3**,</span>
<span class="sd">        **Ray3**, **LineSegment3**, **Sphere** or **Plane**.</span>
<span class="sd">    </span>
<span class="sd">    ``distance(other)``</span>
<span class="sd">        Returns the absolute minimum distance to *other*.  Internally this</span>
<span class="sd">        simply returns the length of the result of ``connect``. </span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Point3.intersect"><a class="viewcode-back" href="../modules/geom.html#geom.Point3.intersect">[docs]</a>    <span class="k">def</span> <span class="nf">intersect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">_intersect_point3</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_intersect_sphere</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_intersect_point3_sphere</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>

<div class="viewcode-block" id="Point3.connect"><a class="viewcode-back" href="../modules/geom.html#geom.Point3.connect">[docs]</a>    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">_connect_point3</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_connect_point3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span> <span class="o">!=</span> <span class="n">other</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Segment3</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">_connect_line3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">_connect_point3_line3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">c</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">c</span><span class="o">.</span><span class="n">swap</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">_connect_sphere</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">_connect_point3_sphere</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">c</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">c</span><span class="o">.</span><span class="n">swap</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_connect_plane</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">_connect_point3_plane</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">c</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">c</span><span class="o">.</span><span class="n">swap</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Line3"><a class="viewcode-back" href="../modules/geom.html#geom.Line3">[docs]</a><span class="k">class</span> <span class="nc">Line3</span><span class="p">(</span><span class="n">Geometry</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A **Line3** is a line on a 3D plane extending to infinity in both directions;</span>
<span class="sd">    a **Ray3** has a finite end-point and extends to infinity in a single</span>
<span class="sd">    direction; a **LineSegment3** joins two points.  </span>
<span class="sd">    </span>
<span class="sd">    All three classes support the same constructors, operators and methods,</span>
<span class="sd">    but may behave differently when calculating intersections etc.</span>
<span class="sd">    </span>
<span class="sd">    You may construct a line, ray or line segment using any of:</span>
<span class="sd">    </span>
<span class="sd">    * another line, ray or line segment</span>
<span class="sd">    * two points</span>
<span class="sd">    * a point and a vector</span>
<span class="sd">    * a point, a vector and a length</span>
<span class="sd">    </span>
<span class="sd">    For example::</span>
<span class="sd">    </span>
<span class="sd">        &gt;&gt;&gt; Line3(Point3(1.0, 1.0, 1.0), Point3(1.0, 2.0, 3.0))</span>
<span class="sd">        Line3(&lt;1.00, 1.00, 1.00&gt; + u&lt;0.00, 1.00, 2.00&gt;)</span>
<span class="sd">        &gt;&gt;&gt; Line3(Point3(0.0, 1.0, 1.0), Vector3(1.0, 1.0, 2.0))</span>
<span class="sd">        Line3(&lt;0.00, 1.00, 1.00&gt; + u&lt;1.00, 1.00, 2.00&gt;)</span>
<span class="sd">        &gt;&gt;&gt; Ray3(Point3(1.0, 1.0, 1.0), Vector3(1.0, 1.0, 2.0), 1.0)</span>
<span class="sd">        Ray3(&lt;1.00, 1.00, 1.00&gt; + u&lt;0.41, 0.41, 0.82&gt;)</span>
<span class="sd">    </span>
<span class="sd">    Internally, lines, rays and line segments store a Point3 *p* and a</span>
<span class="sd">    Vector3 *v*.  You can also access (but not set) the two endpoints</span>
<span class="sd">    *p1* and *p2*.  These may or may not be meaningful for all types of lines.</span>
<span class="sd">    </span>
<span class="sd">    The following methods are supported by all three classes:</span>
<span class="sd">    </span>
<span class="sd">    ``intersect(other)``</span>
<span class="sd">        If *other* is a **Sphere**, returns a **LineSegment3** which is the</span>
<span class="sd">        intersection of the sphere and line, or ``None`` if there is no</span>
<span class="sd">        intersection.</span>
<span class="sd">    </span>
<span class="sd">        If *other* is a **Plane**, returns a **Point3** of intersection, or</span>
<span class="sd">        ``None``.</span>
<span class="sd">    </span>
<span class="sd">    ``connect(other)``</span>
<span class="sd">        Returns a **LineSegment3** which is the minimum length line segment</span>
<span class="sd">        that can connect the two shapes.  For two parallel lines, this</span>
<span class="sd">        line segment may be in an arbitrary position.  *other* may be</span>
<span class="sd">        a **Point3**, **Line3**, **Ray3**, **LineSegment3**, **Sphere** or</span>
<span class="sd">        **Plane**.</span>
<span class="sd">    </span>
<span class="sd">    ``distance(other)``</span>
<span class="sd">        Returns the absolute minimum distance to *other*.  Internally this</span>
<span class="sd">        simply returns the length of the result of ``connect``.</span>
<span class="sd">    </span>
<span class="sd">    **LineSegment3** also has a *length* property which is read-only.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
<div class="viewcode-block" id="Line3.__init__"><a class="viewcode-back" href="../modules/geom.html#geom.Line3.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Point3</span><span class="p">)</span> <span class="ow">and</span> \
                   <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">Vector3</span><span class="p">)</span> <span class="ow">and</span> \
                   <span class="nb">type</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">==</span> <span class="nb">float</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Point3</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">Point3</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Point3</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">Vector3</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">args</span><span class="p">,)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Line3</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">args</span><span class="p">,)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">args</span><span class="p">,)</span>
        
        <span class="c"># XXX This is annoying.</span>
        <span class="c">#if not self.v:</span>
        <span class="c">#    raise AttributeError, &#39;Line has zero-length vector&#39;</span>
</div>
<div class="viewcode-block" id="Line3.__copy__"><a class="viewcode-back" href="../modules/geom.html#geom.Line3.__copy__">[docs]</a>    <span class="k">def</span> <span class="nf">__copy__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">)</span>
</div>
    <span class="n">copy</span> <span class="o">=</span> <span class="n">__copy__</span>

<div class="viewcode-block" id="Line3.__repr__"><a class="viewcode-back" href="../modules/geom.html#geom.Line3.__repr__">[docs]</a>    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">(</span><span class="si">%s</span><span class="s">,</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">)</span>
</div>
    <span class="n">p1</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">)</span>
    <span class="n">p2</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="n">Point3</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> 
                                      <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
                                      <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">z</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">z</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_apply_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">t</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="n">t</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span>

    <span class="k">def</span> <span class="nf">_u_in</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">True</span>

<div class="viewcode-block" id="Line3.intersect"><a class="viewcode-back" href="../modules/geom.html#geom.Line3.intersect">[docs]</a>    <span class="k">def</span> <span class="nf">intersect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">_intersect_line3</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_intersect_sphere</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_intersect_line3_sphere</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_intersect_plane</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_intersect_line3_plane</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>

<div class="viewcode-block" id="Line3.connect"><a class="viewcode-back" href="../modules/geom.html#geom.Line3.connect">[docs]</a>    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">_connect_line3</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_connect_point3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_connect_point3_line3</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_connect_line3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_connect_line3_line3</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_connect_sphere</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_connect_sphere_line3</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_connect_plane</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">_connect_line3_plane</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">c</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">c</span>
</div>
<div class="viewcode-block" id="Ray3"><a class="viewcode-back" href="../modules/geom.html#geom.Ray3">[docs]</a><span class="k">class</span> <span class="nc">Ray3</span><span class="p">(</span><span class="n">Line3</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">_u_in</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">u</span> <span class="o">&gt;=</span> <span class="mf">0.0</span>
</div>
<div class="viewcode-block" id="Segment3"><a class="viewcode-back" href="../modules/geom.html#geom.Segment3">[docs]</a><span class="k">class</span> <span class="nc">Segment3</span><span class="p">(</span><span class="n">Line3</span><span class="p">):</span>
<div class="viewcode-block" id="Segment3.__repr__"><a class="viewcode-back" href="../modules/geom.html#geom.Segment3.__repr__">[docs]</a>    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">(</span><span class="si">%s</span><span class="s">,</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">p2</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_u_in</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">u</span> <span class="o">&gt;=</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="n">u</span> <span class="o">&lt;=</span> <span class="mf">1.0</span>

<div class="viewcode-block" id="Segment3.__abs__"><a class="viewcode-back" href="../modules/geom.html#geom.Segment3.__abs__">[docs]</a>    <span class="k">def</span> <span class="nf">__abs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Segment3.mag2"><a class="viewcode-back" href="../modules/geom.html#geom.Segment3.mag2">[docs]</a>    <span class="k">def</span> <span class="nf">mag2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">mag2</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Segment3.swap"><a class="viewcode-back" href="../modules/geom.html#geom.Segment3.swap">[docs]</a>    <span class="k">def</span> <span class="nf">swap</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># used by connect methods to switch order of points</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">return</span> <span class="bp">self</span>
</div>
    <span class="n">length</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Sphere"><a class="viewcode-back" href="../modules/geom.html#geom.Sphere">[docs]</a><span class="k">class</span> <span class="nc">Sphere</span><span class="p">(</span><span class="n">Geometry</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Spheres are constructed with a center **Point3** and a radius::</span>

<span class="sd">    &gt;&gt;&gt; s = Sphere(Point3(1.0, 1.0, 1.0), 0.5)</span>
<span class="sd">    &gt;&gt;&gt; s</span>
<span class="sd">    Sphere(&lt;1.00, 1.00, 1.00&gt;, radius=0.50)</span>

<span class="sd">    Internally there are two attributes: *c*, giving the center point and</span>
<span class="sd">    *r*, giving the radius.</span>
<span class="sd">    </span>
<span class="sd">    The following methods are supported:</span>
<span class="sd">    </span>
<span class="sd">    ``intersect(other)``:</span>
<span class="sd">        If *other* is a **Point3**, returns ``True`` iff the point lies</span>
<span class="sd">        within the sphere.</span>
<span class="sd">    </span>
<span class="sd">        If *other* is a **Line3**, **Ray3** or **LineSegment3**, returns</span>
<span class="sd">        a **LineSegment3** giving the intersection, or ``None`` if the</span>
<span class="sd">        line does not intersect the sphere.</span>
<span class="sd">    </span>
<span class="sd">    ``connect(other)``</span>
<span class="sd">        Returns a **LineSegment3** which is the minimum length line segment</span>
<span class="sd">        that can connect the two shapes. *other* may be a **Point3**, **Line3**,</span>
<span class="sd">        **Ray3**, **LineSegment3**, **Sphere** or **Plane**.</span>
<span class="sd">    </span>
<span class="sd">    ``distance(other)``</span>
<span class="sd">        Returns the absolute minimum distance to *other*.  Internally this</span>
<span class="sd">        simply returns the length of the result of ``connect``.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Sphere.__init__"><a class="viewcode-back" href="../modules/geom.html#geom.Sphere.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">radius</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">center</span><span class="p">,</span> <span class="n">Vector3</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">radius</span><span class="p">)</span> <span class="o">==</span> <span class="nb">float</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">center</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">=</span> <span class="n">radius</span>
</div>
<div class="viewcode-block" id="Sphere.__copy__"><a class="viewcode-back" href="../modules/geom.html#geom.Sphere.__copy__">[docs]</a>    <span class="k">def</span> <span class="nf">__copy__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">)</span>
</div>
    <span class="n">copy</span> <span class="o">=</span> <span class="n">__copy__</span>

<div class="viewcode-block" id="Sphere.__repr__"><a class="viewcode-back" href="../modules/geom.html#geom.Sphere.__repr__">[docs]</a>    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">(</span><span class="si">%s</span><span class="s">,</span><span class="si">%g</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_apply_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">t</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>

<div class="viewcode-block" id="Sphere.intersect"><a class="viewcode-back" href="../modules/geom.html#geom.Sphere.intersect">[docs]</a>    <span class="k">def</span> <span class="nf">intersect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">_intersect_sphere</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_intersect_point3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_intersect_point3_sphere</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_intersect_line3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_intersect_line3_sphere</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

<div class="viewcode-block" id="Sphere.connect"><a class="viewcode-back" href="../modules/geom.html#geom.Sphere.connect">[docs]</a>    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">_connect_sphere</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_connect_point3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_connect_point3_sphere</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_connect_line3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">_connect_sphere_line3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">c</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">c</span><span class="o">.</span><span class="n">swap</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_connect_sphere</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_connect_sphere_sphere</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_connect_plane</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">_connect_sphere_plane</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">c</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">c</span>
</div>
<div class="viewcode-block" id="Plane"><a class="viewcode-back" href="../modules/geom.html#geom.Plane">[docs]</a><span class="k">class</span> <span class="nc">Plane</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Planes can be constructed with any of:</span>

<span class="sd">    * three **Point3**&#39;s lying on the plane</span>
<span class="sd">    * a **Point3** on the plane and the **Vector3** normal</span>
<span class="sd">    * a **Vector3** normal and *k*, described below.</span>
<span class="sd">    </span>
<span class="sd">    Internally, planes are stored with the normal *n* and constant *k* such</span>
<span class="sd">    that *n.p* = *k* for any point on the plane *p*.</span>
<span class="sd">    </span>
<span class="sd">    The following methods are supported:</span>
<span class="sd">    </span>
<span class="sd">    ``intersect(other)``</span>
<span class="sd">        If *other* is a **Line3**, **Ray3** or **LineSegment3**, returns a</span>
<span class="sd">        **Point3** of intersection, or ``None`` if there is no intersection.</span>
<span class="sd">    </span>
<span class="sd">        If *other* is a **Plane**, returns the **Line3** of intersection.</span>
<span class="sd">    </span>
<span class="sd">    ``connect(other)``</span>
<span class="sd">        Returns a **LineSegment3** which is the minimum length line segment</span>
<span class="sd">        that can connect the two shapes. *other* may be a **Point3**, **Line3**,</span>
<span class="sd">        **Ray3**, **LineSegment3**, **Sphere** or **Plane**.</span>
<span class="sd">    </span>
<span class="sd">    ``distance(other)``</span>
<span class="sd">        Returns the absolute minimum distance to *other*.  Internally this</span>
<span class="sd">        simply returns the length of the result of ``connect``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># n.p = k, where n is normal, p is point on plane, k is constant scalar</span>

<div class="viewcode-block" id="Plane.__init__"><a class="viewcode-back" href="../modules/geom.html#geom.Plane.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Point3</span><span class="p">)</span> <span class="ow">and</span> \
                   <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">Point3</span><span class="p">)</span> <span class="ow">and</span> \
                   <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">Point3</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">normalize</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Point3</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">Vector3</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">normalized</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Vector3</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="nb">float</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">normalized</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">args</span><span class="p">,)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">args</span><span class="p">,)</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">,</span> <span class="s">&#39;Points on plane are colinear&#39;</span>
</div>
<div class="viewcode-block" id="Plane.__copy__"><a class="viewcode-back" href="../modules/geom.html#geom.Plane.__copy__">[docs]</a>    <span class="k">def</span> <span class="nf">__copy__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)</span>
</div>
    <span class="n">copy</span> <span class="o">=</span> <span class="n">__copy__</span>

<div class="viewcode-block" id="Plane.__repr__"><a class="viewcode-back" href="../modules/geom.html#geom.Plane.__repr__">[docs]</a>    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;Plane(&lt;</span><span class="si">%.2f</span><span class="s">, </span><span class="si">%.2f</span><span class="s">, </span><span class="si">%.2f</span><span class="s">&gt;.p = </span><span class="si">%.2f</span><span class="s">)&#39;</span> <span class="o">%</span> \
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_get_point</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Return an arbitrary point on the plane</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">z</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Point3</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">y</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Point3</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Point3</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_apply_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">t</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_point</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">t</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

<div class="viewcode-block" id="Plane.intersect"><a class="viewcode-back" href="../modules/geom.html#geom.Plane.intersect">[docs]</a>    <span class="k">def</span> <span class="nf">intersect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">_intersect_plane</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_intersect_line3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_intersect_line3_plane</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_intersect_plane</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_intersect_plane_plane</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>

<div class="viewcode-block" id="Plane.connect"><a class="viewcode-back" href="../modules/geom.html#geom.Plane.connect">[docs]</a>    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">_connect_plane</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_connect_point3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_connect_point3_plane</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_connect_line3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_connect_line3_plane</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_connect_sphere</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_connect_sphere_plane</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_connect_plane</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_connect_plane_plane</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="argPair"><a class="viewcode-back" href="../modules/geom.html#geom.argPair">[docs]</a><span class="k">def</span> <span class="nf">argPair</span><span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Process a pair of values passed in various ways.</span>

<span class="sd">      [ if len(p) is 2 -&gt;</span>
<span class="sd">            return (p[0], p[1])</span>
<span class="sd">        else if p is a single non-iterable -&gt;</span>
<span class="sd">          return (p[0], p[0])</span>
<span class="sd">        else if p is an iterable with two values -&gt;</span>
<span class="sd">            return (p[0][0], p[0][1])</span>
<span class="sd">        else if p is an iterable with one value -&gt;</span>
<span class="sd">            return (p[0][0], p[0][0])</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c">#-- 1 --</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">it</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">it</span><span class="p">,</span> <span class="s">&quot;__iter__&quot;</span><span class="p">):</span>
        <span class="k">return</span><span class="p">(</span><span class="n">it</span><span class="p">,</span> <span class="n">it</span><span class="p">)</span>

    <span class="n">values</span> <span class="o">=</span> <span class="p">[</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">]</span>

    <span class="c">#-- 4 --</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    </div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">Goulib 1.7.3 documentation</a> &raquo;</li>
          <li><a href="index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Ph. Guglielmetti, https://github.com/goulu/Goulib.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>